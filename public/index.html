<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë°”ë¥¸ë¯¸ìˆ í•™ì› Â· ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸ V1. BASIC</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<!-- ì°¨íŠ¸ / ìº¡ì²˜ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

<style>
:root{
  --ink:#0f172a; --muted:#6b7280; --bg:#FFF4EC;
  --card:#ffffff; --line:#eef2f7; --o1:#FFE6CF; --o2:#FFD9BE;
  --mint:#CFF7EE; --vio:#E6E2FF; --radius:22px;
  --shadow:0 18px 60px rgba(16,24,40,.12); --soft:0 12px 30px rgba(16,24,40,.08);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;color:var(--ink);font-family:"Pretendard",ui-sans-serif,system-ui,"Noto Sans KR",Segoe UI,Roboto,Arial;background:var(--bg);font-size:17px}
.container{min-height:100dvh;display:flex;flex-direction:column;align-items:center}
.main{width:100%;max-width:1100px;padding:18px;display:flex;flex-direction:column;gap:16px;margin:0 auto}
.header{width:100%;display:flex;justify-content:center}
.brand{width:100%;max-width:1100px;margin-top:10px;display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:999px;background:#fff;border:1px solid var(--line);box-shadow:var(--soft)}
.logo{width:28px;height:28px;border-radius:50%;background:conic-gradient(from 0deg,#FFB98A,#FFE6CF,#E6E2FF,#CFF7EE,#FFB98A);animation:spin 9s linear infinite paused}
.brand:hover .logo{animation-play-state:running}@keyframes spin{to{transform:rotate(360deg)}}
.brand span{font-weight:900;letter-spacing:.2px;display:flex;align-items:center;gap:8px}
.badge{font-size:12px;font-weight:900;padding:4px 8px;border-radius:999px;background:linear-gradient(90deg,#FFE6CF,#FFD9BE);color:#5a3f2f;border:1px solid #ffe0c9}

/* ì§„í–‰ë°” & ë„¤ë¹„ */
.sticky{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.95);border:1px solid var(--line);border-radius:16px;box-shadow:var(--soft);padding:8px 10px;display:flex;flex-direction:column;gap:10px}
.navbar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
.step{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;cursor:pointer;background:#fff;color:#374151;font-weight:850;border:1px solid var(--line);box-shadow:var(--soft);transition:transform .12s}
.step:hover{transform:translateY(-1px)}
.step .num{width:20px;height:20px;border-radius:50%;display:inline-grid;place-items:center;background:#fff;border:1px solid var(--line);font-size:13px}
.step.active{background:linear-gradient(90deg,#FFE6CF,#E6E2FF);color:#111827;box-shadow:0 12px 30px rgba(255,214,176,.28)}
.step.done{background:#f2fffa;border-color:#dff7ef}

.topprogress{--steps:15;position:relative;height:30px;background:#f6f7fb;border-radius:999px;overflow:hidden;border:1px solid var(--line)}
.topprogress .bar{position:absolute;inset:0 auto 0 0;width:0;background:linear-gradient(90deg,#B9C8FF,#9DE5D5,#FFD9BE);border-radius:999px;z-index:1;transition:width .35s ease}
.topprogress::before{
  content:"";position:absolute;inset:0;z-index:2;pointer-events:none;
  background-image:linear-gradient(to right, rgba(17,24,39,.08) 0, rgba(17,24,39,.08) 1px, transparent 1px, transparent calc(100%/var(--steps)));
  background-size:calc(100%/var(--steps)) 100%;
}
.topprogress .toplabel{position:absolute;inset:0;display:grid;place-items:center;z-index:3;font-weight:900;font-size:15px;color:#111827;text-shadow:0 1px 0 rgba(255,255,255,.85),0 0 6px rgba(255,255,255,.9)}
.statusline{font-size:13px;color:var(--muted);text-align:center}

.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);animation:fade .35s ease both}
@keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
h1{font-size:35px;margin:0 0 6px}h2{font-size:25px;margin:0 0 10px}h3{font-size:19px;margin:16px 0 8px}
p{margin:8px 0}.small{font-size:14px}.muted{color:var(--muted)}.center{text-align:center}

/* Hero */
.hero{position:relative;padding:44px 22px;border-radius:22px;border:1px solid var(--line);
  background:radial-gradient(900px 260px at 15% -40%, #FFE6CF 0%, transparent 60%),radial-gradient(900px 260px at 85% -40%, #E6E2FF 0%, transparent 60%),linear-gradient(180deg,#ffffff 0%, #fff9f3 100%)}
.hero .title{font-size:45px;font-weight:900;letter-spacing:.2px;margin:2px 0 6px;color:#111827}
.hero .sub{color:#6b7280;margin-bottom:18px}
.hero .ctaRow{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

/* ë²„íŠ¼ */
.btn{--bg:linear-gradient(90deg,#FFB98A,#FFD9BE);--glow:rgba(255,185,138,.35);background:var(--bg);color:#5a3f2f;border:none;padding:18px 28px;border-radius:18px;font-weight:900;cursor:pointer;box-shadow:0 16px 40px var(--glow);transition:transform .08s,filter .2s;font-size:21px}
.btn:hover{transform:translateY(-1px);filter:brightness(1.03)}
.btn-ghost{background:#fff;color:#111827;border:1px solid var(--line);padding:12px 14px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:var(--soft)}
.btn-mint{--bg:linear-gradient(90deg,#FFE6CF,#FFD9BE)}.btn-accent{--bg:linear-gradient(90deg,#B9C8FF,#9DE5D5)}.btn-xl{padding:22px 34px;font-size:23px;border-radius:22px}

/* ì…ë ¥/í¼ ì¹´ë“œ */
input,select,textarea{width:100%;background:#fff;color:#111;border:1px solid var(--line);border-radius:12px;padding:13px;outline:none}
input:focus,select:focus,textarea:focus{border-color:#FFD9BE;box-shadow:0 0 0 6px rgba(255,217,190,.26)}
label{font-size:15px;color:#374151}
.section{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px}

.grid{display:grid;gap:14px}
.grid-2{grid-template-columns:1fr 1fr}
.grid-4{grid-template-columns:repeat(4,1fr)}
@media (max-width:1020px){.grid-4{grid-template-columns:repeat(2,1fr)}}
@media (max-width:640px){.grid-4{grid-template-columns:1fr}}

/* ë³´ê¸° ì¹´ë“œ â€“ ì •ì‚¬ê° ì¸ë„¤ì¼(ë™ì¼ í¬ê¸°) */
.opt{border:2px solid var(--line);border-radius:18px;overflow:hidden;cursor:pointer;background:#fff;box-shadow:var(--soft);transition:transform .12s,border-color .2s}
.opt:hover{transform:translateY(-2px)}
.opt .thumb{width:58%;max-width:160px;aspect-ratio:1/1;border-radius:14px;overflow:hidden;border:1px solid var(--line);background:#fafafa;margin:14px auto 8px;display:flex;align-items:center;justify-content:center}
.opt .thumb img{width:100%;height:100%;object-fit:cover;display:block}
.opt .cap{padding:10px 12px 14px;color:#374151;font-weight:800;font-size:16px;line-height:1.35}

@media (min-width:1024px){
  .test-grid-4{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
  .test-grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
  .sideNav{position:fixed;top:50%;transform:translateY(-50%);z-index:20}
  .sideNav.left{left:18px}.sideNav.right{right:18px}
  .sideBtn{background:linear-gradient(90deg,#fff,#FFF4EC);border:1px solid var(--line);width:48px;height:48px;border-radius:50%;display:grid;place-items:center;box-shadow:0 12px 26px rgba(16,24,40,.08);cursor:pointer;font-weight:900}
  .sideBtn:hover{transform:translateY(-1px)}
}
@media (max-width:1023px){.sideNav{display:none}}
.opt.sel{border-color:#FFD9BE;box-shadow:0 0 0 6px rgba(255,217,190,.25)}

/* ë™ì˜ ì•„ì½”ë””ì–¸(ê¸°ë³¸ ì ‘í˜) */
.acc{border-radius:14px;overflow:hidden;border:1px solid var(--line)}
.acc-item{border-top:1px solid var(--line)}
.acc-head{padding:15px 16px;background:#FFF4EC;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.acc-head span{font-weight:900;font-size:18px}
.acc-body{padding:14px 16px;display:none;background:#fff}
.acc-item.open .acc-body{display:block}
.agreeList{display:grid;gap:10px;margin-top:10px}
.agree-row{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:13px 14px;border:1px solid var(--line);border-radius:12px;background:#fff}
.agree-row .txt{font-size:16px;color:#0f172a;line-height:1.55;font-weight:700}
.agree-row input[type="checkbox"]{width:21px;height:21px;accent-color:#FFB98A}

/* ê²°ê³¼ ë ˆì´ì•„ì›ƒ(ê·¸ë˜í”„ 3ê°œ) */
.block{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 26px rgba(16,24,40,.06);page-break-inside:avoid;break-inside:avoid}
.block h3{margin:0 0 10px}
.result-grid{display:grid;grid-template-columns:3fr 2fr;gap:16px}
.result-right{display:grid;grid-template-rows:1fr 1fr;gap:16px}
.chartBox{height:420px;border:1px solid var(--line);border-radius:14px;padding:10px;background:#fff}
.result-right .chartBox{height:200px}
.chartBox canvas{width:100% !important;height:100% !important;display:block}
.chartCaption{font-weight:900;margin:0 0 6px;color:#111827}

.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{background:linear-gradient(90deg,#FFE6CF,#FFD9BE);color:#5a3f2f;border:1px solid #ffe8d6;padding:8px 12px;border-radius:999px;font-weight:900}
.callout{position:relative;background:linear-gradient(135deg,#FFF2E6,#F8FBFF);padding:22px;border-radius:18px;border:1px solid var(--line);box-shadow:0 12px 34px rgba(255,185,138,.25)}
.callout:before{content:"";position:absolute;inset:-1px;border-radius:18px;padding:1px;background:linear-gradient(90deg,#FFD9BE,#E6E2FF,#CFF7EE);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude}

/* ìì„¸í•œ ê²°ê³¼ ì¹´ë“œ */
.detail-hero{display:flex;align-items:center;gap:8px;justify-content:center;margin-bottom:8px}
.detail-hero .ic{width:50px;height:50px;border-radius:999px;background:#e9efff;border:1px solid #dbe7ff;display:grid;place-items:center;font-weight:900;color:#3b61ff}
.detail-title{font-size:29px;font-weight:900}
.detail-sub{color:#6b7280;text-align:center;margin:-4px 0 10px}
.theoryWrap{background:#f5f8ff;border:1px solid #e6eeff;border-radius:18px;padding:16px}
.tgrid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
.tcard{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px;line-height:1.7}
.tcard.hint{background:#f9fbff}
.tchip{background:#e6eeff;color:#2f5aff;border:1px solid #d9e3ff;padding:7px 11px;border-radius:999px;font-weight:800;font-size:13px}

/* ìƒë‹´ ì˜ˆì•½ */
.reserve{margin-top:14px;text-align:center;background:linear-gradient(180deg,#fff7ec,#ffe7d1);border:1px solid #ffd9be;border-radius:18px;padding:18px}
.reserve .title{font-weight:900;font-size:23px;color:#5a3f2f}
.reserve .items{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin:16px 0;justify-items:center}
.reserve .pill{width:100%;max-width:360px;background:#fff;border:1px solid #ffe1c9;border-radius:14px;padding:12px}
.reserve .pill .pt{font-weight:900;margin-bottom:6px}.reserve .note{font-size:13px;color:#6b7280;margin-top:8px}

/* í”„ë¦°íŠ¸ */
@media print{.header,.sticky,.btn,.btn-ghost,.sideNav,.no-pdf{display:none !important}.card{box-shadow:none;border:1px solid #ddd}.block{break-inside:avoid-page}}
.pdf-screen-width{width:794px;max-width:none;margin:0 auto}

/* ì´ë©”ì¼ ëª¨ë‹¬ */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:999}
.modal-backdrop.show{display:flex}
.modal{width:min(520px,92vw);background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 18px 60px rgba(16,24,40,.18);padding:18px}
.modal h3{margin:0 0 10px}.modal .row{display:grid;gap:8px;margin:10px 0}.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
</style>
</head>
<body>
<div class="container" id="appRoot">
  <div class="header">
    <div class="brand">
      <div class="logo"></div>
      <span>ë°”ë¥¸ë¯¸ìˆ í•™ì› Â· ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸ <span class="badge">V1. BASIC</span></span>
    </div>
  </div>

  <main class="main" aria-live="polite">
    <div class="sticky">
      <nav class="navbar" id="topnav"></nav>
      <div class="topprogress" id="topprogress">
        <div id="topbar" class="bar"></div>
        <div id="toplabel" class="toplabel"></div>
      </div>
      <div class="statusline" id="statusline">ì§„í–‰ë¥  0%</div>
    </div>
    <section class="card" id="app"></section>
  </main>
</div>

<div class="sideNav left" id="sideLeft" style="display:none"><button class="sideBtn" onclick="prev()" aria-label="ì´ì „">â€¹</button></div>
<div class="sideNav right" id="sideRight" style="display:none"><button class="sideBtn" onclick="next()" aria-label="ë‹¤ìŒ">â€º</button></div>

<!-- ì´ë©”ì¼ ëª¨ë‹¬ -->
<div class="modal-backdrop" id="emailModal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="modal">
    <h3>ì´ë©”ì¼ë¡œ ê²°ê³¼ ë³´ë‚´ê¸°</h3>
    <div class="row">
      <label>ë°›ëŠ” ì‚¬ëŒ ì´ë©”ì¼</label>
      <input type="email" id="emailTo" placeholder="example@email.com">
    </div>
    <div class="row">
      <label>ì œëª©</label>
      <input type="text" id="emailSubject" value="">
    </div>
    <div class="actions">
      <button class="btn-ghost" id="emailCancel">ì·¨ì†Œ</button>
      <button class="btn btn-accent" id="emailSend">ë³´ë‚´ê¸°</button>
    </div>
    <div class="small muted" id="emailMsg" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* ===== ìƒìˆ˜ ===== */
const APP_TITLE='ë°”ë¥¸ë¯¸ìˆ í•™ì› Â· ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸ V1. BASIC';
const SHEET_ID='14VLQBhDJtduxjCnfr7VEOstZ5ez8-CX3ArXy1OvYCQg';
const GVIZ_URL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=Questions&tqx=out:json`;
const FORM_ACTION='https://docs.google.com/forms/d/e/1FAIpQLSeRWq5YKN50zL0simiaQA6EBRsn6VXN__ZmLplAgDz1I1hyQA/formResponse';
const EMAIL_FUNCTION_URL='/.netlify/functions/send-email';

/* Google Form í•­ëª© ë§¤í•‘ */
const F={child_name:'entry.684468179',age:'entry.1066070471',grade:'entry.1812672802',guardian:'entry.1666083184',phone:'entry.89824848',campus:'entry.490719219',answers:'entry.85364862',scores:'entry.1455508168',top3:'entry.2120338430',resultId:'entry.532514127',timestamp:'entry.1261684833'};

const ASSET_BASE='/img';
const DOMAINS=["ê´€ì°°ë ¥","ìƒ‰ê°ê°","ì„œì‚¬ë ¥","ê³µê°„ê°","ë””í…Œì¼","ë„ì „ì„±","ì†Œí†µë ¥","ê¾¸ì¤€ì„±"];
const STEPS=[
  {key:'start',label:'ì‹œì‘'},
  {key:'consent',label:'ë™ì˜'},
  {key:'profile',label:'í”„ë¡œí•„'},
  {key:'test',label:'í…ŒìŠ¤íŠ¸'},
  {key:'result',label:'ê²°ê³¼'},
  {key:'details',label:'ìì„¸í•œ ê²°ê³¼'}
];
const STATE={step:'start',consent:false,profile:{},questions:[],idx:0,answers:[],result:null};

const $=id=>document.getElementById(id);
const app=()=>$('app');

/* NAV + Progress */
function renderNav(){
  const cur=STEPS.findIndex(s=>s.key===STATE.step);
  $('topnav').innerHTML=STEPS.map((s,i)=>`<div class="step ${s.key===STATE.step?'active':''} ${cur>i?'done':''}" onclick="navGo('${s.key}')"><span class="num">${i+1}</span><span>${s.label}</span></div>`).join('')
}
function updateTopProgress(){
  const topbar=$('topbar'); const toplabel=$('toplabel'); const tp=$('topprogress'); const status=$('statusline');
  if(STATE.step==='test'&&STATE.questions.length){
    status.style.display='none';
    const total=STATE.questions.length;
    const curIndex=STATE.idx+1;
    const pct=Math.max(0, Math.min(100, Math.round((STATE.idx)/total*100)));
    topbar.style.width=pct+'%';
    toplabel.textContent=`(${curIndex}/${total})`;
    tp.style.setProperty('--steps', String(total));
    $('sideLeft').style.display='block';
    $('sideRight').style.display='block';
    return;
  }
  $('sideLeft').style.display='none';
  $('sideRight').style.display='none';
  toplabel.textContent='';
  status.style.display='block';
  let pct=(STEPS.findIndex(s=>s.key===STATE.step))/(STEPS.length-1)*100;
  topbar.style.width=Math.round(pct)+'%';
  $('statusline').textContent=`ì§„í–‰ë¥  ${Math.round(pct)}%`;
}
function navGo(step){STATE.step=step;if(step==='test'&&STATE.questions.length===0){startTest();return;}render();}

/* GViz íŒŒì„œ */
function parseGViz(text){const s=text.indexOf('{'),e=text.lastIndexOf('}');if(s<0||e<0)return[];const obj=JSON.parse(text.slice(s,e+1));const cols=obj.table.cols.map(c=>c.label);return obj.table.rows.map(r=>r.c.map(c=>c?(c.f??c.v):'')).map(a=>Object.fromEntries(cols.map((k,i)=>[k,a[i]])))}
async function loadQuestions(){
  try{
    const txt=await(await fetch(GVIZ_URL)).text();
    const rows=parseGViz(txt)||[];
    const act=rows.filter(r=>String(r.active).toUpperCase()==='TRUE').sort((a,b)=>(+a.order-+b.order));
    if(act.length){
      STATE.questions=act.map(r=>{
        const mkWeights=k=>{try{return JSON.parse(r[`${k}_weights`])||{}}catch{return{}}};
        const mkOpt=k=>({key:k,label:(r[`${k}_label`]||'').trim(),imageUrl:(r[`${k}_image`]||'').trim(),weights:mkWeights(k)});
        const opts=['A','B','C','D'].map(mkOpt).filter(o=>{
          const hasLabel=o.label.length>0;const hasImage=o.imageUrl.length>0;
          const hasWeight=Object.values(o.weights||{}).some(v=>Number(v||0)!==0);
          return hasLabel||hasImage||hasWeight;
        });
        const safeOpts=opts.length>=2?opts:['A','B'].map(mkOpt);
        return{id:r.id||`q${r.order}`,order:+r.order,prompt:r.prompt||'',options:safeOpts}
      });
      return;
    }
  }catch(e){}
  STATE.questions=localQuestions()
}

/* ì‹œì‘ í™”ë©´ */
function startScreen(){
  return `
    <div class="hero">
      <div class="title center">${APP_TITLE}</div>
      <div class="sub center">ì•„ì´ì˜ ë¯¸ìˆ  ì ì„±ê³¼ ì ì¬ë ¥ì„ ê°„ë‹¨íˆ í™•ì¸í•˜ê³ , ë°”ë¡œ ê²°ê³¼ë¥¼ ì €ì¥Â·ì´ë©”ì¼ ì „ì†¡í•  ìˆ˜ ìˆì–´ìš”.</div>
      <div class="ctaRow">
        <button class="btn btn-xl" id="startBtn">í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸° â†’</button>
        <a class="btn-ghost btn-xl" href="index2.html" style="text-decoration:none">ADVANCE í…ŒìŠ¤íŠ¸</a>
      </div>
    </div>
    <section class="features" style="margin:20px auto 8px;max-width:980px">
      <h2 style="text-align:center;font-weight:900">í…ŒìŠ¤íŠ¸ íŠ¹ì§•</h2>
      <p class="sub" style="text-align:center;color:#6b7280;margin:0 0 16px">ì•„ì´ì˜ ë¯¸ìˆ  í¥ë¯¸Â·ì„±í–¥ì„ íŒŒì•…í•´ ë„ì›€ ë˜ëŠ” êµìœ¡ í¬ì¸íŠ¸ë¥¼ ì œì‹œí•©ë‹ˆë‹¤</p>
      <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:14px">
        <div class="card" style="display:flex;align-items:center;gap:12px"><div class="badge" style="font-size:19px">â±</div><div><b>ë¹ ë¥¸ í…ŒìŠ¤íŠ¸</b><div class="small muted">5â€“8ë¶„ ë‚´ ì™„ë£Œ</div></div></div>
        <div class="card" style="display:flex;align-items:center;gap:12px"><div class="badge" style="font-size:19px">ğŸ¯</div><div><b>ë§ì¶¤ ë¶„ì„</b><div class="small muted">ê°•ì /êµìœ¡ í¬ì¸íŠ¸</div></div></div>
        <div class="card" style="display:flex;align-items:center;gap:12px"><div class="badge" style="font-size:19px">âš¡</div><div><b>ì¦‰ì‹œ ê²°ê³¼</b><div class="small muted">ì €ì¥/ì´ë©”ì¼ ì „ì†¡</div></div></div>
      </div>
      <div class="small muted center" style="margin-top:12px">â€» ë³¸ í…ŒìŠ¤íŠ¸ëŠ” <b>êµìœ¡ ê°€ì´ë“œ</b> ëª©ì ì´ë©°, ì˜í•™/ì„ìƒ ì§„ë‹¨ì´ ì•„ë‹™ë‹ˆë‹¤.</div>
    </section>`;
}
function viewStart(){app().innerHTML=startScreen();$('startBtn').onclick=()=>navGo('consent');window.scrollTo({top:0,behavior:'smooth'})}

/* ë™ì˜ì„œ (ê¸°ë³¸ ì ‘í˜) */
function accItem(t,html){return `<div class="acc-item"><div class="acc-head"><span>${t}</span><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div class="acc-body small">${html}</div></div>`}
function viewConsent(){
  app().innerHTML=`<h2 class="center">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ</h2>
  <div class="acc">
    ${accItem('<b>1) ëª©ì </b>','â‘  í…ŒìŠ¤íŠ¸ ì œê³µ ë° ê²°ê³¼ ì‚°ì¶œ â‘¡ ê²°ê³¼ ì•ˆë‚´Â·PDF ì €ì¥ ì§€ì› â‘¢ ìƒë‹´ í’ˆì§ˆ ê°œì„ ')}
    ${accItem('<b>2) ìˆ˜ì§‘ í•­ëª©</b>','ì•„ë™ ì´ë¦„Â·ë‚˜ì´Â·í•™ë…„ / ë³´í˜¸ì ì´ë¦„Â·ì—°ë½ì²˜ / ì‘ë‹µ ë‚´ìš© (ì´ë©”ì¼ì€ ì„ íƒ)')}
    ${accItem('<b>3) ë³´ê´€ ê¸°ê°„</b>','ìˆ˜ì§‘ì¼ë¡œë¶€í„° <b>12ê°œì›”</b> ë³´ê´€ í›„ íŒŒê¸°')}
    ${accItem('<b>4) ë³´ê´€/ì²˜ë¦¬</b>','Google Forms/Sheetsì— ì €ì¥Â·ì²˜ë¦¬')}
    ${accItem('<b>5) ê¶Œë¦¬</b>','ë™ì˜ ê±°ë¶€ ê°€ëŠ¥(ê±°ë¶€ ì‹œ ì„œë¹„ìŠ¤ ì œí•œ ê°€ëŠ¥)')}
    ${accItem('<b>6) ë¬¸ì˜</b>','barunart1004@gmail.com')}
  </div>
  <div class="section" style="margin-top:16px">
    <div class="agreeList">
      <div class="agree-row"><div class="txt">(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— <b>ë™ì˜í•©ë‹ˆë‹¤.</b></div><input type="checkbox" id="chk_required" /></div>
      <div class="agree-row"><div class="txt">(í•„ìˆ˜) ë§Œ 14ì„¸ ë¯¸ë§Œ ì•„ë™ì˜ ë²•ì •ëŒ€ë¦¬ì¸ìœ¼ë¡œì„œ <b>ë™ì˜í•©ë‹ˆë‹¤.</b></div><input type="checkbox" id="chk_minor" /></div>
    </div>
  </div>
  <div class="center" style="margin-top:16px;display:flex;gap:8px;justify-content:center">
    <button class="btn" id="btn_consent" disabled>ë™ì˜í•˜ê³  ì§„í–‰</button>
    <button class="btn-ghost" id="btn_expand">ì „ë¬¸ í¼ì¹˜ê¸°</button>
    <button class="btn-ghost" id="btn_collapse">ëª¨ë‘ ì ‘ê¸°</button>
  </div>`;
  const validate=()=>{$('btn_consent').disabled=!( $('chk_required').checked && $('chk_minor').checked )};
  $('chk_required').addEventListener('change',validate);$('chk_minor').addEventListener('change',validate);
  $('btn_consent').onclick=()=>{STATE.consent=true;navGo('profile')};
  $('btn_expand').onclick=()=>document.querySelectorAll('.acc-item').forEach(it=>it.classList.add('open'));
  $('btn_collapse').onclick=()=>document.querySelectorAll('.acc-item').forEach(it=>it.classList.remove('open'));
  document.querySelectorAll('.acc-head').forEach(h=>h.addEventListener('click',()=>h.parentElement.classList.toggle('open')));
}

/* í”„ë¡œí•„ â€“ 4ì—´ ê·¸ë¦¬ë“œ */
const AGE_TO_GRADE={7:'ì´ˆë“±í•™êµ 1í•™ë…„',8:'ì´ˆë“±í•™êµ 2í•™ë…„',9:'ì´ˆë“±í•™êµ 3í•™ë…„',10:'ì´ˆë“±í•™êµ 4í•™ë…„',11:'ì´ˆë“±í•™êµ 5í•™ë…„',12:'ì´ˆë“±í•™êµ 6í•™ë…„'};
const GRADE_TO_AGE=Object.fromEntries(Object.entries(AGE_TO_GRADE).map(([a,g])=>[g,a]));
const CAMPUSES=['ì••êµ¬ì •[ë³¸ì›]','ë°˜í¬ ìº í¼ìŠ¤','í•œë‚¨ ìº í¼ìŠ¤','ë°©ë°° ìº í¼ìŠ¤','ëª©ë™ ìº í¼ìŠ¤','ì†¡íŒŒ ìº í¼ìŠ¤','ì„œëŒ€ë¬¸ ìº í¼ìŠ¤','ì¼ì‚° ìº í¼ìŠ¤','íƒ„í˜„ ìº í¼ìŠ¤','ê¹€í¬ ìº í¼ìŠ¤','ì†¡ë„ ìº í¼ìŠ¤','ë¶€ì‚° ìº í¼ìŠ¤'];

function viewProfile(){
  app().innerHTML=`<h2 class="center">í”„ë¡œí•„ ì •ë³´</h2>
  <div class="grid grid-4" style="margin-top:8px">
    <div class="section"><label>ì•„ë™ ì´ë¦„</label><input id="cname" placeholder="ì˜ˆ: í™ê¸¸ë™"></div>
    <div class="section"><label>ë³´í˜¸ì ì´ë¦„</label><input id="gname" placeholder="ì˜ˆ: ê¹€ë³´í˜¸ì"></div>
    <div class="section"><label>ë‚˜ì´</label><select id="age">${[7,8,9,10,11,12].map(a=>`<option value="${a}">${a}</option>`).join('')}</select></div>
    <div class="section"><label>í•™ë…„</label><select id="grade">${Object.values(AGE_TO_GRADE).map(g=>`<option>${g}</option>`).join('')}</select></div>
    <div class="section"><label>ì—°ë½ì²˜</label><input id="phone" placeholder="010-0000-0000"></div>
    <div class="section"><label>ì´ë©”ì¼(ì„ íƒ, ê²°ê³¼ì§€ ì „ì†¡ìš©)</label><input id="email" placeholder="example@email.com"></div>
    <div class="section"><label>ìº í¼ìŠ¤</label><select id="campus">${CAMPUSES.map(c=>`<option value="${c}">${c}</option>`).join('')}</select></div>
  </div>
  <div class="center" style="margin-top:16px"><button class="btn btn-mint" id="btn_starttest">í…ŒìŠ¤íŠ¸ ì‹œì‘</button></div>`;
  $('age').addEventListener('change',e=>{$('grade').value=AGE_TO_GRADE[e.target.value]});
  $('grade').addEventListener('change',e=>{$('age').value=GRADE_TO_AGE[e.target.value]});
  $('btn_starttest').onclick=startTest;
}
async function startTest(){
  STATE.profile={child_name:$('cname').value.trim(),guardian:$('gname').value.trim(),age:$('age').value,grade:$('grade').value,phone:$('phone').value.trim(),email:$('email').value.trim(),campus:$('campus').value};
  if(!STATE.profile.child_name){alert('ì•„ë™ ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”');return;}
  if(!/^0\d{1,2}-?\d{3,4}-?\d{4}$/.test(STATE.profile.phone||'')){alert('ì—°ë½ì²˜ í˜•ì‹(010-0000-0000)ì„ í™•ì¸í•´ ì£¼ì„¸ìš”');return;}
  await loadQuestions();STATE.idx=0;STATE.answers=[];STATE.step='test';render();
}

/* í…ŒìŠ¤íŠ¸ â€“ ì •ì‚¬ê° ì¸ë„¤ì¼ í†µì¼ */
function pcGridClassFor(n){if(window.matchMedia('(min-width:1024px)').matches){return n===2?'test-grid-2':'test-grid-4'}return'grid grid-2'}
function optionImageUrl(q,o){if(o.imageUrl)return o.imageUrl;const num=Number(q.order)||(STATE.idx+1);return `${ASSET_BASE}/${num}-${o.key}.png`}
function viewTest(){
  const q=STATE.questions[STATE.idx];if(!q){app().innerHTML='<h3 class="center">ë¬¸í•­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì— ë¬¸ì˜í•´ ì£¼ì„¸ìš”.</h3>';return;}
  const gridCls=pcGridClassFor(q.options.length);
  app().innerHTML=`<div class="center small muted"><span class="chip">Q ${STATE.idx+1} / ${STATE.questions.length}</span></div>
    <h2 class="center" style="margin-top:10px">${q.prompt||''}</h2>
    <div class="${gridCls}" style="margin-top:12px">
      ${q.options.map(o=>`<div class="opt" id="opt_${o.key}" tabindex="0" role="button" aria-label="${o.label||o.key}" data-key="${o.key}">
        <div class="thumb"><img src="${optionImageUrl(q,o)}" alt="${o.label||o.key}" onerror="this.style.opacity=.2" loading="lazy"></div>
        <div class="cap center">${o.label||o.key}</div>
      </div>`).join('')}
    </div>
    <div class="center" style="margin-top:18px;display:flex;gap:10px;justify-content:center">
      <button class="btn-ghost" id="btn_prev" ${STATE.idx===0?'disabled':''}>ì´ì „</button>
      <button class="btn" id="btn_next" disabled>ë‹¤ìŒ</button>
    </div>`;
  q.options.forEach(o=>{const el=document.getElementById(`opt_${o.key}`);el.onclick=()=>choose(o.key);el.onkeydown=e=>{if(e.key==='Enter'||e.key===' ')choose(o.key)}});
  $('btn_prev').onclick=prev;$('btn_next').onclick=next;
}
function choose(key){
  const q=STATE.questions[STATE.idx];
  q.options.forEach(k=>{const n=document.getElementById(`opt_${k.key}`);if(n)n.classList.remove('sel')});
  const node=document.getElementById(`opt_${key}`);if(node){node.classList.add('sel');node.animate([{transform:'scale(1)'},{transform:'scale(.98)'},{transform:'scale(1)'}],{duration:160})}
  const opt=q.options.find(o=>o.key===key);STATE.answers[STATE.idx]={qid:q.id,key,weights:opt.weights||{}};$('btn_next').disabled=false;
}
function next(){if(STATE.step!=='test')return;if(!STATE.answers[STATE.idx]){alert('í•˜ë‚˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”');return;}if(STATE.idx<STATE.questions.length-1){STATE.idx++;render();}else{submitAllSafe();}}
function prev(){if(STATE.idx>0){STATE.idx--;render();}}
document.addEventListener('keydown',e=>{if(STATE.step!=='test')return;if(e.key==='ArrowRight')next();if(e.key==='ArrowLeft')prev();if(e.key==='Enter'){if(!$('btn_next').disabled)next();}});

/* ì ìˆ˜/ë©˜íŠ¸ â€“ ê°•í™”ëœ ê°€ì¤‘ì¹˜/ê³¡ì„  ë³´ì • */
function aggregateScores(ans){
  const sum={}, touch={};
  DOMAINS.forEach(d=>{sum[d]=0;touch[d]=0});
  ans.forEach(a=>{
    Object.entries(a.weights||{}).forEach(([k,v])=>{
      const w=Math.max(0,Number(v||0));
      if(w<=0) return;
      const amplified=Math.pow(Math.min(1,w),1.35)*1.3; // ì¦í­
      sum[k]+=amplified;
      touch[k]+=1;
    });
  });
  const n=ans.length||1;
  const raw={};
  DOMAINS.forEach(d=>{
    const base=(sum[d]/n)*4;
    const consistency=(touch[d]/n)*0.6; // ì¼ê´€ì„± ë³´ë„ˆìŠ¤
    const v=Math.min(4,Math.max(0,Math.round((base+consistency)*10)/10));
    raw[d]=v;
  });
  return raw;
}
// ìƒìœ„ êµ¬ê°„ ë¶€ê°
const adjust=v=>{
  const ratio=v/4;
  const curved = v*1.12 + Math.pow(Math.max(0,ratio-0.5),1.2)*1.0;
  return Math.max(0, Math.min(4, Math.round(curved*10)/10));
};
function band(v){if(v>=3.6)return'S';if(v>=3.2)return'A';if(v>=2.8)return'A-';if(v>=2.4)return'B+';if(v>=2.0)return'B';if(v>=1.6)return'B-';if(v>=1.0)return'C+';return'C'}

const DETAIL={
  'ê´€ì°°ë ¥':n=>`${n}ë‹˜ì€ êµ¬ì¡°Â·í˜•íƒœì˜ í•µì‹¬ì„ ë¹ ë¥´ê²Œ í¬ì°©í•©ë‹ˆë‹¤. ì‘ì€ ì°¨ì´ì™€ ê·œì¹™ì„ ì½ì–´ í‘œí˜„ ë°€ë„ë¥¼ ë†’ì´ëŠ” ëŠ¥ë ¥ì´ ë‹ë³´ì…ë‹ˆë‹¤.`,
  'ìƒ‰ê°ê°':n=>`${n}ë‹˜ì€ ìƒ‰ì˜ ë¶„ìœ„ê¸°Â·ì˜¨ë„Â·ëª…ë„ ëŒ€ë¹„ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë‹¤ë£¹ë‹ˆë‹¤. ë¯¸ë¬˜í•œ í†¤ ì°¨ì´ê¹Œì§€ ì„¬ì„¸í•˜ê²Œ ê°ì§€í•©ë‹ˆë‹¤.`,
  'ì„œì‚¬ë ¥':n=>`${n}ë‹˜ì€ ì¥ë©´ ì† ê°ì •ê³¼ ì‚¬ê±´ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•´ ì´ì•¼ê¸°ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤. ë³´ëŠ” ì´ë¥¼ ëŒì–´ë‹¹ê¸°ëŠ” í˜ì´ ìˆì–´ìš”.`,
  'ê³µê°„ê°':n=>`${n}ë‹˜ì€ ì›ê·¼Â·ìŠ¤ì¼€ì¼Â·ì‹œì  ì „í™˜ì„ ìœ ì—°í•˜ê²Œ ì‚¬ìš©í•˜ì—¬ ì¥ë©´ì˜ ê¹Šì´ë¥¼ ì„¤ë“ë ¥ ìˆê²Œ êµ¬ì„±í•©ë‹ˆë‹¤.`,
  'ë””í…Œì¼':n=>`${n}ë‹˜ì€ ì§ˆê°Â·íŒ¨í„´Â·ë§ˆê°ì— ì§‘ì¤‘í•˜ì—¬ ì™„ì„±ë„ë¥¼ ëŒì–´ì˜¬ë¦½ë‹ˆë‹¤. ëª°ì…ê³¼ ì§‘ì¤‘ì§€ì†ì´ ê°•ì ì…ë‹ˆë‹¤.`,
  'ë„ì „ì„±':n=>`${n}ë‹˜ì€ ìƒˆ ì¬ë£ŒÂ·ë°©ì‹ì„ ì£¼ì €í•˜ì§€ ì•Šê³  ì‹¤í—˜í•©ë‹ˆë‹¤. ì‹¤íŒ¨ë¥¼ í•™ìŠµìœ¼ë¡œ ì „í™˜í•˜ëŠ” íƒœë„ê°€ ë›°ì–´ë‚©ë‹ˆë‹¤.`,
  'ì†Œí†µë ¥':n=>`${n}ë‹˜ì€ ì˜ë„Â·ê³¼ì •ì„ ë§ê³¼ ì‹œê° ìš”ì†Œë¡œ ì„¤ë“ë ¥ ìˆê²Œ ì„¤ëª…í•©ë‹ˆë‹¤. í”¼ë“œë°± ìˆ˜ìš©ë ¥ë„ ì¢‹ì€ í¸ì…ë‹ˆë‹¤.`,
  'ê¾¸ì¤€ì„±':n=>`${n}ë‹˜ì€ ë£¨í‹´ì„ ìœ ì§€í•˜ê³  ëê¹Œì§€ ë°€ì–´ë¶™ì´ëŠ” í˜ì´ ìˆìŠµë‹ˆë‹¤. ì ì§„ì  í–¥ìƒì— ìµœì í™”ëœ ìœ í˜•ì…ë‹ˆë‹¤.`
};

/* ì´ë¡ /ì „ë¬¸ê°€/ë°œë‹¬ë°©í–¥ â€” ê° ì˜ì—­ë³„ 5~6ì¤„ ë¶„ëŸ‰, ì „ë¶€ ìƒì´í•œ ë‚´ìš© */
const THEORY={
  'ìƒ‰ê°ê°':{
    theoryTitle:'Itten ìƒ‰ì±„ì´ë¡ ',
    theory:'ìƒ‰ì±„ì§€ê°ì€ ìƒ‰ìƒÂ·ëª…ë„Â·ì±„ë„ì˜ 3ìš”ì†Œ ìƒí˜¸ì‘ìš©ìœ¼ë¡œ ì„±ë¦½í•©ë‹ˆë‹¤. íŠ¹íˆ ë™ì‹œì— ë°°ì¹˜ëœ ìƒ‰ì€ ìƒí˜¸ ëŒ€ë¹„ë¥¼ ì¼ìœ¼ì¼œ ì£¼ê´€ì  ë°ê¸°ì™€ ì±„ë„ ì²´ê°ì´ ë‹¬ë¼ì§€ë©°, ì´ íš¨ê³¼ëŠ” í™”ë©´ì˜ ë¬´ê²Œì¤‘ì‹¬ê³¼ ì‹¬ë¦¬ì  ì˜¨ë„ë¥¼ í•¨ê»˜ ë°”ê¿‰ë‹ˆë‹¤. ë”°ëœ»í•¨/ì°¨ê°€ì›€ì˜ ì¶•ê³¼ ë³´ìƒ‰ê´€ê³„ëŠ” ì‹œì„ ì˜ íë¦„ì„ ì„¤ê³„í•˜ëŠ” ë° í•µì‹¬ ì§€ë ›ëŒ€ê°€ ë©ë‹ˆë‹¤. ë˜í•œ ì±„ë„ ì œí•œê³¼ ì¤‘ê°„ìƒ‰ í˜¼í•©ì€ ê³¼ë„í•œ ìê·¹ì„ ì •ë¦¬í•´ ì£¼ì œë¥¼ ë¶€ê°ì‹œí‚µë‹ˆë‹¤. ê²°êµ­ ì¢‹ì€ íŒ”ë ˆíŠ¸ëŠ” â€˜ì„ íƒâ€™ê³¼ â€˜ì ˆì œâ€™ì˜ ê·œì¹™ì„ í†µí•´ ë§¥ë½ì„ ë§Œë“œëŠ” ì¼ì…ë‹ˆë‹¤.',
    expert:'ìƒ‰ì„ ì˜ ì“°ëŠ” í•™ìƒì€ ê´€ì°°ëœ ì •ë³´ë¥¼ ê°ì •ì  ì–¸ì–´ë¡œ ë²ˆì—­í•˜ëŠ” ì†ë„ê°€ ë¹ ë¦…ë‹ˆë‹¤. íŒ”ë ˆíŠ¸ê°€ ê°„ê²°í• ìˆ˜ë¡ ì£¼ì œì™€ ë°°ê²½ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë¶„ë¦¬ë˜ì–´, ì „ë‹¬ë ¥ì´ ë†’ì•„ì§€ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ê³¼ì œ ì´ˆë°˜ì—ëŠ” ì£¼ì¡°ìƒ‰ê³¼ ë³´ì¡°ìƒ‰ì„ ë¨¼ì € ê³ ë¥´ê³ , ë‚˜ë¨¸ì§€ëŠ” ì´ ë‘ ìƒ‰ì˜ ë³€ì£¼ë¡œ í•´ê²°í•´ ë³´ì„¸ìš”. ì´ ë°©ì‹ì€ íƒìƒ‰ ì‹œê°„ì„ ì¤„ì´ê³  ì¼ê´€ëœ ë¶„ìœ„ê¸°ë¥¼ ìœ ì§€í•˜ê²Œ ë„ì™€ì¤ë‹ˆë‹¤. ìƒ‰ì˜ ì„±ê²©ì„ ë§ë¡œ ì„¤ëª…í•˜ê²Œ í•˜ë©´ ìŠ¤ìŠ¤ë¡œì˜ ì„ íƒ ê¸°ì¤€ë„ ì •êµí•´ì§‘ë‹ˆë‹¤.',
    direction:'1) 3ìƒ‰ ì œí•œ íŒ”ë ˆíŠ¸ë¡œ ì‹œì‘í•´ í†¤ ë³€ì£¼ë§Œìœ¼ë¡œ ì¥ë©´ì„ ì™„ì„±í•´ ë´…ë‹ˆë‹¤. 2) ì‚¬ì§„ì´ë‚˜ ì‹¤ë¬¼ì„ ìƒ‰ì¹©ìœ¼ë¡œ ë¶„í•´í•´ ëª…ë„ ìŠ¤ì¼€ì¼ì„ ë¨¼ì € ì •í•˜ê³ , ì±„ë„ëŠ” ì ˆë°˜ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤. 3) ë™ì¼ í”¼ì‚¬ì²´ë¥¼ ë”°ëœ»/ì°¨ê°€ìš´ ë²„ì „ìœ¼ë¡œ ê°ê° ì œì‘í•˜ì—¬ ì‹¬ë¦¬ì  ì˜¨ë„ ì°¨ì´ë¥¼ ë¹„êµí•©ë‹ˆë‹¤. 4) ë³´ìƒ‰ì„ ì“¸ ë•ŒëŠ” ë©´ì ì„ 7:3 ì •ë„ë¡œ ë¹„ëŒ€ì¹­ ë°°ì¹˜í•˜ì—¬ ì£¼ì¡°ìƒ‰ì˜ í˜ì„ ì§€í‚¤ì„¸ìš”. 5) ì‘ì—… í›„ ìƒ‰ ì¡°í•© ì˜ë„ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ê¸°ë¡í•´ ë‹¤ìŒ ì‘ì—…ì— ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.'
  },
  'ë””í…Œì¼':{
    theoryTitle:'ëª°ì…ê³¼ ì£¼ì˜ì§‘ì¤‘',
    theory:'ì„¸ë¶€ ë¬˜ì‚¬ëŠ” í˜•íƒœÂ·ë¹›Â·ì¬ì§ˆì˜ ìƒí˜¸ì‘ìš©ì„ ë¯¸ì‹œì ìœ¼ë¡œ íŒŒì•…í•˜ëŠ” ëŠ¥ë ¥ì—ì„œ ì¶œë°œí•©ë‹ˆë‹¤. ì¸ê°„ì˜ ì£¼ì˜ëŠ” ì œí•œì ì´ë¯€ë¡œ, í° êµ¬ì¡°ë¥¼ í™•ì •í•œ ë’¤ ì„¸ë¶€ë¡œ ë‚´ë ¤ê°€ëŠ” â€˜ìœ„ê³„ì  ì²˜ë¦¬â€™ê°€ íš¨ìœ¨ì ì…ë‹ˆë‹¤. ë˜í•œ ë™ì¼ íŒ¨í„´ì˜ ë°˜ë³µì€ ë¦¬ë“¬ì„ ë§Œë“¤ì§€ë§Œ, ê°„ê²©ê³¼ í¬ê¸°ì˜ ë¯¸ì„¸í•œ ë³€ì£¼ê°€ ì—†ìœ¼ë©´ ê¸°ê³„ì  ì¸ìƒë§Œ ë‚¨ìŠµë‹ˆë‹¤. ë””í…Œì¼ì€ ë§ê³  ì ìŒì˜ ë¬¸ì œê°€ ì•„ë‹ˆë¼, ê°•ì¡°ì  ì£¼ë³€ì—ì„œì˜ â€˜ë°€ë„ ëŒ€ë¹„â€™ë¥¼ í†µí•´ ì˜ë¯¸ë¥¼ ë§Œë“¤ ë•Œ í˜ì„ ê°–ìŠµë‹ˆë‹¤.',
    expert:'ì„¸ë°€í•¨ì´ ê°•ì ì¸ í•™ìƒì€ ì™„ì„±ë„ì™€ ì‹ ë¢°ê°ì„ ë™ì‹œì— ì „ë‹¬í•©ë‹ˆë‹¤. ë‹¤ë§Œ ì „ì²´ì™€ ë¶€ë¶„ì˜ ê· í˜•ì´ í”ë“¤ë¦¬ë©´ íë¦„ì´ ëŠê¸¸ ìˆ˜ ìˆê¸°ì—, í™•ëŒ€ ì „ ë°˜ë“œì‹œ 3ë‹¨ê³„(í° ë©´â†’ì¤‘ê°„ ë¸”ë¡â†’ì„¸ë¶€) ì²´í¬ë¥¼ ìŠµê´€í™”í•˜ì„¸ìš”. ì§ˆê° í‘œí˜„ì€ ê´‘ì› ë°©í–¥, ë°˜ì‚¬ê´‘ì˜ ê²½ë„, ì—£ì§€ì˜ ë‚ /ë¬´ êµ¬ë¶„ë§Œ ì •í™•í•˜ë©´ 70%ê°€ í•´ê²°ë©ë‹ˆë‹¤. ë§ˆê° ì‹œ ë¶ˆí•„ìš”í•œ ì •ë³´ëŠ”æœæ–­íˆ ë¹„ì›Œ ëŒ€ë¹„ë¥¼ í™•ë³´í•´ì•¼ í•µì‹¬ì´ ì‚´ì•„ë‚©ë‹ˆë‹¤.',
    direction:'1) ì‹œì‘ 10ë¶„ ë™ì•ˆì€ ì„¸ë¶€ ê¸ˆì§€, í° í†¤ê³¼ ì‹¤ë£¨ì—£ë§Œ í™•ì •í•©ë‹ˆë‹¤. 2) ì£¼ì œ ì£¼ë³€ 1/3 ì˜ì—­ì—ë§Œ ê³ ë°€ë„ ë””í…Œì¼ì„ ì§‘ì¤‘í•˜ê³ , ì£¼ë³€ë¶€ëŠ” ì˜ë„ì ìœ¼ë¡œ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤. 3) ì¬ì§ˆ ë…¸íŠ¸(ë§¤íŠ¸/ê¸€ë¡œì‹œ/ê±°ì¹ ê¸°)ë¥¼ ë§Œë“¤ì–´ ê°™ì€ í”¼ì‚¬ì²´ë¼ë„ ê´‘ì›ì— ë”°ë¼ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ ê¸°ë¡í•©ë‹ˆë‹¤. 4) ë§ˆì§€ë§‰ 5ë¶„ì—ëŠ” â€œì§€ìš¸ ë””í…Œì¼ 3ê°œâ€ë¥¼ ì°¾ì•„ ì œê±°í•´ ì¤‘ì‹¬ì„ ì •ë¦¬í•˜ì„¸ìš”. 5) ì „/í›„ ì‚¬ì§„ì„ ë¹„êµí•´ ë°€ë„ ëŒ€ë¹„ê°€ ì‹œì„ ì„ ì•ˆë‚´í•˜ëŠ”ì§€ ì ê²€í•©ë‹ˆë‹¤.'
  },
  'ì„œì‚¬ë ¥':{
    theoryTitle:'ì„œì‚¬ì  ì‹œê°í™”',
    theory:'ì´ì•¼ê¸°ëŠ” ëª©í‘œë¥¼ ê°€ì§„ ì¸ë¬¼ì´ ê°ˆë“±ì„ ê²ªê³  ë³€í™”ë¥¼ ë§ëŠ” êµ¬ì¡°ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ì‹œê° ì„œì‚¬ëŠ” í”„ë ˆì„ êµ¬ì„±, ì¹´ë©”ë¼ ì‹œì , ì‹œê°„ ì••ì¶•Â·í™•ì¥, ì‹œì„  ìœ ë„ ì¥ì¹˜ë¡œ ì˜ë¯¸ë¥¼ ë§Œë“­ë‹ˆë‹¤. í…ìŠ¤íŠ¸ ì—†ì´ë„ ì¸ê³¼ê°€ ì½íˆë ¤ë©´ â€˜ì „Â·ì¤‘Â·í›„â€™ì˜ ë‹¨ì„œê°€ í™”ë©´ì— ë¶„ëª…í•´ì•¼ í•©ë‹ˆë‹¤. ë˜ ìƒì§•ê³¼ ë©”íƒ€í¬ì˜ ì‚¬ìš©ì€ ê³¼ì‰ ì„¤ëª…ì„ ì¤„ì´ë©´ì„œ ê°ì •ì˜ ì—¬ìš´ì„ ë‚¨ê¹ë‹ˆë‹¤. ì¢‹ì€ ì„œì‚¬ëŠ” ê´€ê°ì´ ë¹ˆì¹¸ì„ ì±„ìš°ë„ë¡ ìë¦¬ë¥¼ ë¹„ì›Œë‘¡ë‹ˆë‹¤.',
    expert:'ì¥ë©´ì„ ë§Œë“¤ ë•Œ â€œëˆ„ê°€/ë¬´ì—‡ì„/ì™œâ€ë¥¼ ë¨¼ì € ê²°ì •í•˜ë©´ ì„ íƒì´ ë¹¨ë¼ì§‘ë‹ˆë‹¤. ì£¼ì¸ê³µì˜ ê°ì •ì„ ì´ ëª…í™•í• ìˆ˜ë¡ ìƒ‰Â·êµ¬ë„Â·ì§ˆê° ê°™ì€ í˜•ì‹ ìš”ì†Œë„ ìì—°íˆ í†µì¼ë©ë‹ˆë‹¤. ì»· ì „í™˜ì€ ì´ë™Â·ì‹œì Â·ì‹œê°„ ë³€í™” ì¤‘ í•œ ê°€ì§€ ì´ìœ ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•©ë‹ˆë‹¤. ì„¤ëª…ì„ ì¤„ì´ê³  í–‰ë™ê³¼ ê²°ê³¼ì˜ ë‹¨ì„œë¡œ ë§í•˜ë„ë¡ ì—°ìŠµí•´ ë³´ì„¸ìš”. ë°œí‘œ ë•ŒëŠ” ì˜ë„ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•´ ë§í•˜ë©´ ë˜ë˜ì˜ í”¼ë“œë°± í’ˆì§ˆë„ ë†’ì•„ì§‘ë‹ˆë‹¤.',
    direction:'1) 4ì»· êµ¬ì„±ìœ¼ë¡œ ì‹œì‘í•˜ë˜, ê° ì»·ì— â€œê°ˆë“±â†’í–‰ë™â†’ê²°ê³¼â†’ì—¬ìš´â€ì„ ë°°ì¹˜í•©ë‹ˆë‹¤. 2) ì£¼ì¸ê³µì˜ ê°ì • ë³€í™”ë¥¼ 3ë‹¨ê³„ ìƒ‰ ìŠ¤ì¼€ì¼ë¡œ ì•½ì†í•´ ì¼ê´€ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤. 3) ìƒì§• ì˜¤ë¸Œì íŠ¸ 1ê°œë¥¼ ì •í•´ ë°˜ë³µ ë“±ì¥ì‹œí‚¤ë©° ì˜ë¯¸ë¥¼ ì¶•ì í•©ë‹ˆë‹¤. 4) ìµœì¢… ë°œí‘œ ì „, ë³¸ì¸ì´ ì—†ëŠ” ìƒíƒœì—ì„œë„ ì´ì•¼ê¸° íë¦„ì´ ì½íˆëŠ”ì§€ ì¹œêµ¬ì—ê²Œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. 5) ë‹¤ìŒ ì‘ì—…ì„ ìœ„í•œ â€œí•œ ì¤„ ë¡œê·¸ë¼ì¸â€ì„ ë°˜ë“œì‹œ ê¸°ë¡í•©ë‹ˆë‹¤.'
  },
  'ê³µê°„ê°':{
    theoryTitle:'ì§€ê°ì‹¬ë¦¬ì™€ ì›ê·¼',
    theory:'ê³µê°„ê°ì€ í¬ê¸°Â·ê²¹ì¹¨Â·ì„ í˜• ì›ê·¼Â·ê³µê¸° ì›ê·¼ ë“± ë³µí•©ì  ë‹¨ì„œì˜ í†µí•©ìœ¼ë¡œ í˜•ì„±ë©ë‹ˆë‹¤. ì§€í‰ì„ ê³¼ ì†Œì‹¤ì ì˜ ìœ„ì¹˜ëŠ” ê´€ëŒìì˜ ëˆˆë†’ì´ë¥¼ ê·œì •í•˜ê³ , ì „ê²½/ì¤‘ê²½/í›„ê²½ì˜ ëŒ€ë¹„ëŠ” ê¹Šì´ë¥¼ ì²´ê°ì‹œí‚¤ëŠ” í•µì‹¬ ì¥ì¹˜ì…ë‹ˆë‹¤. ë˜í•œ ê°’ì˜ ëŒ€ë¹„ê°€ ê±°ë¦¬ íŒë‹¨ì— ê²°ì •ì ì´ì–´ì„œ, ë©€ìˆ˜ë¡ ëª…ë„ ëŒ€ë¹„ê°€ ì¤„ê³  ìƒ‰ì±„ê°€ ë¬´ì±„í™”ë˜ëŠ” ê²½í–¥ì„ ë³´ì…ë‹ˆë‹¤. ì¹´ë©”ë¼ ë Œì¦ˆì— ë”°ë¥¸ ì™œê³¡ ì´í•´ëŠ” ê³¼ì¥ëœ ì‹œì  ì—°ì¶œì—ë„ ìœ ìš©í•©ë‹ˆë‹¤.',
    expert:'ê³µê°„ì„ ì„¤ë“ë ¥ ìˆê²Œ ë§Œë“¤ë ¤ë©´ â€œë¨¼ì € ë°”ë‹¥ì„ ê¹ë‹¤â€ëŠ” ë§ˆìŒìœ¼ë¡œ í° ë©´ì„ ì •ë¦¬í•˜ì„¸ìš”. ê·¸ ë‹¤ìŒì— êµ¬ì¡°ì„ ì„ ìµœì†Œí•œìœ¼ë¡œë§Œ ì‚¬ìš©í•´ ë°©í–¥ì„±ì„ ì œì‹œí•˜ë©´ ê³¼ë„í•œ ì„ ë§›ì„ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì „ê²½ì˜ ë””í…Œì¼ì€ ê°•ì¡°í•˜ë˜, ì¤‘Â·í›„ê²½ì€ í˜•íƒœë§Œ ì•”ì‹œí•´ ì‹œì„ ì˜ ë„ì°©ì ì„ í™•ë³´í•©ë‹ˆë‹¤. ì‹¤ë‚´ë¼ë©´ ëˆˆë†’ì´ì™€ ìˆ˜ì§ì˜ ìˆ˜í‰ ì—¬ë¶€ë¥¼ ë¨¼ì € ì²´í¬í•˜ê³ , ì‹¤ì™¸ë¼ë©´ ëŒ€ê¸° ì›ê·¼ì„ ìƒ‰ìœ¼ë¡œ í†µì œí•´ ë³´ì„¸ìš”. êµ¬ë„ ì„ íƒì€ ì´ì•¼ê¸°ê°€ ìš”êµ¬í•˜ëŠ” ê°ì •ê³¼ ì§ê²°ë©ë‹ˆë‹¤.',
    direction:'1) 1Â·2ì†Œì‹¤ì  ë°•ìŠ¤ ë“œë¡œì‰ìœ¼ë¡œ ê°€êµ¬/ê±´ë¬¼ ë¸”ë¡ì„ ë¹ ë¥´ê²Œ ì„¸ì›ë‹ˆë‹¤. 2) ì „Â·ì¤‘Â·í›„ë¥¼ 60:30:10 ë¹„ìœ¨ë¡œ ë©´ì  ë¶„ë°°í•˜ì—¬ ì‹œì„  ë™ì„ ì„ ì„¤ê³„í•©ë‹ˆë‹¤. 3) ëŒ€ê¸° ì›ê·¼ì„ ìœ„í•´ í›„ê²½ ì±„ë„ë¥¼ 30~50% ë‚®ì¶”ê³ , ì—£ì§€ëŠ” ë¶€ë“œëŸ½ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. 4) ê°™ì€ ì¥ë©´ì„ ë†’ì€ ì‹œì Â·ë‚®ì€ ì‹œì ìœ¼ë¡œ ê°ê° ê·¸ë ¤ ê°ì • ì°¨ì´ë¥¼ ë¹„êµí•©ë‹ˆë‹¤. 5) ì‚¬ì§„ ì°¸ê³  ì‹œ ë Œì¦ˆ ì´ˆì ê±°ë¦¬ ì •ë³´ë¥¼ í•¨ê»˜ ê¸°ë¡í•´ ì™œê³¡ì„ ì˜ì‹ì ìœ¼ë¡œ í™œìš©í•˜ì„¸ìš”.'
  },
  'ê´€ì°°ë ¥':{
    theoryTitle:'ê²ŒìŠˆíƒˆíŠ¸ì™€ êµ¬ì¡° ì¸ì§€',
    theory:'ê²ŒìŠˆíƒˆíŠ¸ ì›ë¦¬ëŠ” ì¸ê°„ì´ ë¶€ë¶„ë³´ë‹¤ ì „ì²´ íŒ¨í„´ì„ ìš°ì„  ì¸ì‹í•œë‹¤ëŠ” ê´€ì ì„ ì œì‹œí•©ë‹ˆë‹¤. ë¯¸ìˆ ì—ì„œ ê´€ì°°ë ¥ì€ ì „ì²´ í˜•ì„ ë¨¼ì € ê°ì§€í•œ ë’¤ í•µì‹¬ íŠ¹ì§•ì„ ì¶”ë ¤ êµ¬ì¡°í™”í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ëª…ì•”ì˜ í° ë©ì–´ë¦¬ë¥¼ êµ¬ë¶„í•˜ê³ , ê¸°ì¤€ ê°ê³¼ ë¹„ë¡€ë¥¼ ë¹ ë¥´ê²Œ ì¡ëŠ” ìŠµê´€ì´ ì •í™•ë„ì˜ 8í• ì„ ì¢Œìš°í•©ë‹ˆë‹¤. ë˜í•œ ê´€ì°°ì€ ë‹¨ìˆœí•œ ë³µì œê°€ ì•„ë‹ˆë¼, ì¤‘ìš”í•œ ê²ƒê³¼ ë¶€ì°¨ì ì¸ ê²ƒì„ ë¶„ë¦¬í•˜ëŠ” íŒë‹¨ í–‰ìœ„ì…ë‹ˆë‹¤.',
    expert:'ê´€ì°°ì´ ì¢‹ì€ í•™ìƒì€ â€œë³´ì´ëŠ” ëŒ€ë¡œ ê·¸ë¦¬ê¸°â€ë¥¼ ë„˜ì–´ â€œë³´ì—¬ì¤„ ê²ƒì„ ê³ ë¥´ëŠ”â€ í˜ì´ ìˆìŠµë‹ˆë‹¤. ì‹¤ë¬¼ ê´€ì°° ì‹œì—ëŠ” ì‹œì„ ì„ ê³ ì •í•˜ê³ , íœì„ ì¢…ì´ì—ì„œ ë–¼ì§€ ì•ŠëŠ” ì—°ì†ì„  ìŠ¤ì¼€ì¹˜ë¥¼ 2~3ë¶„ ìœ ì§€í•´ ë³´ì„¸ìš”. ì´ë ‡ê²Œ í•˜ë©´ í˜•íƒœ ë‹¨ìˆœí™”ì™€ ë¦¬ë“¬ì´ ë™ì‹œì— ìƒê¹ë‹ˆë‹¤. ë™ì¼ ëŒ€ìƒì„ ë‹¤ë¥¸ ê´‘ì›ì—ì„œ ë°˜ë³µ ê´€ì°°í•˜ëŠ” í›ˆë ¨ì€ ì…ì²´ ì‚¬ê³ ë¥¼ ê°•í™”í•©ë‹ˆë‹¤. ê´€ì°° ë…¸íŠ¸ì— ìˆ«ìÂ·í™”ì‚´í‘œÂ·ê°„ë‹¨í•œ ë‹¨ì–´ë¥¼ ê³ë“¤ì—¬ ì‹œê°-ì–¸ì–´ ì—°ê²°ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”.',
    direction:'1) ì‹œì‘ 3ë¶„ ì œìŠ¤ì²˜ ìŠ¤ì¼€ì¹˜ë¡œ ì „ì²´ ë¹„ë¡€ë¥¼ ì¡ìŠµë‹ˆë‹¤. 2) ëª…ì•”ì„ 3ë‹¨ê³„ë¡œë§Œ ë‚˜ëˆ„ì–´ í° ë©ì–´ë¦¬ë¶€í„° ì¹ í•©ë‹ˆë‹¤. 3) ê¸°ì¤€ ê° 3ê°œ(ìˆ˜ì§/ìˆ˜í‰/ëŒ€ê°)ë¥¼ ë¨¼ì € í‘œì‹œí•´ í‹€ì–´ì§ì„ ì¤„ì…ë‹ˆë‹¤. 4) ê°™ì€ ëŒ€ìƒì„ ì•„ì¹¨/ì •ì˜¤/ì €ë… ë¹›ì—ì„œ ê°ê° ìŠ¤ì¼€ì¹˜í•©ë‹ˆë‹¤. 5) ë§ˆì§€ë§‰ì— â€œí•µì‹¬ íŠ¹ì§• 3ê°œâ€ë¥¼ ê¸€ë¡œ ìš”ì•½í•´ ë‹¤ìŒ ê´€ì°°ì— ì°¸ê³ í•˜ì„¸ìš”.'
  },
  'ë„ì „ì„±':{
    theoryTitle:'ì„±ì¥ ë§ˆì¸ë“œì…‹',
    theory:'ì„±ì¥í˜• ë§ˆì¸ë“œì…‹ì€ ëŠ¥ë ¥ì„ ê³ ì •ê°’ì´ ì•„ë‹Œ ê°€ë³€ê°’ìœ¼ë¡œ ë³´ë©°, ë…¸ë ¥Â·ì „ëµÂ·í”¼ë“œë°±ì„ í†µí•´ ê°œì„ ëœë‹¤ê³  ë¯¿ëŠ” íƒœë„ì…ë‹ˆë‹¤. ë¯¸ìˆ ì—ì„œ ë„ì „ì„±ì€ ìƒˆë¡œìš´ ë„êµ¬Â·ì¬ë£ŒÂ·ë°©ë²•ì„ íƒìƒ‰í•˜ëŠ” í–‰ë™ìœ¼ë¡œ ë“œëŸ¬ë‚©ë‹ˆë‹¤. ì‹¤íŒ¨ì˜ ì›ì¸ì„ ê¸°ë¡í•˜ê³  ë‹¤ìŒ ì‹œë„ì—ì„œ ë³€ì¸ì„ í†µì œí•˜ëŠ” ìŠµê´€ì€ í•™ìŠµ íš¨ìœ¨ì„ í¬ê²Œ ë†’ì…ë‹ˆë‹¤. ì‹¤í—˜ì€ ë¬´ì‘ìœ„ê°€ ì•„ë‹ˆë¼ ê°€ì„¤â†’í…ŒìŠ¤íŠ¸â†’ì •ë¦¬ì˜ êµ¬ì¡°ë¥¼ ê°€ì§ˆ ë•Œ ì˜ë¯¸ê°€ ìƒê¹ë‹ˆë‹¤.',
    expert:'ë„ì „ì„±ì´ ë†’ì€ í•™ìƒì€ ì‘ì—… ì´ˆë°˜ì˜ ëª¨í˜¸í•¨ì„ ì˜ ê²¬ë”¥ë‹ˆë‹¤. ì¤‘ìš”í•œ ê²ƒì€ â€œì‹¤í—˜ì˜ ëª©ì â€ì„ í•œ ì¤„ë¡œ ì ê³  ì‹œì‘í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì‹¤í—˜ ê²°ê³¼ê°€ ë§ˆìŒì— ë“¤ì§€ ì•Šë”ë¼ë„ ì–»ì€ ê·œì¹™ì„ ë©”ëª¨í•˜ë©´, ë‹¤ìŒ ê³¼ì œì—ì„œ ì‹œí–‰ì°©ì˜¤ê°€ ì¤„ì–´ë“­ë‹ˆë‹¤. ë˜í•œ í­ë„“ì€ íƒìƒ‰ê³¼ ì§‘ì¤‘ì  ê°œì„ ì„ êµì°¨ì‹œí‚¤ëŠ” í˜ì´ìŠ¤ê°€ ë²ˆì•„ì›ƒì„ ë§‰ìŠµë‹ˆë‹¤. íŒ€ ì‘ì—…ì—ì„œëŠ” ì‹¤í—˜ ê¸°ë¡ì„ ê³µìœ í•´ ë™ë£Œì˜ í•™ìŠµ ì†ë„ë¥¼ í•¨ê»˜ ëŒì–´ì˜¬ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
    direction:'1) ê³¼ì œë¥¼ ì‹œì‘í•  ë•Œ â€œì´ë²ˆ ì‹œë„ì—ì„œ í™•ì¸í•  1ê°€ì§€â€ë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤. 2) í…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ ë¶“/íœ/ì¬ë£Œ ì¡°í•©ì„ ë¨¼ì € ì‹œí—˜í•©ë‹ˆë‹¤. 3) ì‹¤íŒ¨ ì‚¬ë¡€ë¥¼ ì‚¬ì§„ê³¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ê¸°ë¡í•˜ì—¬ ë‹¤ìŒ ì‘ì—… ë¸Œë¦¬í•‘ì˜ ê·¼ê±°ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. 4) í•œ ì£¼ëŠ” í­ë„“ê²Œ íƒìƒ‰, ë‹¤ìŒ ì£¼ëŠ” ì„ íƒí•œ ë°©ë²•ì˜ ì™„ì„±ë„ì— ì§‘ì¤‘í•˜ëŠ” 2ì£¼ ì‚¬ì´í´ì„ ì¶”ì²œí•©ë‹ˆë‹¤. 5) ë°œí‘œ ë•Œ ì‹¤í—˜ ëª©í‘œì™€ ë°°ìš´ ì ì„ ì§§ê²Œ ê³µìœ í•˜ì„¸ìš”.'
  },
  'ì†Œí†µë ¥':{
    theoryTitle:'ë¹„ì£¼ì–¼ ë¦¬í„°ëŸ¬ì‹œ',
    theory:'ë¹„ì£¼ì–¼ ë¦¬í„°ëŸ¬ì‹œëŠ” ì´ë¯¸ì§€ê°€ ë‹´ëŠ” ì •ë³´Â·ê°ì •Â·ë§¥ë½ì„ í•´ì„í•˜ê³  ì¬êµ¬ì„±í•˜ëŠ” ëŠ¥ë ¥ì…ë‹ˆë‹¤. ë©”ì‹œì§€ì™€ í˜•ì‹ì´ ì¼ì¹˜í•  ë•Œ ì„¤ë“ë ¥ì´ ìƒê¸°ë©°, ì œëª©Â·ì£¼ì„Â·ê³¼ì • ë…¸íŠ¸ëŠ” ê´€ê°ì˜ ê¸¸ì¡ì´ê°€ ë©ë‹ˆë‹¤. ë˜ë˜ ë¹„í‰ì€ ë‹¨ìˆœ ë°˜ì‘ì´ ì•„ë‹ˆë¼ ê¸°ì¤€ì„ ê³µìœ í•˜ëŠ” í›ˆë ¨ì¼ ë•Œ íš¨ê³¼ê°€ í½ë‹ˆë‹¤. ì‹œì„  ìœ ë„ ì¥ì¹˜(ëŒ€ë¹„, ë°©í–¥ì„±, ë°˜ë³µ)ëŠ” ì„¤ëª… ì—†ì´ë„ ì˜ë„ë¥¼ ì „ë‹¬í•˜ëŠ” ì–¸ì–´ê°€ ë©ë‹ˆë‹¤.',
    expert:'ì†Œí†µë ¥ì´ ì¢‹ì€ í•™ìƒì€ ìì‹ ì˜ ì„ íƒì„ ë…¼ë¦¬ì™€ ê°ê°ìœ¼ë¡œ ë™ì‹œì— ì„¤ëª…í•©ë‹ˆë‹¤. ì‘ì—… ì˜ë„, ì„ íƒ ê¸°ì¤€, ëŒ€ì•ˆ ë¹„êµë¥¼ ì§§ê²Œ ë§í•´ë³´ëŠ” ìŠµê´€ì€ ë°œí‘œì˜ ê¸´ì¥ì„ ì¤„ì…ë‹ˆë‹¤. í”¼ë“œë°±ì„ ë°›ì„ ë•ŒëŠ” â€œìœ ì§€/ìˆ˜ì •/ì¶”ê°€â€ 3ë¶„ë¥˜ë¡œ ì •ë¦¬í•˜ë©´ ë‹¤ìŒ ì‹œë„ê°€ ì„ ëª…í•´ì§‘ë‹ˆë‹¤. íŒ€ ê³¼ì œì—ì„œëŠ” ì—­í• ê³¼ ê¸°ëŒ€ ê²°ê³¼ë¥¼ ì‹œê°ì ìœ¼ë¡œ ì •ë¦¬í•´ ì˜¤í•´ë¥¼ ì¤„ì´ì„¸ìš”. ë§í•˜ê¸°ì™€ ë³´ê¸°, ê·¸ë¦¬ê¸°ê°€ í•˜ë‚˜ì˜ ê³¼ì •ìœ¼ë¡œ ë¬¶ì¼ ë•Œ ì‘í’ˆì˜ ì¼ê´€ì„±ì´ ì»¤ì§‘ë‹ˆë‹¤.',
    direction:'1) ì‹œì‘ ì „ì— ì˜ë„ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì ê³ , ì™„ì„± í›„ì—ë„ ê°™ì€ ë¬¸ì¥ìœ¼ë¡œ ì ê²€í•©ë‹ˆë‹¤. 2) ì‘ì—… ê³¼ì • ì‚¬ì§„ì„ 3ì»·ë§Œ ê³¨ë¼ ì„¤ëª…ë¬¸ì„ ë¶™ì…ë‹ˆë‹¤. 3) í”¼ë“œë°± ë…¸íŠ¸ë¥¼ â€œìœ ì§€/ìˆ˜ì •/ì¶”ê°€â€ë¡œ ë‚˜ëˆ„ì–´ ì •ë¦¬í•©ë‹ˆë‹¤. 4) ì œëª© 3ì•ˆì„ ë§Œë“¤ì–´ ëœ»Â·í†¤Â·ê´€ê° ë°˜ì‘ì„ ë¹„êµí•´ ì„ íƒí•©ë‹ˆë‹¤. 5) ë‹¤ìŒ ê³¼ì œ ë¸Œë¦¬í•‘ì—ì„œ ì„ íƒ ì´ìœ ë¥¼ 30ì´ˆ ë‚´ë¡œ ë§í•´ë³´ì„¸ìš”.'
  },
  'ê¾¸ì¤€ì„±':{
    theoryTitle:'ìê¸°ì¡°ì ˆ í•™ìŠµ',
    theory:'ê¾¸ì¤€ì„±ì€ ë™ê¸°Â·ìŠµê´€Â·í™˜ê²½ 3ìš”ì†Œì˜ ê· í˜•ì—ì„œ ë‚˜ì˜µë‹ˆë‹¤. ì§§ê³  ë¹ˆë²ˆí•œ ì™„ì„± ê²½í—˜ì€ ìê¸°íš¨ëŠ¥ê°ì„ ë†’ì—¬ ë‹¤ì‹œ í–‰ë™ì„ ë‚³ëŠ” ì„ ìˆœí™˜ì„ ë§Œë“­ë‹ˆë‹¤. ì‹œê°„ ê³ ì •ê³¼ ê³¼ì œ ì¶•ì†ŒëŠ” ì‹œì‘ ì¥ë²½ì„ ë‚®ì¶”ë©°, ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ” ì§„í–‰ ìƒí™©ì„ ê°€ì‹œí™”í•©ë‹ˆë‹¤. íšŒê³ ëŠ” ì‹¤íŒ¨ì˜ ì›ì¸ì„ ê°œì¸ì˜ ì„±í–¥ íƒ“ì´ ì•„ë‹ˆë¼ ì „ëµì˜ ì¡°ì • ëŒ€ìƒìœ¼ë¡œ ë°”ë¼ë³´ê²Œ í•´ì¤ë‹ˆë‹¤.',
    expert:'ë£¨í‹´ì´ ì¢‹ì€ í•™ìƒì€ í° ëª©í‘œë¥¼ ì‘ì€ ë‹¨ìœ„ë¡œ ìª¼ê°œëŠ” ê°ê°ì´ ìˆìŠµë‹ˆë‹¤. ë§¤ì¼ ê°™ì€ ì‹œê°„Â·ì¥ì†Œì—ì„œ ì‹œì‘ ì‹ í˜¸(ì±…ìƒ ì •ë¦¬, íƒ€ì´ë¨¸, ìŒì•…)ë¥¼ ê³ ì •í•˜ë©´ ì˜ì§€ ì†Œëª¨ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™„ì„±ê¹Œì§€ì˜ ì¤‘ê°„ ì´ì •í‘œë¥¼ ì‘ê²Œ ë‘ì–´ â€œì™„ë£Œâ€ ì²´í¬ ê²½í—˜ì„ ìì£¼ ë§Œë“¤ë©´ ë™ê¸°ê°€ ìœ ì§€ë©ë‹ˆë‹¤. íœ´ì‹ ë˜í•œ ê³„íšì˜ ì¼ë¶€ë¡œ í¬í•¨í•´ ì—ë„ˆì§€ë¥¼ íšŒë³µí•˜ì„¸ìš”. ê¾¸ì¤€í•¨ì€ ì„±ì·¨ë¿ ì•„ë‹ˆë¼ í‘œí˜„ì˜ ì•ˆì •ê°ìœ¼ë¡œë„ ë“œëŸ¬ë‚©ë‹ˆë‹¤.',
    direction:'1) í•˜ë£¨ 10~15ë¶„, ì£¼ 5íšŒ ì‘ê²Œ ì™„ì„±í•˜ëŠ” ê³¼ì œë¥¼ ì •í•©ë‹ˆë‹¤. 2) ì‹œì‘ ì˜ì‹(ì±…ìƒ ì •ë¦¬â†’íƒ€ì´ë¨¸ ONâ†’ì²« ì„  ê¸‹ê¸°)ì„ ê³ ì •í•©ë‹ˆë‹¤. 3) ì§„í–‰/ì™„ë£Œ ì¹¸ë§Œ ìˆëŠ” ë‹¨ìˆœ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 4) ì£¼ 1íšŒ 5ë¶„ íšŒê³ ë¡œ â€œì˜í•œ 1ê°€ì§€/ë‹¤ìŒ ìˆ˜ì • 1ê°€ì§€â€ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤. 5) 4ì£¼ ë‹¨ìœ„ë¡œ ì „/í›„ ì‘ì—…ì„ ë‚˜ë€íˆ ë†“ê³  ë³€í™” í¬ì¸íŠ¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.'
  }
};

/* ì œì¶œ & ê²°ê³¼ */
function nowKST(){const d=new Date(),p=n=>String(n).padStart(2,'0');return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())} KST`}
async function submitAllSafe(){
  const raw=aggregateScores(STATE.answers);
  const scores=Object.fromEntries(Object.entries(raw).map(([k,v])=>[k,adjust(v)]));
  const ordered=Object.keys(scores).sort((a,b)=>scores[b]-scores[a]);
  const top3=ordered.slice(0,3);
  const resultId=crypto.randomUUID();
  const form=new FormData();
  form.append(F.child_name,STATE.profile.child_name);form.append(F.age,STATE.profile.age);form.append(F.grade,STATE.profile.grade);
  form.append(F.guardian,STATE.profile.guardian);form.append(F.phone,STATE.profile.phone);form.append(F.campus,STATE.profile.campus||'');
  form.append(F.answers,JSON.stringify({profile:STATE.profile,questions:STATE.answers,top3}));
  form.append(F.scores,JSON.stringify(scores));form.append(F.top3,top3.join(','));form.append(F.resultId,resultId);form.append(F.timestamp,nowKST()));
  try{await fetch(FORM_ACTION,{method:'POST',mode:'no-cors',body:form});}catch(e){}
  STATE.result={scores,scoresRaw:raw,top3,resultId};STATE.step='result';render();
}

let CHARTS=[];function destroyCharts(){CHARTS.forEach(c=>c.destroy?.());CHARTS=[]}

/* ê²°ê³¼ */
function viewResult(){
  const r=STATE.result,s=r?.scores||{};const ordered=Object.keys(s).sort((a,b)=>s[b]-s[a]);
  const top4=ordered.slice(0,4);
  const next4=ordered.slice(4,8);
  const longSummary=[
    `${STATE.profile.child_name}ë‹˜ì€ <b>${top4[0]||'-'}</b>ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ <b>${top4[1]||'-'}</b>, <b>${top4[2]||'-'}</b>, <b>${top4[3]||'-'}</b>ì—ì„œ ê°•ì ì´ ëšœë ·í•©ë‹ˆë‹¤.`,
    `ì„ íƒ ê³¼ì •ì—ì„œ ì£¼ì˜ì§‘ì¤‘ê³¼ íŒë‹¨ì´ ì•ˆì •ì ì´ë©°, ê³¼ì œë¥¼ ë¹ ë¥´ê²Œ íŒŒì•…í•´ í•µì‹¬ì„ ì¡ëŠ” ìœ í˜•ì…ë‹ˆë‹¤.`
  ].join(' ');

  app().innerHTML=`<div id="pdfArea" class="pdf-screen-width">
    <div class="block callout" style="text-align:center">
      <div class="chip" style="margin:0 auto 8px;display:inline-block">í…ŒìŠ¤íŠ¸ ì™„ë£Œ</div>
      <h2 style="margin:0 0 10px"><b>${STATE.profile.child_name}</b>ë‹˜, ë©‹ì§„ ì§‘ì¤‘ë ¥ì´ì—ˆìŠµë‹ˆë‹¤!</h2>
      <div class="chips" style="margin-top:10px;justify-content:center">${top4.slice(0,3).map(t=>`<span class="chip">ë›°ì–´ë‚œ ì˜ì—­: ${t}</span>`).join('')}</div>
    </div>

    <div class="block">
      <h3 class="center">í”„ë¡œíŒŒì¼ & ì£¼ìš” ì§€í‘œ</h3>
      <div class="result-grid" style="margin-top:8px">
        <div class="chartBox">
          <div class="chartCaption">ì „ì²´ í”„ë¡œíŒŒì¼(Radar)</div>
          <canvas id="radar" height="200"></canvas>
        </div>
        <div class="result-right">
          <div class="chartBox">
            <div class="chartCaption">ë›°ì–´ë‚œ ì˜ì—­ (TOP4)</div>
            <canvas id="barsTop4" height="200"></canvas>
          </div>
          <div class="chartBox">
            <div class="chartCaption">ì ì¬ì ì¸ ì˜ì—­ (í•˜ìœ„ 4)</div>
            <canvas id="barsNext" height="200"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="block"><h3>ì´í‰</h3><p style="color:#0f172a;font-size:16px;line-height:1.8">${longSummary}</p></div>

    <div class="block"><h3>í•­ëª©ë³„ í•œ ì¤„ í•´ì„</h3>
      <div class="grid" style="grid-template-columns:1fr 1fr 1fr">
        ${DOMAINS.map(k=>{
          const v = +(s[k]||0);
          const w = Math.min(100,(v/4)*100);
          const b = band(v);
          return `
            <div style="border:1px solid var(--line);border-radius:12px;padding:14px;background:#fff;box-shadow:0 10px 26px rgba(16,24,40,.06)">
              <div style="font-weight:900;margin-bottom:8px">${k} <span class="small" style="color:#6b7280">(${b} Â· ${v.toFixed(1)})</span></div>
              <div class="topprogress" style="height:10px;margin:8px 0 12px" aria-label="${k} ì§„í–‰ë„">
                <div style="width:${w}%;height:100%;background:linear-gradient(90deg,#B9C8FF,#9DE5D5,#FFD9BE)"></div>
              </div>
              <div class="small" style="color:#0f172a">${DETAIL[k](STATE.profile.child_name)}</div>
            </div>`;
        }).join('')}
      </div>
    </div>
  </div>

  <div class="center no-pdf" style="margin-top:16px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
    <button class="btn-ghost" onclick="STATE.step='start'; render()">ì²˜ìŒìœ¼ë¡œ</button>
    <button class="btn btn-mint" id="btn_pdf">PDF ì €ì¥</button>
    <button class="btn btn-accent" id="btn_email">ì´ë©”ì¼ë¡œ ë³´ë‚´ê¸°</button>
    <button class="btn-ghost" onclick="STATE.step='details'; render()">ìì„¸í•œ ê²°ê³¼ ë³´ê¸°</button>
  </div>`;

  destroyCharts();

  const rctx=document.getElementById('radar').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(rctx,{type:'radar',
    data:{labels:DOMAINS,datasets:[{data:DOMAINS.map(k=>s[k]||0),borderColor:'#FFB98A',backgroundColor:'rgba(255,185,138,.22)',borderWidth:2,pointRadius:3,fill:true}]},
    options:{maintainAspectRatio:false,animation:{duration:800},scales:{r:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'#eef2f7'},angleLines:{color:'#eef2f7'}}},plugins:{legend:{display:false}}}
  }));

  const b1=document.getElementById('barsTop4').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(b1,{type:'bar',
    data:{labels:top4,datasets:[{data:top4.map(k=>s[k]||0),borderRadius:12,borderSkipped:false,backgroundColor:['#FFD9BE','#E6E2FF','#CFF7EE','#FFD9BE']}]},
    options:{maintainAspectRatio:false,animation:{duration:700},scales:{y:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'#f1f5f9'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}
  }));

  const b2=document.getElementById('barsNext').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(b2,{type:'bar',
    data:{labels:next4,datasets:[{data:next4.map(k=>s[k]||0),borderRadius:12,borderSkipped:false,backgroundColor:['#E6E2FF','#CFF7EE','#FFD9BE','#E6E2FF']}]},
    options:{maintainAspectRatio:false,animation:{duration:700},scales:{y:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'#f1f5f9'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}
  }));

  $('btn_pdf').onclick=handleSavePdf;$('btn_email').onclick=openEmailModal;
}

/* ìì„¸í•œ ê²°ê³¼ â€“ ê°•ì (TOP4) / ì ì¬(í•˜ìœ„4) ëª¨ë‘ ì´ë¡ Â·ì „ë¬¸ê°€Â·ë°œë‹¬ë°©í–¥(ê¸´ ë¬¸ì¥)ë§Œ í‘œì‹œ */
function theoryCard(i,key,tag){
  const t=THEORY[key]||{theoryTitle:'ì´ë¡ ',theory:'-',expert:'-',direction:'-'};
  const chipColor = tag==='ê°•ì ' ? '' : 'style="background:#fff0d9;color:#9a5c27;border-color:#ffd9ae"';
  return `<div class="theoryWrap">
    <div style="font-weight:900;margin-bottom:8px">${i}. ${key} <span class="tchip" ${chipColor}>${tag} ì˜ì—­</span></div>
    <div class="tgrid">
      <div class="tcard hint">
        <div style="font-weight:900;margin-bottom:6px">ğŸ“ ì´ë¡ ì  ê·¼ê±° â€” ${t.theoryTitle}</div>
        <div class="" style="font-size:15px">${t.theory}</div>
      </div>
      <div class="tcard">
        <div style="font-weight:900;margin-bottom:6px">ğŸ§‘â€ğŸ« ì „ë¬¸ê°€ ì˜ê²¬</div>
        <div style="font-size:15px">${t.expert}</div>
      </div>
      <div class="tcard">
        <div style="font-weight:900;margin-bottom:6px">ğŸ¡… ë°œë‹¬ ë°©í–¥</div>
        <div style="font-size:15px">${t.direction}</div>
      </div>
    </div>
  </div>`;
}

function viewDetails(){
  const r=STATE.result||{};const s=r.scores||{};
  const ordered=Object.keys(s).sort((a,b)=>s[b]-s[a]);
  const top4=ordered.slice(0,4);
  const next4=ordered.slice(4,8);

  const topBlocks=top4.map((k,i)=>theoryCard(i+1,k,'ê°•ì ')).join('');
  const potBlocks=next4.map((k,i)=>theoryCard(i+1,k,'ì ì¬')).join('');
  const overview=`<b>${STATE.profile.child_name}</b>(${STATE.profile.age}ì„¸, ${STATE.profile.grade}) ì•„ë™ì€
  <b>${top4[0]||'-'}</b> ì¤‘ì‹¬ì˜ ê°•ì ì„ ë°”íƒ•ìœ¼ë¡œ <b>${top4.slice(1).join(', ')||'-'}</b>ê°€ ìœ ê¸°ì ìœ¼ë¡œ ê²°í•©ë˜ì–´ ìˆìŠµë‹ˆë‹¤. 
  í–¥í›„ <b>${next4.join(', ')||'-'}</b> ì˜ì—­ì„ ë³´ì™„í•˜ë©´ í‘œí˜„ í­ì´ í¬ê²Œ ë„“ì–´ì§ˆ ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤.`;

  app().innerHTML=`
  <div class="detail-hero"><div class="ic">ğŸ“˜</div><div class="detail-title">ì „ë¬¸ê°€ í‰ê°€ ë° ì‹¬í™” ë¶„ì„</div></div>
  <p class="detail-sub"><b>${STATE.profile.child_name}</b>ì˜ ë¯¸ìˆ ì ì„± ì‹¬í™” ë¶„ì„ ë³´ê³ ì„œ</p>

  <div class="block" style="background:#f5f8ff;border-color:#e6eeff">
    <div style="font-weight:900;margin-bottom:6px;display:flex;align-items:center;gap:8px">ğŸ§© ê°•ì  ì˜ì—­(TOP4)</div>
    ${topBlocks || '<div class="small muted">ê°•ì  ì˜ì—­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
  </div>

  <div class="block" style="background:#fffdfa;border-color:#ffecd2">
    <div style="font-weight:900;margin-bottom:6px;display:flex;align-items:center;gap:8px">ğŸŒ± ì ì¬ì  ì˜ì—­(í•˜ìœ„ 4)</div>
    ${potBlocks || '<div class="small muted">ì ì¬ ì˜ì—­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
  </div>

  <div class="block expertBox" style="margin-top:14px">
    <div class="expertHeader" style="display:flex;align-items:center;gap:10px;font-weight:900;font-size:19px;margin-bottom:10px">
      <div class="ic" style="width:34px;height:34px;border-radius:999px;display:grid;place-items:center;background:#ffefe5;border:1px solid #ffd9be">ğŸ§ </div>
      <div>ì¢…í•© ì „ë¬¸ê°€ ì†Œê²¬</div>
    </div>
    <ul class="ticks">
      <li><b>ë°”ë¥¸ë¯¸ìˆ í•™ì› ì „ë¬¸ í‰ê°€íŒ€</b> â€” ${overview}</li>
      <li><b>ê°œë³„í™” ì „ëµ</b>: ê°•ì  ê¸°ë°˜ ê³¼ì œ ë‚œì´ë„ ìƒí–¥ + ì ì¬ ì˜ì—­ì˜ í•µì‹¬ ì›ë¦¬ ì¬í•™ìŠµ</li>
      <li><b>ê³¼ì • ì¤‘ì‹¬</b>: ê²°ê³¼ë¬¼ë¿ ì•„ë‹ˆë¼ ì˜ë„Â·ì„ íƒ ê¸°ì¤€Â·íšŒê³ ë¥¼ í•¨ê»˜ ê¸°ë¡í•˜ëŠ” ìŠµê´€ í˜•ì„±</li>
      <li><b>ë¦¬ë“¬ ì„¤ê³„</b>: íƒìƒ‰ ì£¼ê°„ê³¼ ì™„ì„± ì£¼ê°„ì„ ë²ˆê°ˆì•„ ë°°ì¹˜í•´ ë™ê¸°ì™€ ì™„ì„±ë„ë¥¼ ë™ì‹œì— í™•ë³´</li>
    </ul>
  </div>

  <div class="reserve">
    <div style="display:flex;align-items:center;gap:8px;justify-content:center">
      <div class="badge" style="width:36px;height:36px;display:grid;place-items:center;border-radius:999px;font-size:18px">ğŸ—“</div>
      <div class="title">ì „ë¬¸ê°€ ë°©ë¬¸ ìƒë‹´ ì˜ˆì•½</div>
    </div>
    <div class="small" style="margin-top:6px">í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê¸°ë°˜ <b>ë§ì¶¤ êµìœ¡ ê³„íš</b>ê³¼ <b>í¬íŠ¸í´ë¦¬ì˜¤</b> ì§„ë‹¨ì„ ì œê³µí•©ë‹ˆë‹¤.</div>
    <div class="items">
      <div class="pill"><div class="pt">ì „ë¬¸ê°€ ì§„ë‹¨</div><div class="small muted">ë¯¸ìˆ êµìœ¡ ì „ë¬¸ê°€ì˜ 1:1 ê°œë³„ ì§„ë‹¨</div></div>
      <div class="pill"><div class="pt">ë§ì¶¤ ê³„íš</div><div class="small muted">íŠ¹ì„±ì— ë§ëŠ” êµìœ¡ ë¡œë“œë§µ ì œì‹œ</div></div>
      <div class="pill"><div class="pt">ì£¼ê¸°ì  ê´€ë¦¬</div><div class="small muted">2ì£¼/4ì£¼ ë‹¨ìœ„ ë£¨í‹´ ì½”ì¹­</div></div>
    </div>
    <button class="btn btn-mint no-pdf" onclick="alert('ìƒë‹´ ì˜ˆì•½ì€ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤!')">ìƒë‹´ ì˜ˆì•½í•˜ê¸°</button>
    <div class="note">ìƒë‹´ë£Œ: ë¬´ë£Œ | ì†Œìš”ì‹œê°„: 60ë¶„</div>
  </div>

  <div class="center no-pdf" style="margin-top:16px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
    <button class="btn-ghost" onclick="STATE.step='result'; render()">ê²°ê³¼ë¡œ ëŒì•„ê°€ê¸°</button>
    <button class="btn" onclick="STATE.step='start'; render()">ì²˜ìŒìœ¼ë¡œ</button>
  </div>`;
}

/* PDF/ì´ë©”ì¼ */
function buildPdfWrapperFrom(node){
  const wrap=document.createElement('div');
  wrap.style.position='fixed';wrap.style.left='-10000px';wrap.style.top='0';
  wrap.style.width='794px';wrap.style.background='#fff';wrap.style.zIndex='-1';
  const clone=node.cloneNode(true);
  clone.querySelectorAll('img').forEach(img=>{
    img.setAttribute('crossorigin','anonymous'); img.referrerPolicy='no-referrer'; img.src=img.src;
  });
  const srcC=node.querySelectorAll('canvas');const dstC=clone.querySelectorAll('canvas');
  srcC.forEach((src,i)=>{const dst=dstC[i];if(!dst)return;dst.width=src.width;dst.height=src.height;dst.getContext('2d',{willReadFrequently:true}).drawImage(src,0,0)});
  wrap.appendChild(clone);document.body.appendChild(wrap);
  return wrap;
}
function waitForAssets(root){
  const imgs=[...root.querySelectorAll('img')];
  const imgPromises=imgs.map(img=>img.complete?Promise.resolve():new Promise(res=>{img.onload=()=>res();img.onerror=()=>res()}));
  const fontsReady=('fonts'in document)?document.fonts.ready:Promise.resolve();
  return Promise.all([fontsReady,...imgPromises]);
}
async function html2pdfBlob(wrapper){
  const opt={margin:[8,8,8,8],
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2,useCORS:true,backgroundColor:'#ffffff',removeContainer:true,windowWidth:wrapper.scrollWidth,windowHeight:wrapper.scrollHeight},
    pagebreak:{mode:['css','legacy']},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}};
  return await html2pdf().set(opt).from(wrapper).output('blob');
}
async function canvasSlicerBlob(wrapper){
  const h2c=window.html2canvas;
  const canvas=await h2c(wrapper,{scale:2,useCORS:true,allowTaint:true,backgroundColor:'#ffffff',scrollX:0,scrollY:0,windowWidth:wrapper.scrollWidth,windowHeight:wrapper.scrollHeight});
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF({unit:'mm',format:'a4',orientation:'portrait'});
  const pxToMm=210/canvas.width;
  const pageHeightPx=Math.floor(297/pxToMm);
  let y=0,page=0;
  while(y<canvas.height){
    const sliceHeight=Math.min(pageHeightPx,canvas.height-y);
    const pageCanvas=document.createElement('canvas');
    pageCanvas.width=canvas.width;pageCanvas.height=sliceHeight;
    const ctx=pageCanvas.getContext('2d',{willReadFrequently:true});
    ctx.drawImage(canvas,0,y,canvas.width,sliceHeight,0,0,canvas.width,sliceHeight);
    const img=pageCanvas.toDataURL('image/jpeg',0.98);
    const mmHeight=sliceHeight*pxToMm;
    if(page>0) pdf.addPage();
    pdf.addImage(img,'JPEG',0,0,210,mmHeight);
    y+=sliceHeight;page++;
  }
  return pdf.output('blob');
}
async function exportPdfBlob(node){
  const wrapper=buildPdfWrapperFrom(node);
  await waitForAssets(wrapper);
  try{
    let blob=await html2pdfBlob(wrapper);
    if(!blob || blob.size<5000){blob=await canvasSlicerBlob(wrapper);}
    return blob;
  }catch(e){
    try{ return await canvasSlicerBlob(wrapper); }
    catch(e2){ throw e2; }
  }finally{ wrapper.remove(); }
}
async function handleSavePdf(){
  const node=$('pdfArea')||document.body;
  node.classList.add('pdf-screen-width');
  await new Promise(r=>setTimeout(r,50));
  try{
    const blob=await exportPdfBlob(node);
    const filename=`${STATE.profile.child_name}_ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸_V1_BASIC.pdf`;
    const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
  }catch(e){console.error(e);alert('PDF ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')}
  finally{node.classList.remove('pdf-screen-width');}
}

/* ì´ë©”ì¼ */
function setModalVisible(show){const m=$('emailModal');if(show){m.classList.add('show');m.setAttribute('aria-hidden','false');document.body.style.overflow='hidden'}else{m.classList.remove('show');m.setAttribute('aria-hidden','true');document.body.style.overflow=''}}
function openEmailModal(){setModalVisible(true);$('emailSubject').value=`${STATE.profile.child_name} í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤`;$('emailTo').value=STATE.profile.email||'';$('emailMsg').textContent=''}
$('emailCancel').onclick=()=>setModalVisible(false);document.addEventListener('keydown',e=>{if(e.key==='Escape')setModalVisible(false)})
function blobToBase64(blob){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onloadend=()=>resolve(reader.result.split(',')[1]);reader.onerror=reject;reader.readAsDataURL(blob)})}
$('emailSend').onclick=async()=>{
  const to=$('emailTo').value.trim();if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(to)){ $('emailMsg').textContent='ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.'; return; }
  $('emailMsg').textContent='PDF ìƒì„± ì¤‘...';
  let base64='';try{const blob=await exportPdfBlob($('pdfArea')||document.body);base64=await blobToBase64(blob)}catch(e){$('emailMsg').textContent='PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';return}
  $('emailMsg').textContent='ì´ë©”ì¼ ì „ì†¡ ì¤‘...';
  const subject=$('emailSubject').value.trim()||`${STATE.profile.child_name} í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤`;
  const htmlBody=`<div style="font-family:Pretendard,Apple SD Gothic Neo,Segoe UI,Arial"><h2 style="margin:0 0 8px">${APP_TITLE}</h2><p><b>${STATE.profile.child_name}</b> ë‹˜ì˜ ê²°ê³¼ì§€ë¥¼ ì²¨ë¶€í–ˆìŠµë‹ˆë‹¤.</p><p>ìº í¼ìŠ¤: ${STATE.profile.campus||'-'} / ì—°ë½ì²˜: ${STATE.profile.phone||'-'}</p><p style="color:#6b7280;font-size:12px;margin-top:12px">ë³¸ ë©”ì¼ì€ ìë™ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p></div>`;
  try{
    const res=await fetch(EMAIL_FUNCTION_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({to,subject,html:htmlBody,attachmentName:`${STATE.profile.child_name}_ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸_V1_BASIC.pdf`,attachmentBase64:base64})});
    const ok=res.ok;const data=await res.json().catch(()=>({}));
    if(ok){$('emailMsg').textContent='ì „ì†¡ ì™„ë£Œ! ë©”ì¼í•¨ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.';setTimeout(()=>setModalVisible(false),1200)}
    else{$('emailMsg').textContent='ì „ì†¡ ì‹¤íŒ¨: '+(data.error||res.statusText)}
  }catch(err){$('emailMsg').textContent='ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}
}

/* Router */
function render(){renderNav();updateTopProgress();if(STATE.step==='start')return viewStart();if(STATE.step==='consent')return viewConsent();if(STATE.step==='profile')return viewProfile();if(STATE.step==='test')return viewTest();if(STATE.step==='result')return viewResult();if(STATE.step==='details')return viewDetails()}
render();

/* Fallback ë¬¸í•­ */
function W(w){const o={};DOMAINS.forEach(k=>o[k]=0);Object.entries(w).forEach(([k,v])=>o[k]=v);return o}
function localQuestions(){
  const S=(q,p,a,b,c,d)=>({id:q,order:+q.replace('q',''),prompt:p,options:[{key:'A',label:a[0],imageUrl:a[1],weights:W(a[2])},{key:'B',label:b[0],imageUrl:b[1],weights:W(b[2])},{key:'C',label:c[0],imageUrl:c[1],weights:W(c[2])},{key:'D',label:d[0],imageUrl:d[1],weights:W(d[2])}]});
  const IMG=kw=>`https://images.unsplash.com/photo-150${Math.floor(Math.random()*899+100)}?auto=format&fit=crop&w=900&q=60&${encodeURIComponent(kw)}`;
  return [
    S('q1','ìƒˆë¡œìš´ ë¯¸ìˆ  ë„êµ¬ë¥¼ ë°œê²¬í–ˆì–´ìš”! ë¬´ì—‡ì„ ë¨¼ì € í•´ë³¼ê¹Œìš”?',['ì„¤ëª…ì„œë¥¼ ê¼¼ê¼¼íˆ ì½ì–´ë³¸ë‹¤',IMG('paper'),{ë””í…Œì¼:1,ê¾¸ì¤€ì„±:0.6}],['ì¢…ì´ì— íƒìƒ‰Â·ì‹¤í—˜í•œë‹¤',IMG('sketch'),{ë„ì „ì„±:1}],['ì¹œêµ¬ë“¤ê³¼ ì•„ì´ë””ì–´ ë‚˜ëˆˆë‹¤',IMG('kids'),{ì†Œí†µë ¥:1,ì„œì‚¬ë ¥:0.6}],['ê°€ì¥ íŠ¹ì´í•œ ê²°ê³¼ ìƒìƒ',IMG('idea'),{ë„ì „ì„±:1,ì„œì‚¬ë ¥:0.5}]),
    S('q2','ê·¸ë¦¼ì— ì–´ë–¤ ì´ì•¼ê¸°ë¥¼ ë‹´ê³  ì‹¶ë‚˜ìš”?',['ëª¨í—˜ ì´ì•¼ê¸°',IMG('adventure'),{ì„œì‚¬ë ¥:1}],['ê°ì •ì„ ìƒ‰ê³¼ í˜•íƒœë¡œ',IMG('abstract'),{ìƒ‰ê°ê°:0.8,ì„œì‚¬ë ¥:0.6}],['í˜„ì‹¤ ê±´ë¬¼ ìƒˆë¡œ ë””ìì¸',IMG('architecture'),{ê³µê°„ê°:1,ë””í…Œì¼:0.4}],['ì‘ì€ ìƒëª…ì²´ì˜ ìˆ¨ì€ ì„¸ê³„',IMG('mini world'),{ê´€ì°°ë ¥:0.8,ì„œì‚¬ë ¥:0.6}]),
    S('q3','ë‘ ê·¸ë¦¼ ì¤‘ ìƒ‰ì´ ë” ì¡°í™”ë¡œìš´ ê²ƒì€?',['ì¡°í™”ë¡œìš´ íŒ”ë ˆíŠ¸',IMG('palette'),{ìƒ‰ê°ê°:1}],['ëŒ€ë¹„ ê°•í•œ íŒ”ë ˆíŠ¸',IMG('contrast'),{ë„ì „ì„±:0.6}],['íŒŒìŠ¤í…” í¸ì•ˆí•¨',IMG('pastel'),{ìƒ‰ê°ê°:0.8}],['ê°•í•œ ë³´ìƒ‰',IMG('vivid'),{ë„ì „ì„±:0.6}]),
    S('q4','ê·¸ë¦¬ë‹¤ ì‹¤ìˆ˜ë¥¼ í–ˆì–´ìš”. ì–´ë–»ê²Œ í• ê¹Œìš”?',['ì§€ìš°ê³  ë‹¤ì‹œ ê·¸ë¦°ë‹¤',IMG('erase'),{ë””í…Œì¼:0.8,ê¾¸ì¤€ì„±:0.8}],['ì‹¤ìˆ˜ë¥¼ ì‘í’ˆ ì¼ë¶€ë¡œ ë°”ê¾¼ë‹¤',IMG('mix'),{ë„ì „ì„±:0.6}],['ì‰¬ê³  ì¬ë„ì „Â·ì™„ì„±',IMG('focus'),{ê¾¸ì¤€ì„±:1}],['ë„ì›€ì„ ìš”ì²­',IMG('help'),{ì†Œí†µë ¥:0.8}]),
    S('q5','ë¯¸ìˆ ê´€ì—ì„œ ë¬´ì—‡ì„ ì˜¤ë˜ ë³´ë‚˜ìš”?',['ë¹›/ê·¸ë¦¼ì ë¶„ìœ„ê¸°',IMG('light'),{ê³µê°„ê°:0.6,ìƒ‰ê°ê°:0.6}],['ìˆ¨ê²¨ì§„ ì‘ì€ ìš”ì†Œ',IMG('detail'),{ê´€ì°°ë ¥:0.8,ë””í…Œì¼:0.8}],['ì‘ê°€ì˜ ë§ˆìŒ ìƒìƒ',IMG('emotion'),{ì„œì‚¬ë ¥:0.7,ì†Œí†µë ¥:0.4}],['ì¬ë£Œ/ê¸°ë²•ì´ ê¶ê¸ˆ',IMG('material'),{ë„ì „ì„±:0.6,ê´€ì°°ë ¥:0.6}]),
    S('q6','ë¯¸ë˜ì˜ ë„ì‹œë¥¼ ê·¸ë¦°ë‹¤ë©´, ì–´ë–»ê²Œ ì‹œì‘í• ê¹Œìš”?',['ì‚¬ì§„ ì¡°ì‚¬Â·ê³„íš',IMG('city plan'),{ë””í…Œì¼:0.7,ê³µê°„ê°:0.8}],['ì•„ë¬´ë„ ë³¸ ì  ì—†ëŠ” ê±´ë¬¼',IMG('scifi'),{ë„ì „ì„±:1}],['ì•„ì´ë””ì–´ ëª¨ìœ¼ê¸°',IMG('team'),{ì†Œí†µë ¥:0.8}],['ì¬ë£Œ ì‹¤í—˜',IMG('paint'),{ë„ì „ì„±:0.8,ìƒ‰ê°ê°:0.5}]),
    S('q7','ì¹œêµ¬ê°€ ìŠ¬í¼ ë³´ì—¬ìš”. ì–´ë–¤ ê·¸ë¦¼ì„ ê·¸ë ¤ì¤„ê¹Œìš”?',['ê·€ì—¬ìš´ ë™ë¬¼',IMG('cute'),{ì„œì‚¬ë ¥:0.5}],['ì¶”ìƒì  ê°ì •',IMG('blue'),{ìƒ‰ê°ê°:0.6}],['ì¦ê±°ìš´ ì¶”ì–µ',IMG('memory'),{ì„œì‚¬ë ¥:0.8,ì†Œí†µë ¥:0.5}],['ë°ê³  í¬ë§ì°¬ ê·¸ë¦¼',IMG('bright'),{ìƒ‰ê°ê°:0.7}]),
    S('q8','í¸ì•ˆí•œ ìƒ‰ ì¡°í•©ì€?',['ë”°ëœ»í•œ ê³„ì—´',IMG('warm'),{ìƒ‰ê°ê°:0.8}],['ì°¨ê°€ìš´ ê³„ì—´',IMG('cool'),{ìƒ‰ê°ê°:0.8}],['ë³´ìƒ‰ ëŒ€ë¹„',IMG('complementary'),{ë„ì „ì„±:0.6}],['íŒŒìŠ¤í…”',IMG('pastel soft'),{ìƒ‰ê°ê°:0.8}]),
    S('q9','ì˜ ì•ˆë  ë•Œ ëª‡ ë²ˆ ì‹œë„í• ê¹Œìš”?',['ë°”ê¾¼ë‹¤',IMG('switch'),{ë„ì „ì„±:0.4}],['ëª‡ ë²ˆ í›„ í¬ê¸°',IMG('try'),{ê¾¸ì¤€ì„±:0.5}],['ë  ë•Œê¹Œì§€ + ë„ì›€ìš”ì²­',IMG('keep'),{ê¾¸ì¤€ì„±:1,ì†Œí†µë ¥:0.5}],['ì›ì¸ ë¶„ì„Â·ìƒˆ ë°©ë²•',IMG('analyze'),{ë„ì „ì„±:0.6}]),
    S('q10','ì´ ê·¸ë¦¼ì—ì„œ ê°€ì¥ ëˆˆì— ë„ëŠ” ê²ƒì€?',['ì „ì²´ êµ¬ë„',IMG('layout'),{ê³µê°„ê°:0.9}],['ì‘ì€ íŒ¨í„´/ì§ˆê°',IMG('texture'),{ë””í…Œì¼:0.9}],['ì¸ë¬¼ í‘œì •/ê°ì •',IMG('face'),{ì„œì‚¬ë ¥:0.7}],['ë…íŠ¹í•œ ì¬ë£Œ/ê¸°ë²•',IMG('tech'),{ë„ì „ì„±:0.7}]),
    S('q11','ë‚´ ê·¸ë¦¼ì˜ ì œëª©ì€?',['ë³´ì´ëŠ” ëŒ€ë¡œ',IMG('see'),{ê´€ì°°ë ¥:0.6}],['ìƒìƒì„ ë¶€ë¥´ëŠ” ì œëª©',IMG('title'),{ì„œì‚¬ë ¥:0.9,ì†Œí†µë ¥:0.5}],['ê¸°ë¶„ ì¢‹ì•„ì§€ëŠ” ì œëª©',IMG('happy'),{ì„œì‚¬ë ¥:0.3}],['ìƒ‰/í˜•íƒœ ê°•ì¡°',IMG('shape'),{ìƒ‰ê°ê°:0.7,ë””í…Œì¼:0.5}]),
    S('q12','ì„¸ìƒì— ì—†ëŠ” ë™ë¬¼, ì–´ë–¤ ë™ë¬¼?',['ì„ì–´ì„œ ë§Œë“  ë™ë¬¼',IMG('hybrid'),{ê´€ì°°ë ¥:0.6,ë””í…Œì¼:0.6}],['ì™„ì „íˆ ìƒˆë¡œìš´ í˜•íƒœ',IMG('new'),{ë„ì „ì„±:0.9}],['ê°ì • í‘œí˜„Â·ëŒ€í™”',IMG('talk'),{ì„œì‚¬ë ¥:0.7,ì†Œí†µë ¥:0.6}],['íŠ¹ë³„í•œ ì¬ë£Œë¡œ ê¾¸ë¯¸ê¸°',IMG('craft'),{ìƒ‰ê°ê°:0.6,ë””í…Œì¼:0.6}]),
    S('q13','ê·¸ë¦¼ì„ ë³´ì—¬ì¤„ ë•Œ ë“£ê³  ì‹¶ì€ ë§ì€?',['ì¹­ì°¬',IMG('praise'),{}],['êµ¬ì²´ì  ì¡°ì–¸',IMG('advice'),{}],['ì´ì•¼ê¸°ê°€ ë– ì˜¬ë¼',IMG('story'),{}],['ì¬ë£Œê°€ ê¶ê¸ˆ',IMG('curious'),{}]),
    S('q14','ë‘ í’ê²½ ì¤‘ ë” ì•ˆì •ì ì¸ êµ¬ë„ëŠ”?',['ê· í˜• ì¡íŒ êµ¬ë„',IMG('balance'),{ê³µê°„ê°:0.9}],['ì¹˜ìš°ì¹œ êµ¬ë„',IMG('tilt'),{ë„ì „ì„±:0.4}],['','',{}],['','',{}]),
    S('q15','ë‹µë‹µí•  ë•Œ ì–´ë–¤ ìƒê°ì„ í•˜ë‚˜ìš”?',['ì¬ëŠ¥ì´ ì—†ë‚˜â€¦',IMG('sad'),{ê¾¸ì¤€ì„±:0.2}],['ì¡°ê¸ˆë§Œ ë”! ìì‹ ê°',IMG('cheer'),{ê¾¸ì¤€ì„±:0.9}],['ë‹¤ë¥¸ ë°©ë²• ë– ì˜¬ë¦¬ê¸°',IMG('newway'),{ë„ì „ì„±:0.6}],['ì™„ì„± ìƒìƒìœ¼ë¡œ ë™ê¸°',IMG('finish'),{ì„œì‚¬ë ¥:0.5,ê¾¸ì¤€ì„±:0.7}])
  ].map(q=>{q.options=q.options.filter(o=>(o.label||o.imageUrl));if(q.options.length<2)q.options=q.options.slice(0,2);return q});
}
</script>
</body>
</html>
