<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>바른미술학원 · 미술적성테스트 V1. BASIC</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

<style>
:root{
  --ink:#0f172a; --muted:#6b7280; --bg:#FFF4EC;
  --card:#ffffff; --line:#eef2f7; --o1:#FFE6CF; --o2:#FFD9BE;
  --mint:#CFF7EE; --vio:#E6E2FF; --radius:22px;
  --shadow:0 18px 60px rgba(16,24,40,.12); --soft:0 12px 30px rgba(16,24,40,.08);
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--ink);font-family:"Pretendard",ui-sans-serif,system-ui,"Noto Sans KR",Segoe UI,Roboto,Arial;background:var(--bg)}
.container{min-height:100dvh;display:flex;flex-direction:column;align-items:center}
.main{width:100%;max-width:1100px;padding:18px;display:flex;flex-direction:column;gap:16px;margin:0 auto}
.header{width:100%;display:flex;justify-content:center}
.brand{width:100%;max-width:1100px;margin-top:10px;display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:999px;background:#fff;border:1px solid var(--line);box-shadow:var(--soft)}
.logo{width:28px;height:28px;border-radius:50%;background:conic-gradient(from 0deg,#FFB98A,#FFE6CF,#E6E2FF,#CFF7EE,#FFB98A);animation:spin 9s linear infinite paused}
.brand:hover .logo{animation-play-state:running}@keyframes spin{to{transform:rotate(360deg)}}
.brand span{font-weight:900;letter-spacing:.2px;display:flex;align-items:center;gap:8px}
.badge{font-size:11px;font-weight:900;padding:4px 8px;border-radius:999px;background:linear-gradient(90deg,#FFE6CF,#FFD9BE);color:#5a3f2f;border:1px solid #ffe0c9}

/* 진행바 */
.sticky{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.95);border:1px solid var(--line);border-radius:16px;box-shadow:var(--soft);padding:8px 10px;display:flex;flex-direction:column;gap:10px}
.navbar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
.step{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;cursor:pointer;background:#fff;color:#374151;font-weight:850;border:1px solid var(--line);box-shadow:var(--soft);transition:transform .12s}
.step:hover{transform:translateY(-1px)}
.step .num{width:20px;height:20px;border-radius:50%;display:inline-grid;place-items:center;background:#fff;border:1px solid var(--line);font-size:12px}
.step.active{background:linear-gradient(90deg,#FFE6CF,#E6E2FF);color:#111827;box-shadow:0 12px 30px rgba(255,214,176,.28)}
.step.done{background:#f2fffa;border-color:#dff7ef}

.topprogress{--steps:15;position:relative;height:30px;background:#f6f7fb;border-radius:999px;overflow:hidden;border:1px solid var(--line)}
.topprogress .bar{position:absolute;inset:0 auto 0 0;width:0;background:linear-gradient(90deg,#B9C8FF,#9DE5D5,#FFD9BE);border-radius:999px;z-index:1;transition:width .35s ease}
.topprogress::before{
  content:"";position:absolute;inset:0;z-index:2;pointer-events:none;
  background-image:linear-gradient(to right, rgba(17,24,39,.08) 0, rgba(17,24,39,.08) 1px, transparent 1px, transparent calc(100%/var(--steps)));
  background-size:calc(100%/var(--steps)) 100%;
}
.topprogress .toplabel{position:absolute;inset:0;display:grid;place-items:center;z-index:3;font-weight:900;font-size:14px;color:#111827;text-shadow:0 1px 0 rgba(255,255,255,.85),0 0 6px rgba(255,255,255,.9)}
.statusline{font-size:12px;color:var(--muted);text-align:center}

.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);animation:fade .35s ease both}
@keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
h1{font-size:34px;margin:0 0 6px}h2{font-size:24px;margin:0 0 10px}h3{font-size:18px;margin:16px 0 8px}
p{margin:8px 0}.small{font-size:13px}.muted{color:var(--muted)}.center{text-align:center}

/* 시작 화면 */
.hero{position:relative;padding:44px 22px;border-radius:22px;border:1px solid var(--line);
  background:radial-gradient(900px 260px at 15% -40%, #FFE6CF 0%, transparent 60%),radial-gradient(900px 260px at 85% -40%, #E6E2FF 0%, transparent 60%),linear-gradient(180deg,#ffffff 0%, #fff9f3 100%)}
.hero .title{font-size:44px;font-weight:900;letter-spacing:.2px;margin:2px 0 6px;color:#111827}
.hero .sub{color:#6b7280;margin-bottom:18px}
.hero .ctaRow{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

/* 버튼 */
.btn{--bg:linear-gradient(90deg,#FFB98A,#FFD9BE);--glow:rgba(255,185,138,.35);background:var(--bg);color:#5a3f2f;border:none;padding:18px 28px;border-radius:18px;font-weight:900;cursor:pointer;box-shadow:0 16px 40px var(--glow);transition:transform .08s,filter .2s;font-size:20px}
.btn:hover{transform:translateY(-1px);filter:brightness(1.03)}
.btn-ghost{background:#fff;color:#111827;border:1px solid var(--line);padding:12px 14px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:var(--soft)}
.btn-mint{--bg:linear-gradient(90deg,#FFE6CF,#FFD9BE)}
.btn-accent{--bg:linear-gradient(90deg,#B9C8FF,#9DE5D5)}
.btn-xl{padding:22px 34px;font-size:22px;border-radius:22px}

/* ADVANCE 버튼(하늘색/네온 느낌) */
.btn-advance{
  --bg:linear-gradient(90deg,#B9E6FF,#9DE5D5);
  --glow:rgba(185,230,255,.45);
  background:var(--bg); color:#0b3c5d;
  box-shadow:0 16px 40px var(--glow), inset 0 -2px 0 rgba(255,255,255,.6);
  border:1px solid #e5f6ff;
}
.btn-advance:hover{filter:brightness(1.04);transform:translateY(-1px)}
.btn-advance:active{transform:translateY(0)}

/* 입력 */
input,select,textarea{width:100%;background:#fff;color:#111;border:1px solid var(--line);border-radius:12px;padding:12px;outline:none}
input:focus,select:focus,textarea:focus{border-color:#FFD9BE;box-shadow:0 0 0 6px rgba(255,217,190,.26)}
label{font-size:14px;color:#374151}
.section{background:#fff;border:1px solid var(--line);border-radius:14px;padding:16px}

.grid{display:grid;gap:14px}.grid-2{grid-template-columns:1fr 1fr}
@media (max-width:860px){.grid-2{grid-template-columns:1fr}}

/* 보기 카드 */
.opt{border:2px solid var(--line);border-radius:20px;overflow:hidden;cursor:pointer;background:#fff;box-shadow:var(--soft);transition:transform .12s,border-color .2s}
.opt:hover{transform:translateY(-2px)}
.opt img{width:100%;display:block;aspect-ratio:4/3;object-fit:cover}
.opt .cap{padding:12px 14px;color:#374151;font-weight:800;font-size:16px;line-height:1.35}
@media (min-width:1024px){
  .test-grid-4{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
  .test-grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
  .sideNav{position:fixed;top:50%;transform:translateY(-50%);z-index:20}
  .sideNav.left{left:18px}.sideNav.right{right:18px}
  .sideBtn{background:linear-gradient(90deg,#fff,#FFF4EC);border:1px solid var(--line);width:46px;height:46px;border-radius:50%;display:grid;place-items:center;box-shadow:0 12px 26px rgba(16,24,40,.08);cursor:pointer;font-weight:900}
  .sideBtn:hover{transform:translateY(-1px)}
}
@media (max-width:1023px){.sideNav{display:none}}
.opt.sel{border-color:#FFD9BE;box-shadow:0 0 0 6px rgba(255,217,190,.25)}

/* 동의 아코디언 */
.acc{border-radius:14px;overflow:hidden;border:1px solid var(--line)}.acc-item{border-top:1px solid var(--line)}
.acc-head{padding:14px 16px;background:#FFF4EC;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.acc-head span{font-weight:900;font-size:17px}.acc-body{padding:14px 16px;display:none;background:#fff}
.acc-item.open .acc-body{display:block}
.agreeList{display:grid;gap:10px;margin-top:10px}
.agree-row{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#fff}
.agree-row .txt{font-size:15px;color:#0f172a;line-height:1.55;font-weight:700}
.agree-row input[type="checkbox"]{width:20px;height:20px;accent-color:#FFB98A}

/* ====== 결과 레이아웃(3차트) ====== */
.block{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 26px rgba(16,24,40,.06);page-break-inside:avoid;break-inside:avoid}
.block h3{margin:0 0 10px}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{background:linear-gradient(90deg,#FFE6CF,#FFD9BE);color:#5a3f2f;border:1px solid #ffe8d6;padding:8px 12px;border-radius:999px;font-weight:900}
.callout{position:relative;background:linear-gradient(135deg,#FFF2E6,#F8FBFF);padding:22px;border-radius:18px;border:1px solid var(--line);box-shadow:0 12px 34px rgba(255,185,138,.25)}
.callout:before{content:"";position:absolute;inset:-1px;border-radius:18px;padding:1px;background:linear-gradient(90deg,#FFD9BE,#E6E2FF,#CFF7EE);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude}

/* 3차트 고정 */
.report-grid{display:grid;grid-template-columns:3fr 2fr;gap:16px}
.right-stack{display:grid;grid-template-rows:1fr 1fr;gap:16px}
.chartBox{height:420px;border:1px solid var(--line);border-radius:14px;padding:10px;background:#fff}
.right-stack .chartBox{height:200px}
.chartBox canvas{width:100% !important;height:100% !important;display:block}

/* 프린트 & PDF */
@media print{.header,.sticky,.btn,.btn-ghost,.sideNav,.no-pdf{display:none !important}.card{box-shadow:none;border:1px solid #ddd}.block{break-inside:avoid-page}}
.pdf-screen-width{width:794px;max-width:none;margin:0 auto}

/* 이메일 모달 */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:999}
.modal-backdrop.show{display:flex}
.modal{width:min(520px,92vw);background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 18px 60px rgba(16,24,40,.18);padding:18px}
.modal h3{margin:0 0 10px}.modal .row{display:grid;gap:8px;margin:10px 0}.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
</style>
</head>
<body>
<div class="container" id="appRoot">
  <div class="header">
    <div class="brand">
      <div class="logo"></div>
      <span>바른미술학원 · 미술적성테스트 <span class="badge">V1. BASIC</span></span>
    </div>
  </div>

  <main class="main" aria-live="polite">
    <div class="sticky">
      <nav class="navbar" id="topnav"></nav>
      <div class="topprogress" id="topprogress">
        <div id="topbar" class="bar"></div>
        <div id="toplabel" class="toplabel"></div>
      </div>
      <div class="statusline" id="statusline">진행률 0%</div>
    </div>
    <section class="card" id="app"></section>
  </main>
</div>

<div class="sideNav left" id="sideLeft" style="display:none"><button class="sideBtn" onclick="prev()" aria-label="이전">‹</button></div>
<div class="sideNav right" id="sideRight" style="display:none"><button class="sideBtn" onclick="next()" aria-label="다음">›</button></div>

<!-- 이메일 모달 -->
<div class="modal-backdrop" id="emailModal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="modal">
    <h3>이메일로 결과 보내기</h3>
    <div class="row">
      <label>받는 사람 이메일</label>
      <input type="email" id="emailTo" placeholder="example@email.com">
    </div>
    <div class="row">
      <label>제목</label>
      <input type="text" id="emailSubject" value="">
    </div>
    <div class="actions">
      <button class="btn-ghost" id="emailCancel">취소</button>
      <button class="btn btn-accent" id="emailSend">보내기</button>
    </div>
    <div class="small muted" id="emailMsg" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* ===== 상수 ===== */
var APP_TITLE='바른미술학원 · 미술적성테스트 V1. BASIC';
var SHEET_ID='14VLQBhDJtduxjCnfr7VEOstZ5ez8-CX3ArXy1OvYCQg';
var GVIZ_URL='https://docs.google.com/spreadsheets/d/'+SHEET_ID+'/gviz/tq?sheet=Questions&tqx=out:json';
var FORM_ACTION='https://docs.google.com/forms/d/e/1FAIpQLSeRWq5YKN50zL0simiaQA6EBRsn6VXN__ZmLplAgDz1I1hyQA/formResponse';
var EMAIL_FUNCTION_URL='/.netlify/functions/send-email';

/* Google Form 항목 매핑 */
var F={child_name:'entry.684468179',age:'entry.1066070471',grade:'entry.1812672802',guardian:'entry.1666083184',phone:'entry.89824848',campus:'entry.490719219',answers:'entry.85364862',scores:'entry.1455508168',top3:'entry.2120338430',resultId:'entry.532514127',timestamp:'entry.1261684833'};

var ASSET_BASE='/img';
var DOMAINS=["관찰력","색감각","서사력","공간감","디테일","도전성","소통력","꾸준성"];
var STEPS=[{key:'start',label:'시작'},{key:'consent',label:'동의'},{key:'profile',label:'프로필'},{key:'test',label:'테스트'},{key:'result',label:'결과'},{key:'details',label:'자세한 결과'}];
var STATE={step:'start',consent:false,profile:{},questions:[],idx:0,answers:[],result:null};

function $(id){return document.getElementById(id)}
function app(){return $('app')}

/* NAV + Progress */
function renderNav(){
  var cur=STEPS.findIndex(function(s){return s.key===STATE.step});
  $('topnav').innerHTML=STEPS.map(function(s,i){
    return '<div class="step '+(s.key===STATE.step?'active':'')+' '+(cur>i?'done':'')+'" onclick="navGo(\''+s.key+'\')"><span class="num">'+(i+1)+'</span><span>'+s.label+'</span></div>';
  }).join('');
}
function updateTopProgress(){
  var topbar=$('topbar'); var toplabel=$('toplabel'); var tp=$('topprogress'); var status=$('statusline');
  if(STATE.step==='test'&&STATE.questions.length){
    status.style.display='none';
    var total=STATE.questions.length;
    var curIndex=STATE.idx+1;
    var pct=Math.max(0, Math.min(100, Math.round((STATE.idx)/total*100)));
    topbar.style.width=pct+'%';
    toplabel.textContent='('+curIndex+'/'+total+')';
    tp.style.setProperty('--steps', String(total));
    $('sideLeft').style.display='block';
    $('sideRight').style.display='block';
    return;
  }
  $('sideLeft').style.display='none';
  $('sideRight').style.display='none';
  toplabel.textContent='';
  status.style.display='block';
  var p=(STEPS.findIndex(function(s){return s.key===STATE.step}))/(STEPS.length-1)*100;
  topbar.style.width=Math.round(p)+'%';
  $('statusline').textContent='진행률 '+Math.round(p)+'%';
}
function navGo(step){STATE.step=step;if(step==='test'&&STATE.questions.length===0){startTest();return;}render()}

/* GViz 파서 */
function parseGViz(text){
  var s=text.indexOf('{'),e=text.lastIndexOf('}');
  if(s<0||e<0)return[];
  var obj=JSON.parse(text.slice(s,e+1));
  var cols=obj.table.cols.map(function(c){return c.label});
  return obj.table.rows.map(function(r){return r.c.map(function(c){return c?(c.f!=null?c.f:c.v):''})})
           .map(function(a){return Object.fromEntries(cols.map(function(k,i){return [k,a[i]]}))});
}
async function loadQuestions(){
  try{
    var txt=await (await fetch(GVIZ_URL)).text();
    var rows=parseGViz(txt)||[];
    var act=rows.filter(function(r){return String(r.active).toUpperCase()==='TRUE'})
                .sort(function(a,b){return(+a.order-(+b.order))});
    if(act.length){
      STATE.questions=act.map(function(r){
        function mkWeights(k){try{return JSON.parse(r[k+'_weights'])||{}}catch(_){return{}}}
        function mkOpt(k){return {key:k,label:(r[k+'_label']||'').trim(),imageUrl:(r[k+'_image']||'').trim(),weights:mkWeights(k)}}
        var opts=['A','B','C','D'].map(mkOpt).filter(function(o){
          var hasLabel=o.label.length>0,hasImage=o.imageUrl.length>0,hasWeight=Object.values(o.weights||{}).some(function(v){return Number(v||0)!==0});
          return hasLabel||hasImage||hasWeight;
        });
        if(opts.length<2)opts=['A','B'].map(mkOpt);
        return{id:r.id||('q'+r.order),order:+r.order,prompt:r.prompt||'',options:opts};
      });
      return;
    }
  }catch(e){}
  STATE.questions=localQuestions()
}

/* 시작 화면 */
function startScreen(){
  return '<div class="hero">'
    +'<div class="title center">'+APP_TITLE+'</div>'
    +'<div class="sub center">아이의 미술 적성과 잠재력을 간단히 확인하고, 결과를 저장·이메일 전송할 수 있어요.</div>'
    +'<div class="ctaRow">'
      +'<button class="btn btn-xl" id="startBtn">테스트 시작하기 →</button>'
      +'<a class="btn btn-advance btn-xl" href="index2.html" style="text-decoration:none;display:inline-block">ADVANCE 테스트</a>'
    +'</div>'
  +'</div>'
  +'<section class="features" style="margin:20px auto 8px;max-width:980px">'
    +'<h2 style="text-align:center;font-weight:900">테스트 특징</h2>'
    +'<p class="sub" style="text-align:center;color:#6b7280;margin:0 0 16px">아이의 미술 흥미·성향을 파악해 도움 되는 교육 포인트를 제시합니다</p>'
    +'<div class="grid" style="grid-template-columns:repeat(3,1fr);gap:14px">'
      +'<div class="card" style="display:flex;align-items:center;gap:12px"><div class="badge" style="font-size:18px">⏱</div><div><b>빠른 테스트</b><div class="small muted">5–8분 내 완료</div></div></div>'
      +'<div class="card" style="display:flex;align-items:center;gap:12px"><div class="badge" style="font-size:18px">🎯</div><div><b>맞춤 분석</b><div class="small muted">강점/교육 포인트</div></div></div>'
      +'<div class="card" style="display:flex;align-items:center;gap:12px"><div class="badge" style="font-size:18px">⚡</div><div><b>즉시 결과</b><div class="small muted">저장/이메일 전송</div></div></div>'
    +'</div>'
    +'<div class="small muted center" style="margin-top:12px">※ 본 테스트는 <b>교육 가이드</b> 목적이며, 의학/임상 진단이 아닙니다.</div>'
  +'</section>';
}
function viewStart(){app().innerHTML=startScreen();$('startBtn').onclick=function(){navGo('consent')};window.scrollTo({top:0,behavior:'smooth'})}

/* 동의서 */
function accItem(t,html){return '<div class="acc-item open"><div class="acc-head"><span>'+t+'</span><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div class="acc-body small">'+html+'</div></div>'}
function viewConsent(){
  app().innerHTML='<h2 class="center">개인정보 수집·이용 동의서</h2>'
  +'<p class="muted small center">본 테스트는 <b>교육 가이드</b> 목적이며, 의학/임상 진단이 아닙니다.</p>'
  +'<div class="acc">'
    +accItem('<b>1) 목적</b>','① 테스트 제공 및 결과 산출 ② 결과 안내·PDF 저장 지원 ③ 상담 품질 개선')
    +accItem('<b>2) 수집 항목</b>','아동 이름·나이·학년 / 보호자 이름·연락처 / 응답 내용 (이메일은 선택)')
    +accItem('<b>3) 보관 기간</b>','수집일로부터 <b>12개월</b> 보관 후 파기')
    +accItem('<b>4) 보관/처리</b>','Google Forms/Sheets에 저장·처리')
    +accItem('<b>5) 권리</b>','동의 거부 가능(거부 시 서비스 제한 가능)')
    +accItem('<b>6) 문의</b>','barunart1004@gmail.com')
  +'</div>'
  +'<div class="section" style="margin-top:16px">'
    +'<div class="agreeList">'
      +'<div class="agree-row"><div class="txt">(필수) 개인정보 수집·이용에 <b>동의합니다.</b></div><input type="checkbox" id="chk_required" /></div>'
      +'<div class="agree-row"><div class="txt">(필수) 만 14세 미만 아동의 법정대리인으로서 <b>동의합니다.</b></div><input type="checkbox" id="chk_minor" /></div>'
    +'</div>'
  +'</div>'
  +'<div class="center" style="margin-top:16px;display:flex;gap:8px;justify-content:center">'
    +'<button class="btn" id="btn_consent" disabled>동의하고 진행</button>'
    +'<button class="btn-ghost" id="btn_expand">전문 펼치기</button>'
    +'<button class="btn-ghost" id="btn_collapse">모두 접기</button>'
  +'</div>';
  function validate(){ $('btn_consent').disabled=!( $('chk_required').checked && $('chk_minor').checked ); }
  $('chk_required').addEventListener('change',validate);$('chk_minor').addEventListener('change',validate);
  $('btn_consent').onclick=function(){STATE.consent=true;navGo('profile')};
  $('btn_expand').onclick=function(){document.querySelectorAll('.acc-item').forEach(function(it){it.classList.add('open')})};
  $('btn_collapse').onclick=function(){document.querySelectorAll('.acc-item').forEach(function(it){it.classList.remove('open')})};
  document.querySelectorAll('.acc-head').forEach(function(h){h.addEventListener('click',function(){h.parentElement.classList.toggle('open')})});
}

/* 프로필 */
var AGE_TO_GRADE={7:'초등학교 1학년',8:'초등학교 2학년',9:'초등학교 3학년',10:'초등학교 4학년',11:'초등학교 5학년',12:'초등학교 6학년'};
var GRADE_TO_AGE={}; Object.keys(AGE_TO_GRADE).forEach(function(a){GRADE_TO_AGE[AGE_TO_GRADE[a]]=a});
var CAMPUSES=['압구정[본원]','반포 캠퍼스','한남 캠퍼스','방배 캠퍼스','목동 캠퍼스','송파 캠퍼스','서대문 캠퍼스','일산 캠퍼스','탄현 캠퍼스','김포 캠퍼스','송도 캠퍼스','부산 캠퍼스'];

function viewProfile(){
  app().innerHTML='<h2 class="center">프로필 정보</h2>'
  +'<div class="grid grid-2" style="margin-top:8px">'
    +'<div class="section"><label>아동 이름</label><input id="cname" placeholder="예: 홍길동"></div>'
    +'<div class="section"><label>보호자 이름</label><input id="gname" placeholder="예: 김보호자"></div>'
    +'<div class="section"><label>나이</label><select id="age">'+[7,8,9,10,11,12].map(function(a){return '<option value="'+a+'">'+a+'</option>'}).join('')+'</select></div>'
    +'<div class="section"><label>학년</label><select id="grade">'+Object.values(AGE_TO_GRADE).map(function(g){return '<option>'+g+'</option>'}).join('')+'</select></div>'
    +'<div class="section"><label>연락처</label><input id="phone" placeholder="010-0000-0000"></div>'
    +'<div class="section"><label>이메일(선택, 결과지 전송용)</label><input id="email" placeholder="example@email.com"></div>'
    +'<div class="section"><label>캠퍼스</label><select id="campus">'+CAMPUSES.map(function(c){return '<option value="'+c+'">'+c+'</option>'}).join('')+'</select></div>'
  +'</div>'
  +'<div class="center" style="margin-top:16px"><button class="btn btn-mint" id="btn_starttest">테스트 시작</button></div>';
  $('age').addEventListener('change',function(e){$('grade').value=AGE_TO_GRADE[e.target.value]});
  $('grade').addEventListener('change',function(e){$('age').value=GRADE_TO_AGE[e.target.value]});
  $('btn_starttest').onclick=startTest;
}
async function startTest(){
  STATE.profile={child_name:$('cname').value.trim(),guardian:$('gname').value.trim(),age:$('age').value,grade:$('grade').value,phone:$('phone').value.trim(),email:$('email').value.trim(),campus:$('campus').value};
  if(!STATE.profile.child_name){alert('아동 이름을 입력해 주세요');return;}
  if(!/^0\d{1,2}-?\d{3,4}-?\d{4}$/.test(STATE.profile.phone||'')){alert('연락처 형식(010-0000-0000)을 확인해 주세요');return;}
  await loadQuestions();STATE.idx=0;STATE.answers=[];STATE.step='test';render();
}

/* 테스트 */
function pcGridClassFor(n){if(window.matchMedia('(min-width:1024px)').matches){return n===2?'test-grid-2':'test-grid-4'}return'grid grid-2'}
function optionImageUrl(q,o){if(o.imageUrl)return o.imageUrl;var num=Number(q.order)||(STATE.idx+1);return ASSET_BASE+'/'+num+'-'+o.key+'.png'}
function viewTest(){
  var q=STATE.questions[STATE.idx];if(!q){app().innerHTML='<h3 class="center">문항을 불러오지 못했습니다. 관리자에 문의해 주세요.</h3>';return;}
  var gridCls=pcGridClassFor(q.options.length);
  app().innerHTML='<div class="center small muted"><span class="chip">Q '+(STATE.idx+1)+' / '+STATE.questions.length+'</span></div>'
    +'<h2 class="center" style="margin-top:10px">'+(q.prompt||'')+'</h2>'
    +'<div class="'+gridCls+'" style="margin-top:12px">'
      + q.options.map(function(o){
        return '<div class="opt" id="opt_'+o.key+'" tabindex="0" role="button" aria-label="'+(o.label||o.key)+'" data-key="'+o.key+'">'
          +'<img src="'+optionImageUrl(q,o)+'" alt="'+(o.label||o.key)+'" onerror="this.style.opacity=.2" loading="lazy">'
          +'<div class="cap center">'+(o.label||o.key)+'</div>'
        +'</div>';
      }).join('')
    +'</div>'
    +'<div class="center" style="margin-top:18px;display:flex;gap:10px;justify-content:center">'
      +'<button class="btn-ghost" id="btn_prev" '+(STATE.idx===0?'disabled':'')+'>이전</button>'
      +'<button class="btn" id="btn_next" disabled>다음</button>'
    +'</div>';
  q.options.forEach(function(o){var el=document.getElementById('opt_'+o.key);el.onclick=function(){choose(o.key)};el.onkeydown=function(e){if(e.key==='Enter'||e.key===' ')choose(o.key)}})
  $('btn_prev').onclick=prev;$('btn_next').onclick=next;
}
function choose(key){
  var q=STATE.questions[STATE.idx];
  q.options.forEach(function(k){var n=document.getElementById('opt_'+k.key);if(n)n.classList.remove('sel')});
  var node=document.getElementById('opt_'+key);if(node){node.classList.add('sel');node.animate([{transform:'scale(1)'},{transform:'scale(.98)'},{transform:'scale(1)'}],{duration:160})}
  var opt=q.options.find(function(o){return o.key===key});STATE.answers[STATE.idx]={qid:q.id,key:key,weights:opt.weights||{}};$('btn_next').disabled=false;
}
function next(){if(STATE.step!=='test')return;if(!STATE.answers[STATE.idx]){alert('하나를 선택해 주세요');return;}if(STATE.idx<STATE.questions.length-1){STATE.idx++;render();}else{submitAllSafe();}}
function prev(){if(STATE.idx>0){STATE.idx--;render();}}
document.addEventListener('keydown',function(e){if(STATE.step!=='test')return;if(e.key==='ArrowRight')next();if(e.key==='ArrowLeft')prev();if(e.key==='Enter'){if(!$('btn_next').disabled)next();}});

/* 점수/멘트 */
function aggregateScores(ans){var sum={};DOMAINS.forEach(function(d){sum[d]=0});ans.forEach(function(a){Object.keys(a.weights||{}).forEach(function(k){sum[k]=(sum[k]||0)+Number((a.weights||{})[k]||0)})});var n=ans.length||1;var raw={};DOMAINS.forEach(function(d){var v=(sum[d]||0)/n*4;raw[d]=Math.max(0,Math.round(v*10)/10)});return raw}
function adjust(v){return Math.round((2+v/2)*10)/10}
function band(v){if(v>=3.6)return'S';if(v>=3.2)return'A';if(v>=2.8)return'A-';if(v>=2.4)return'B+';if(v>=2.0)return'B';if(v>=1.6)return'B-';if(v>=1.0)return'C+';return'C'}
var PRAISE={'S':function(k){return'와, '+k+'에서 <b>타고난 재능</b>이 돋보입니다. 높은 난이도도 스스로 기획해볼 수 있어요.'},'A':function(k){return k+' 감각이 <b>뛰어납니다</b>. 한 단계 높은 과제도 무리 없이 소화합니다.'},'A-':function(k){return k+' 실력이 <b>탄탄</b>합니다. 약간의 다듬기로 금방 상위권을 노려요.'},'B+':function(k){return k+'이 안정적입니다. 새로운 시도에도 잘 적응합니다.'},'B':function(k){return k+' 기본기가 좋습니다. 루틴을 넓히면 <b>성장 가속</b>!'}}

/* 이론/전문가 */
var DETAIL={'관찰력':function(n){return n+'님은 대상의 특징을 캐치하는 눈이 좋아요. 작은 변화도 포착해 표현의 밀도를 높입니다.'},'색감각':function(n){return n+'님은 색의 분위기를 읽고 조합하는 감이 탁월합니다. 미묘한 톤 차이도 안정적으로 다룹니다.'},'서사력':function(n){return n+'님은 장면 속에 이야기를 심는 데 강점이 있어요. 감정과 사건을 자연스럽게 연결합니다.'},'공간감':function(n){return n+'님은 원근·스케일을 활용해 입체감을 살립니다. 장면의 깊이를 안정적으로 구성합니다.'},'디테일':function(n){return n+'님은 마감과 질감 표현이 섬세해요. 작품 완성도를 올리는 집중력이 강점입니다.'},'도전성':function(n){return n+'님은 새로운 도구와 방식에 두려움이 적어요. 실험적인 프로젝트에서 성장 속도가 빠릅니다.'},'소통력':function(n){return n+'님은 의도를 언어로 풀어내는 힘이 좋아요. 발표·비평 활동에서 설득력이 있습니다.'},'꾸준성':function(n){return n+'님은 루틴을 유지하며 완성까지 밀어붙이는 힘이 돋보입니다. 학습 지속력이 강합니다.'}}

/* 제출 & 결과 */
function nowKST(){var d=new Date(),p=function(n){return String(n).padStart(2,'0')};return d.getFullYear()+'-'+p(d.getMonth()+1)+'-'+p(d.getDate())+' '+p(d.getHours())+':'+p(d.getMinutes())+' KST'}
async function submitAllSafe(){
  var raw=aggregateScores(STATE.answers);
  var scores={}; Object.keys(raw).forEach(function(k){scores[k]=adjust(raw[k])});
  var ordered=Object.keys(scores).sort(function(a,b){return scores[b]-scores[a]});
  var top3=ordered.slice(0,3);
  var resultId=(crypto&&crypto.randomUUID)?crypto.randomUUID():('r'+Date.now());
  var form=new FormData();
  form.append(F.child_name,STATE.profile.child_name);form.append(F.age,STATE.profile.age);form.append(F.grade,STATE.profile.grade);
  form.append(F.guardian,STATE.profile.guardian);form.append(F.phone,STATE.profile.phone);form.append(F.campus,STATE.profile.campus||'');
  form.append(F.answers,JSON.stringify({profile:STATE.profile,questions:STATE.answers,top3:top3}));
  form.append(F.scores,JSON.stringify(scores));form.append(F.top3,top3.join(','));form.append(F.resultId,resultId);form.append(F.timestamp,nowKST());
  try{await fetch(FORM_ACTION,{method:'POST',mode:'no-cors',body:form});}catch(e){}
  STATE.result={scores:scores,top3:top3,resultId:resultId};STATE.step='result';render();
}

var CHARTS=[];function destroyCharts(){CHARTS.forEach(function(c){try{c.destroy()}catch(_){}});CHARTS=[]}

/* 결과(3차트 + 표기 제거) */
function viewResult(){
  var r=STATE.result||{}; var s=r.scores||{}; var ordered=Object.keys(s).sort(function(a,b){return s[b]-s[a]});
  var top3=ordered.slice(0,3);
  var potential=ordered.slice(3,7); // 차순 4개

  var longSummary=[
    STATE.profile.child_name+'님은 <b>'+top3[0]+'</b>를 중심으로 <b>'+top3[1]+'</b>, <b>'+top3[2]+'</b>에서 강점이 뚜렷합니다.',
    '선택 과정에서 주의집중이 안정적이며, 과제를 빠르게 파악해 핵심을 잡는 유형입니다.',
    '강점을 루틴으로 확장해 작은 완성을 자주 만드는 전략이 동기 유지에 특히 효과적입니다.'
  ].join(' ');

  app().innerHTML='<div id="pdfArea" class="pdf-screen-width">'
    +'<div class="block callout" style="text-align:center">'
      +'<div class="chip" style="margin:0 auto 8px;display:inline-block">테스트 완료</div>'
      +'<h2 style="margin:0 0 10px"><b>'+STATE.profile.child_name+'</b>님, 멋진 집중력이었습니다!</h2>'
      +'<div class="chips" style="margin-top:10px;justify-content:center">'+top3.map(function(t){return '<span class="chip">뛰어난 영역: '+t+'</span>'}).join('')+'</div>'
    +'</div>'

    +'<div class="block">'
      +'<h3 class="center">프로파일 & 주요 지표</h3>'
      +'<div class="report-grid" style="margin-top:8px">'
        +'<div class="chartBox"><canvas id="radar"></canvas></div>'
        +'<div class="right-stack">'
          +'<div class="chartBox"><canvas id="barsTop3"></canvas></div>'
          +'<div class="chartBox"><canvas id="barsPotential"></canvas></div>'
        +'</div>'
      +'</div>'
    +'</div>'

    +'<div class="block"><h3>총평</h3><p style="color:#0f172a;font-size:15px;line-height:1.7">'+longSummary+'</p></div>'

    + makeInterpretationBlock(s)

  +'</div>'

  +'<div class="center no-pdf" style="margin-top:16px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">'
    +'<button class="btn-ghost" onclick="STATE.step=\'start\'; render()">처음으로</button>'
    +'<button class="btn btn-mint" id="btn_pdf">PDF 저장</button>'
    +'<button class="btn btn-accent" id="btn_email">이메일로 보내기</button>'
  +'</div>';

  destroyCharts();

  // 레이더: 전체 8영역
  var rctx=document.getElementById('radar').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(rctx,{type:'radar',
    data:{labels:DOMAINS,datasets:[{data:DOMAINS.map(function(k){return s[k]||0}),borderColor:'#FFB98A',backgroundColor:'rgba(255,185,138,.22)',borderWidth:2,pointRadius:3,fill:true}]},
    options:{maintainAspectRatio:false,animation:{duration:800},scales:{r:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'#eef2f7'},angleLines:{color:'#eef2f7'}}},plugins:{legend:{display:false}}}
  }));

  // TOP3
  var b1=document.getElementById('barsTop3').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(b1,{type:'bar',
    data:{labels:top3,datasets:[{data:top3.map(function(k){return s[k]||0}),borderRadius:12,borderSkipped:false,backgroundColor:['#FFD9BE','#E6E2FF','#CFF7EE']}]},
    options:{maintainAspectRatio:false,animation:{duration:700},scales:{y:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'#f1f5f9'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}
  }));

  // 차순 4개
  var b2=document.getElementById('barsPotential').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(b2,{type:'bar',
    data:{labels:potential,datasets:[{data:potential.map(function(k){return s[k]||0}),borderRadius:12,borderSkipped:false,backgroundColor:['#E6E2FF','#CFF7EE','#FFD9BE','#FFEBC8']}]},
    options:{maintainAspectRatio:false,animation:{duration:700},scales:{y:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'#f1f5f9'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}
  }));

  $('btn_pdf').onclick=handleSavePdf;$('btn_email').onclick=openEmailModal;
}

/* 항목별 해석 */
function makeInterpretationBlock(scores){
  return '<div class="block"><h3>항목별 해석</h3>'
    +'<div class="grid" style="grid-template-columns:1fr 1fr">'
      + DOMAINS.map(function(k){
          var v=+(scores[k]||0);
          var w=Math.min(100,(v/4)*100);
          var b=band(v);
          var praiseFn=PRAISE[b]||function(){return k+'에서 꾸준히 성장 중입니다.'};
          return '<div style="border:1px solid var(--line);border-radius:12px;padding:14px;background:#fff;box-shadow:0 10px 26px rgba(16,24,40,.06)">'
            +'<div style="font-weight:900;margin-bottom:6px">'+k+'</div>'
            +'<div class="topprogress" style="height:10px;margin:8px 0 10px">'
              +'<div style="width:'+w+'%;height:100%;background:linear-gradient(90deg,#B9C8FF,#9DE5D5,#FFD9BE)"></div>'
            +'</div>'
            +'<div class="small" style="color:#0f172a">'+DETAIL[k](STATE.profile.child_name)+'</div>'
            +'<div class="small" style="margin-top:6px;color:#0f172a">'+praiseFn(k)+'</div>'
          +'</div>';
        }).join('')
    +'</div></div>';
}

/* ===== PDF/이메일 (기존과 동일) ===== */
function buildPdfWrapperFrom(node){
  var wrap=document.createElement('div');
  wrap.style.position='fixed';wrap.style.left='-10000px';wrap.style.top='0';
  wrap.style.width='794px';wrap.style.background='#fff';wrap.style.zIndex='-1';
  var clone=node.cloneNode(true);
  clone.querySelectorAll('img').forEach(function(img){img.setAttribute('crossorigin','anonymous');img.referrerPolicy='no-referrer';img.src=img.src});
  var srcC=node.querySelectorAll('canvas');var dstC=clone.querySelectorAll('canvas');
  srcC.forEach(function(src,i){var dst=dstC[i];if(!dst)return;dst.width=src.width;dst.height=src.height;dst.getContext('2d',{willReadFrequently:true}).drawImage(src,0,0)});
  wrap.appendChild(clone);document.body.appendChild(wrap);
  return wrap;
}
function waitForAssets(root){
  var imgs=[].slice.call(root.querySelectorAll('img'));
  var imgPromises=imgs.map(function(img){return img.complete?Promise.resolve():new Promise(function(res){img.onload=function(){res()};img.onerror=function(){res()}})});
  var fontsReady=('fonts'in document)?document.fonts.ready:Promise.resolve();
  return Promise.all([fontsReady].concat(imgPromises));
}
async function html2pdfBlob(wrapper){
  var opt={margin:[8,8,8,8],
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2,useCORS:true,backgroundColor:'#ffffff',removeContainer:true,windowWidth:wrapper.scrollWidth,windowHeight:wrapper.scrollHeight},
    pagebreak:{mode:['css','legacy']},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}};
  return await html2pdf().set(opt).from(wrapper).output('blob');
}
async function canvasSlicerBlob(wrapper){
  var h2c=window.html2canvas;
  var canvas=await h2c(wrapper,{scale:2,useCORS:true,allowTaint:true,backgroundColor:'#ffffff',scrollX:0,scrollY:0,windowWidth:wrapper.scrollWidth,windowHeight:wrapper.scrollHeight});
  var jsPDF=window.jspdf.jsPDF;
  var pdf=new jsPDF({unit:'mm',format:'a4',orientation:'portrait'});
  var pxToMm=210/canvas.width;
  var pageHeightPx=Math.floor(297/pxToMm);
  var y=0,page=0;
  while(y<canvas.height){
    var sliceHeight=Math.min(pageHeightPx,canvas.height-y);
    var pageCanvas=document.createElement('canvas');
    pageCanvas.width=canvas.width;pageCanvas.height=sliceHeight;
    var ctx=pageCanvas.getContext('2d',{willReadFrequently:true});
    ctx.drawImage(canvas,0,y,canvas.width,sliceHeight,0,0,canvas.width,sliceHeight);
    var img=pageCanvas.toDataURL('image/jpeg',0.98);
    var mmHeight=sliceHeight*pxToMm;
    if(page>0) pdf.addPage();
    pdf.addImage(img,'JPEG',0,0,210,mmHeight);
    y+=sliceHeight;page++;
  }
  return pdf.output('blob');
}
async function exportPdfBlob(node){
  var wrapper=buildPdfWrapperFrom(node);
  await waitForAssets(wrapper);
  try{
    var blob=await html2pdfBlob(wrapper);
    if(!blob || blob.size<5000){ blob=await canvasSlicerBlob(wrapper); }
    return blob;
  }catch(e){
    try{ return await canvasSlicerBlob(wrapper); }
    catch(e2){ throw e2; }
  }finally{ wrapper.remove(); }
}
async function handleSavePdf(){
  var node=$('pdfArea');
  node.classList.add('pdf-screen-width');
  await new Promise(function(r){setTimeout(r,50)});
  try{
    var blob=await exportPdfBlob(node);
    var filename=STATE.profile.child_name+'_미술적성테스트_V1_BASIC.pdf';
    var url=URL.createObjectURL(blob);var a=document.createElement('a');a.href=url;a.download=filename;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
  }catch(e){console.error(e);alert('PDF 저장 중 오류가 발생했습니다.')}
  finally{node.classList.remove('pdf-screen-width');}
}

/* 이메일 모달 */
function setModalVisible(show){var m=$('emailModal');if(show){m.classList.add('show');m.setAttribute('aria-hidden','false');document.body.style.overflow='hidden'}else{m.classList.remove('show');m.setAttribute('aria-hidden','true');document.body.style.overflow=''}}
function openEmailModal(){setModalVisible(true);$('emailSubject').value=STATE.profile.child_name+' 테스트 결과입니다';$('emailTo').value=STATE.profile.email||'';$('emailMsg').textContent=''}
$('emailCancel').onclick=function(){setModalVisible(false)};document.addEventListener('keydown',function(e){if(e.key==='Escape')setModalVisible(false)});

function blobToBase64(blob){return new Promise(function(resolve,reject){var reader=new FileReader();reader.onloadend=function(){resolve(reader.result.split(',')[1])};reader.onerror=reject;reader.readAsDataURL(blob)})}
$('emailSend').onclick=async function(){
  var to=$('emailTo').value.trim();if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(to)){ $('emailMsg').textContent='이메일 형식을 확인해 주세요.'; return; }
  $('emailMsg').textContent='PDF 생성 중...';
  var base64='';try{var blob=await exportPdfBlob($('pdfArea'));base64=await blobToBase64(blob)}catch(e){$('emailMsg').textContent='PDF 생성에 실패했습니다.';return}
  $('emailMsg').textContent='이메일 전송 중...';
  var subject=$('emailSubject').value.trim()|| (STATE.profile.child_name+' 테스트 결과입니다');
  var htmlBody='<div style="font-family:Pretendard,Apple SD Gothic Neo,Segoe UI,Arial"><h2 style="margin:0 0 8px">'+APP_TITLE+'</h2><p><b>'+STATE.profile.child_name+'</b> 님의 결과지를 첨부했습니다.</p><p>캠퍼스: '+(STATE.profile.campus||'-')+' / 연락처: '+(STATE.profile.phone||'-')+'</p><p style="color:#6b7280;font-size:12px;margin-top:12px">본 메일은 자동 발송되었습니다.</p></div>';
  try{
    var res=await fetch(EMAIL_FUNCTION_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({to:to,subject:subject,html:htmlBody,attachmentName:STATE.profile.child_name+'_미술적성테스트_V1_BASIC.pdf',attachmentBase64:base64})});
    var ok=res.ok;var data={};try{data=await res.json()}catch(_){}
    if(ok){$('emailMsg').textContent='전송 완료! 메일함을 확인해 주세요.';setTimeout(function(){setModalVisible(false)},1200)}
    else{$('emailMsg').textContent='전송 실패: '+(data.error||res.statusText)}
  }catch(err){$('emailMsg').textContent='전송 중 오류가 발생했습니다.'}
}

/* Router */
function render(){renderNav();updateTopProgress();if(STATE.step==='start')return viewStart();if(STATE.step==='consent')return viewConsent();if(STATE.step==='profile')return viewProfile();if(STATE.step==='test')return viewTest();if(STATE.step==='result')return viewResult();if(STATE.step==='details')return viewDetails()}
render();

/* Fallback 문항 */
function W(w){var o={};DOMAINS.forEach(function(k){o[k]=0});Object.keys(w).forEach(function(k){o[k]=w[k]});return o}
function localQuestions(){
  function S(q,p,a,b,c,d){return{id:q,order:+q.replace('q',''),prompt:p,options:[
    {key:'A',label:a[0],imageUrl:a[1],weights:W(a[2])},
    {key:'B',label:b[0],imageUrl:b[1],weights:W(b[2])},
    {key:'C',label:c[0],imageUrl:c[1],weights:W(c[2])},
    {key:'D',label:d[0],imageUrl:d[1],weights:W(d[2])}
  ]}}
  function IMG(kw){return 'https://images.unsplash.com/photo-150'+Math.floor(Math.random()*899+100)+'?auto=format&fit=crop&w=900&q=60&'+encodeURIComponent(kw)}
  return [
    S('q1','새로운 미술 도구를 발견했어요! 무엇을 먼저 해볼까요?',['설명서를 꼼꼼히 읽어본다',IMG('paper'),{디테일:1,꾸준성:0.6}],['종이에 탐색·실험한다',IMG('sketch'),{도전성:1}],['친구들과 아이디어 나눈다',IMG('kids'),{소통력:1,서사력:0.6}],['가장 특이한 결과 상상',IMG('idea'),{도전성:1,서사력:0.5}]),
    S('q2','그림에 어떤 이야기를 담고 싶나요?',['모험 이야기',IMG('adventure'),{서사력:1}],['감정을 색과 형태로',IMG('abstract'),{색감각:0.8,서사력:0.6}],['현실 건물 새로 디자인',IMG('architecture'),{공간감:1,디테일:0.4}],['작은 생명체의 숨은 세계',IMG('mini world'),{관찰력:0.8,서사력:0.6}]),
    S('q3','두 그림 중 색이 더 조화로운 것은?',['조화로운 팔레트',IMG('palette'),{색감각:1}],['대비 강한 팔레트',IMG('contrast'),{도전성:0.6}],['파스텔 편안함',IMG('pastel'),{색감각:0.8}],['강한 보색',IMG('vivid'),{도전성:0.6}]),
    S('q4','그리다 실수를 했어요. 어떻게 할까요?',['지우고 다시 그린다',IMG('erase'),{디테일:0.8,꾸준성:0.8}],['실수를 작품 일부로 바꾼다',IMG('mix'),{도전성:0.6}],['쉬고 재도전·완성',IMG('focus'),{꾸준성:1}],['도움을 요청',IMG('help'),{소통력:0.8}]),
    S('q5','미술관에서 무엇을 오래 보나요?',['빛/그림자 분위기',IMG('light'),{공간감:0.6,색감각:0.6}],['숨겨진 작은 요소',IMG('detail'),{관찰력:0.8,디테일:0.8}],['작가의 마음 상상',IMG('emotion'),{서사력:0.7,소통력:0.4}],['재료/기법이 궁금',IMG('material'),{도전성:0.6,관찰력:0.6}]),
    S('q6','미래의 도시를 그린다면, 어떻게 시작할까요?',['사진 조사·계획',IMG('city plan'),{디테일:0.7,공간감:0.8}],['아무도 본 적 없는 건물',IMG('scifi'),{도전성:1}],['아이디어 모으기',IMG('team'),{소통력:0.8}],['재료 실험',IMG('paint'),{도전성:0.8,색감각:0.5}]),
    S('q7','친구가 슬퍼 보여요. 어떤 그림을 그려줄까요?',['귀여운 동물',IMG('cute'),{서사력:0.5}],['추상적 감정',IMG('blue'),{색감각:0.6}],['즐거운 추억',IMG('memory'),{서사력:0.8,소통력:0.5}],['밝고 희망찬 그림',IMG('bright'),{색감각:0.7}]),
    S('q8','편안한 색 조합은?',['따뜻한 계열',IMG('warm'),{색감각:0.8}],['차가운 계열',IMG('cool'),{색감각:0.8}],['보색 대비',IMG('complementary'),{도전성:0.6}],['파스텔',IMG('pastel soft'),{색감각:0.8}]),
    S('q9','잘 안될 때 몇 번 시도할까요?',['바꾼다',IMG('switch'),{도전성:0.4}],['몇 번 후 포기',IMG('try'),{꾸준성:0.5}],['될 때까지 + 도움요청',IMG('keep'),{꾸준성:1,소통력:0.5}],['원인 분석·새 방법',IMG('analyze'),{도전성:0.6}]),
    S('q10','이 그림에서 가장 눈에 띄는 것은?',['전체 구도',IMG('layout'),{공간감:0.9}],['작은 패턴/질감',IMG('texture'),{디테일:0.9}],['인물 표정/감정',IMG('face'),{서사력:0.7}],['독특한 재료/기법',IMG('tech'),{도전성:0.7}]),
    S('q11','내 그림의 제목은?',['보이는 대로',IMG('see'),{관찰력:0.6}],['상상을 부르는 제목',IMG('title'),{서사력:0.9,소통력:0.5}],['기분 좋아지는 제목',IMG('happy'),{서사력:0.3}],['색/형태 강조',IMG('shape'),{색감각:0.7,디테일:0.5}]),
    S('q12','세상에 없는 동물, 어떤 동물?',['섞어서 만든 동물',IMG('hybrid'),{관찰력:0.6,디테일:0.6}],['완전히 새로운 형태',IMG('new'),{도전성:0.9}],['감정 표현·대화',IMG('talk'),{서사력:0.7,소통력:0.6}],['특별한 재료로 꾸미기',IMG('craft'),{색감각:0.6,디테일:0.6}]),
    S('q13','그림을 보여줄 때 듣고 싶은 말은?',['칭찬',IMG('praise'),{}],['구체적 조언',IMG('advice'),{}],['이야기가 떠올라',IMG('story'),{}],['재료가 궁금',IMG('curious'),{}]),
    S('q14','두 풍경 중 더 안정적인 구도는?',['균형 잡힌 구도',IMG('balance'),{공간감:0.9}],['치우친 구도',IMG('tilt'),{도전성:0.4}],['','',{}],['','',{}]),
    S('q15','답답할 때 어떤 생각을 하나요?',['재능이 없나…',IMG('sad'),{꾸준성:0.2}],['조금만 더! 자신감',IMG('cheer'),{꾸준성:0.9}],['다른 방법 떠올리기',IMG('newway'),{도전성:0.6}],['완성 상상으로 동기',IMG('finish'),{서사력:0.5,꾸준성:0.7}])
  ].map(function(q){q.options=q.options.filter(function(o){return (o.label||o.imageUrl)});if(q.options.length<2)q.options=q.options.slice(0,2);return q});
}
</script>
</body>
</html>
