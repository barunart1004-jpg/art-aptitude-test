<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ë°”ë¥¸ë¯¸ìˆ í•™ì› Â· ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸ V2. ADVANCE</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

<style>
/* ================== THEME: ADVANCE (Dark Neon) ================== */
:root{
  --ink:#e5e7eb; --muted:#9ca3af; --bg:#0b0f16;
  --panel:#0e1420; --glass:rgba(18,24,36,.6);
  --line:rgba(255,255,255,.08);
  --pri:#7dd3fc;  /* ë„¤ì˜¨ í•˜ëŠ˜ */
  --sec:#c084fc;  /* ë„¤ì˜¨ ë³´ë¼ */
  --tri:#fca5a5;  /* ë„¤ì˜¨ ì½”ë„ */
  --accent:#34d399; /* ë¯¼íŠ¸ */
  --shadow:0 20px 60px rgba(0,0,0,.45);
  --soft:0 12px 40px rgba(0,0,0,.35);
  --radius:22px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--ink);
  font-family:"Pretendard",ui-sans-serif,system-ui,"Noto Sans KR",Segoe UI,Roboto,Arial;
  background:
    radial-gradient(60vw 60vh at 10% -10%, rgba(124,58,237,.25), transparent 60%),
    radial-gradient(60vw 60vh at 90% -20%, rgba(14,165,233,.22), transparent 60%),
    radial-gradient(40vw 50vh at 50% 100%, rgba(20,184,166,.16), transparent 60%),
    var(--bg);
}
.container{min-height:100dvh;display:flex;flex-direction:column;align-items:center}
.main{width:100%;max-width:1180px;padding:18px;display:flex;flex-direction:column;gap:16px;margin:0 auto}
.header{width:100%;display:flex;justify-content:center}
.brand{
  width:100%;max-width:1180px;margin-top:10px;
  display:flex;align-items:center;gap:12px;
  padding:12px 16px;border-radius:999px;
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid var(--line);box-shadow:var(--soft);backdrop-filter:blur(8px)
}
.logo{width:28px;height:28px;border-radius:50%;
  background:conic-gradient(from 0deg,#f0abfc,#7dd3fc,#34d399,#fda4af,#f0abfc);
  animation:spin 9s linear infinite paused}
.brand:hover .logo{animation-play-state:running}
@keyframes spin{to{transform:rotate(360deg)}}
.brand span{font-weight:900;letter-spacing:.2px;display:flex;align-items:center;gap:8px}
.badge{font-size:11px;font-weight:900;padding:4px 8px;border-radius:999px;
  background:linear-gradient(90deg,#7dd3fc22,#c084fc22);color:#cbd5e1;border:1px solid var(--line)}

/* sticky nav + progress */
.sticky{position:sticky;top:0;z-index:10;background:rgba(13,18,30,.7);
  border:1px solid var(--line);border-radius:16px;box-shadow:var(--soft);padding:8px 10px;backdrop-filter:blur(10px);
  display:flex;flex-direction:column;gap:10px}
.navbar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
.step{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;cursor:pointer;
  background:rgba(255,255,255,.04);color:#e5e7eb;font-weight:850;border:1px solid var(--line);box-shadow:0 8px 20px rgba(0,0,0,.2);transition:transform .12s}
.step:hover{transform:translateY(-1px)}
.step .num{width:20px;height:20px;border-radius:50%;display:inline-grid;place-items:center;background:rgba(255,255,255,.06);border:1px solid var(--line);font-size:12px}
.step.active{background:linear-gradient(90deg,#0ea5e9,#8b5cf6);color:#fff;box-shadow:0 16px 40px rgba(14,165,233,.35)}
.step.done{background:rgba(34,197,94,.15);border-color:rgba(34,197,94,.35)}

.topprogress{--steps:20;position:relative;height:32px;background:rgba(255,255,255,.05);border-radius:999px;overflow:hidden;border:1px solid var(--line)}
.topprogress .bar{position:absolute;inset:0 auto 0 0;width:0;background:linear-gradient(90deg,#60a5fa,#22d3ee,#fb7185);border-radius:999px;z-index:1;transition:width .35s ease}
.topprogress::before{
  content:"";position:absolute;inset:0;z-index:2;pointer-events:none;
  background-image:linear-gradient(to right, rgba(255,255,255,.08) 0, rgba(255,255,255,.08) 1px, transparent 1px, transparent calc(100%/var(--steps)));
  background-size:calc(100%/var(--steps)) 100%;
}
.topprogress .toplabel{position:absolute;inset:0;display:grid;place-items:center;z-index:3;font-weight:900;font-size:14px;color:#e2e8f0;text-shadow:0 1px 0 rgba(0,0,0,.45)}
.statusline{font-size:12px;color:var(--muted);text-align:center}

/* cards */
.card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
  border:1px solid var(--line);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);animation:fade .35s ease both;backdrop-filter:blur(8px)}
@keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
h1{font-size:34px;margin:0 0 6px}h2{font-size:24px;margin:0 0 10px}h3{font-size:18px;margin:16px 0 8px}
p{margin:8px 0}.small{font-size:13px}.muted{color:var(--muted)}.center{text-align:center}

/* hero */
.hero{position:relative;padding:44px 22px;border-radius:22px;border:1px solid var(--line);
  background:linear-gradient(180deg,rgba(2,8,23,.5),rgba(2,6,23,.35));box-shadow:var(--soft)}
.hero .title{font-size:42px;font-weight:900;letter-spacing:.2px;margin:2px 0 6px;color:#e5e7eb}
.hero .sub{color:#9ca3af;margin-bottom:18px}
.hero .ctaRow{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

/* buttons */
.btn{--g:linear-gradient(90deg,#22d3ee,#8b5cf6);background:var(--g);color:#0b0f16;border:none;padding:18px 28px;border-radius:18px;
  font-weight:900;cursor:pointer;box-shadow:0 16px 40px rgba(139,92,246,.35);transition:transform .08s,filter .2s;font-size:20px}
.btn:hover{transform:translateY(-1px);filter:brightness(1.05)}
.btn-ghost{background:rgba(255,255,255,.08);color:#e5e7eb;border:1px solid var(--line);padding:12px 14px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:var(--soft)}
.btn-mint{--g:linear-gradient(90deg,#22d3ee,#34d399)}.btn-accent{--g:linear-gradient(90deg,#8b5cf6,#fb7185)}.btn-xl{padding:22px 34px;font-size:22px;border-radius:22px}

/* inputs */
input,select,textarea{width:100%;background:rgba(255,255,255,.06);color:#e5e7eb;border:1px solid var(--line);border-radius:12px;padding:12px;outline:none}
input::placeholder{color:#94a3b8}
input:focus,select:focus,textarea:focus{border-color:#60a5fa;box-shadow:0 0 0 6px rgba(14,165,233,.15)}
label{font-size:14px;color:#cbd5e1}
.section{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:14px;padding:16px}

.grid{display:grid;gap:14px}.grid-2{grid-template-columns:1fr 1fr}
@media (max-width:860px){.grid-2{grid-template-columns:1fr}}

/* options */
.opt{border:2px solid var(--line);border-radius:20px;overflow:hidden;cursor:pointer;background:rgba(255,255,255,.04);box-shadow:var(--soft);transition:transform .12s,border-color .2s}
.opt:hover{transform:translateY(-2px)}
.opt img{width:100%;display:block;aspect-ratio:4/3;object-fit:cover}
.opt .cap{padding:12px 14px;color:#e5e7eb;font-weight:800;font-size:16px;line-height:1.35}
@media (min-width:1024px){
  .test-grid-4{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
  .test-grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
  .sideNav{position:fixed;top:50%;transform:translateY(-50%);z-index:20}
  .sideNav.left{left:18px}.sideNav.right{right:18px}
  .sideBtn{background:rgba(255,255,255,.06);border:1px solid var(--line);width:46px;height:46px;border-radius:50%;display:grid;place-items:center;box-shadow:0 12px 26px rgba(0,0,0,.4);cursor:pointer;font-weight:900;color:#e5e7eb}
  .sideBtn:hover{transform:translateY(-1px)}
}
@media (max-width:1023px){.sideNav{display:none}}
.opt.sel{border-color:#60a5fa;box-shadow:0 0 0 6px rgba(14,165,233,.2)}

/* accordions */
.acc{border-radius:14px;overflow:hidden;border:1px solid var(--line);background:rgba(255,255,255,.03)}.acc-item{border-top:1px solid var(--line)}
.acc-head{padding:14px 16px;background:rgba(255,255,255,.06);cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.acc-head span{font-weight:900;font-size:17px}.acc-body{padding:14px 16px;display:none}
.acc-item.open .acc-body{display:block}
.agreeList{display:grid;gap:10px;margin-top:10px}
.agree-row{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:rgba(255,255,255,.04)}
.agree-row .txt{font-size:15px;color:#e2e8f0;line-height:1.55;font-weight:700}
.agree-row input[type="checkbox"]{width:20px;height:20px;accent-color:#60a5fa}

/* report */
.block{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:var(--soft);page-break-inside:avoid;break-inside:avoid}
.block h3{margin:0 0 10px}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{background:linear-gradient(90deg,#22d3ee33,#8b5cf633);color:#e2e8f0;border:1px solid var(--line);padding:8px 12px;border-radius:999px;font-weight:900}
.callout{position:relative;background:linear-gradient(135deg,rgba(2,132,199,.18),rgba(124,58,237,.16));padding:22px;border-radius:18px;border:1px solid var(--line);box-shadow:0 12px 34px rgba(2,132,199,.25)}
.callout:before{content:"";position:absolute;inset:-1px;border-radius:18px;padding:1px;background:linear-gradient(90deg,#22d3ee,#8b5cf6,#f472b6);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude}

/* 3-chart layout */
.report-grid{display:grid;grid-template-columns:3fr 2fr;gap:16px}
.right-stack{display:grid;grid-template-rows:1fr 1fr;gap:16px}
.chartBox{width:100%;height:100%}
.chartBox canvas{width:100% !important;height:100% !important}

/* detail (multi pages) */
.detail-hero{display:flex;align-items:center;gap:8px;justify-content:center;margin-bottom:8px}
.detail-hero .ic{width:48px;height:48px;border-radius:999px;background:rgba(124,58,237,.18);border:1px solid var(--line);display:grid;place-items:center;font-weight:900;color:#a78bfa}
.detail-title{font-size:28px;font-weight:900}
.detail-sub{color:#9ca3af;text-align:center;margin:-4px 0 10px}
.section-title{font-weight:900;margin:8px 0 10px}
.tgrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.tcard{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:14px;padding:14px}
.tchip{background:rgba(124,58,237,.24);color:#e9d5ff;border:1px solid var(--line);padding:6px 10px;border-radius:999px;font-weight:800;font-size:12px}

/* print/pdf */
@media print{.header,.sticky,.btn,.btn-ghost,.sideNav,.no-pdf{display:none !important}.card{box-shadow:none;border:1px solid #222}.block{break-inside:avoid-page}}
.pdf-screen-width{width:794px;max-width:none;margin:0 auto}

/* modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:999}
.modal-backdrop.show{display:flex}
.modal{width:min(560px,92vw);background:rgba(17,24,39,.92);border:1px solid var(--line);border-radius:16px;box-shadow:0 18px 60px rgba(0,0,0,.6);padding:18px;color:#e5e7eb}
.modal h3{margin:0 0 10px}.modal .row{display:grid;gap:8px;margin:10px 0}.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <div class="logo"></div>
      <span>ë°”ë¥¸ë¯¸ìˆ í•™ì› Â· ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸ <span class="badge">V2. ADVANCE</span></span>
    </div>
  </div>

  <main class="main" aria-live="polite">
    <div class="sticky">
      <nav class="navbar" id="topnav"></nav>
      <div class="topprogress" id="topprogress">
        <div id="topbar" class="bar"></div>
        <div id="toplabel" class="toplabel"></div>
      </div>
      <div class="statusline" id="statusline">ì§„í–‰ë¥  0%</div>
    </div>
    <section class="card" id="app"></section>
  </main>
</div>

<div class="sideNav left" id="sideLeft" style="display:none"><button class="sideBtn" onclick="prev()" aria-label="ì´ì „">â€¹</button></div>
<div class="sideNav right" id="sideRight" style="display:none"><button class="sideBtn" onclick="next()" aria-label="ë‹¤ìŒ">â€º</button></div>

<!-- email modal -->
<div class="modal-backdrop" id="emailModal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="modal">
    <h3>ì´ë©”ì¼ë¡œ ê²°ê³¼ ë³´ë‚´ê¸°</h3>
    <div class="row">
      <label>ë°›ëŠ” ì‚¬ëŒ ì´ë©”ì¼</label>
      <input type="email" id="emailTo" placeholder="example@email.com">
    </div>
    <div class="row">
      <label>ì œëª©</label>
      <input type="text" id="emailSubject" value="">
    </div>
    <div class="actions">
      <button class="btn-ghost" id="emailCancel">ì·¨ì†Œ</button>
      <button class="btn btn-accent" id="emailSend">ë³´ë‚´ê¸°</button>
    </div>
    <div class="small muted" id="emailMsg" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* ================== CONSTANTS ================== */
var APP_TITLE='ë°”ë¥¸ë¯¸ìˆ í•™ì› Â· ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸ V2. ADVANCE';

/* êµ¬ê¸€ì‹œíŠ¸: question2 ì‹œíŠ¸ ìš°ì„ , ì‹¤íŒ¨ ì‹œ í´ë°± */
var SHEET_ID='14VLQBhDJtduxjCnfr7VEOstZ5ez8-CX3ArXy1OvYCQg';
var GVIZ_SHEETS=['question2','Question2','Questions2','ADVANCE','Advance','Questions'];
function gvizUrl(sheet){return 'https://docs.google.com/spreadsheets/d/'+SHEET_ID+'/gviz/tq?sheet='+encodeURIComponent(sheet)+'&tqx=out:json'}

var FORM_ACTION='https://docs.google.com/forms/d/e/1FAIpQLSeRWq5YKN50zL0simiaQA6EBRsn6VXN__ZmLplAgDz1I1hyQA/formResponse';
var EMAIL_FUNCTION_URL='/.netlify/functions/send-email';

/* Google Form mapping (ê°™ì€ í¼ ì‚¬ìš©) */
var F={child_name:'entry.684468179',age:'entry.1066070471',grade:'entry.1812672802',guardian:'entry.1666083184',phone:'entry.89824848',campus:'entry.490719219',answers:'entry.85364862',scores:'entry.1455508168',top3:'entry.2120338430',resultId:'entry.532514127',timestamp:'entry.1261684833'};

/* ADVANCE ì°¨ì› */
var DIM=['SPA','DET','COL','NAR','CHK','CON','OBS','EXP','GRT','SOC','CRT'];
var DIM_KR={
  SPA:'ê³µê°„Â·êµ¬ë„', DET:'ë””í…Œì¼', COL:'ìƒ‰ì±„', NAR:'ì„œì‚¬', CHK:'ë„ì „',
  CON:'ê°œë…í™”', OBS:'ê´€ì°°', EXP:'í‘œí˜„ì„±', GRT:'ê¾¸ì¤€ì„±', SOC:'ì†Œí†µ', CRT:'ë¹„íŒì ì‚¬ê³ '
};
var STEPS=[{key:'start',label:'ì‹œì‘'},{key:'consent',label:'ë™ì˜'},{key:'profile',label:'í”„ë¡œí•„'},{key:'test',label:'í…ŒìŠ¤íŠ¸'},{key:'result',label:'ê²°ê³¼'},{key:'details',label:'ë¦¬í¬íŠ¸'}];
var STATE={step:'start',consent:false,profile:{},questions:[],idx:0,answers:[],result:null};

function $(id){return document.getElementById(id)}
function app(){return $('app')}

/* ================== NAV & PROGRESS ================== */
function renderNav(){
  var cur=STEPS.findIndex(function(s){return s.key===STATE.step});
  $('topnav').innerHTML=STEPS.map(function(s,i){
    return '<div class="step '+(s.key===STATE.step?'active':'')+' '+(cur>i?'done':'')+'" onclick="navGo(\''+s.key+'\')"><span class="num">'+(i+1)+'</span><span>'+s.label+'</span></div>';
  }).join('');
}
function updateTopProgress(){
  var topbar=$('topbar'), toplabel=$('toplabel'), tp=$('topprogress'), status=$('statusline');
  if(STATE.step==='test' && STATE.questions.length){
    status.style.display='none';
    var total=STATE.questions.length;
    var curIndex=STATE.idx+1;
    var pct=Math.max(0, Math.min(100, Math.round((STATE.idx)/total*100)));
    topbar.style.width=pct+'%';
    toplabel.textContent='('+curIndex+'/'+total+')';
    tp.style.setProperty('--steps', String(total));
    $('sideLeft').style.display='block';
    $('sideRight').style.display='block';
    return;
  }
  $('sideLeft').style.display='none'; $('sideRight').style.display='none';
  toplabel.textContent=''; status.style.display='block';
  var p=(STEPS.findIndex(function(s){return s.key===STATE.step}))/(STEPS.length-1)*100;
  topbar.style.width=Math.round(p)+'%';
  status.textContent='ì§„í–‰ë¥  '+Math.round(p)+'%';
}
function navGo(step){STATE.step=step;if(step==='test' && STATE.questions.length===0){startTest();return;}render()}

/* ================== LOAD QUESTIONS ================== */
function parseGViz(text){
  var s=text.indexOf('{'), e=text.lastIndexOf('}');
  if(s<0 || e<0) return [];
  var obj=JSON.parse(text.slice(s,e+1));
  var cols=obj.table.cols.map(function(c){return c.label});
  return obj.table.rows.map(function(r){return r.c.map(function(c){return c?(c.f!=null?c.f:c.v):''})})
           .map(function(a){return Object.fromEntries(cols.map(function(k,i){return [k,a[i]]}))});
}
async function tryLoadFromSheets(){
  for(var i=0;i<GVIZ_SHEETS.length;i++){
    try{
      var res=await fetch(gvizUrl(GVIZ_SHEETS[i]));
      var txt=await res.text();
      var rows=parseGViz(txt)||[];
      var act=rows.filter(function(r){return String(r.active).toUpperCase()==='TRUE'})
                  .sort(function(a,b){return (+a.order)-(+b.order)});
      if(act.length){
        STATE.questions=act.map(function(r){
          function mkWeights(k){try{return JSON.parse(r[k+'_weights'])||{}}catch(_){return {}}}
          function mkOpt(k){
            return {key:k,label:(r[k+'_label']||'').trim(),imageUrl:(r[k+'_image']||'').trim(),weights:mkWeights(k)};
          }
          var opts=['A','B','C','D'].map(mkOpt).filter(function(o){
            var hasLabel=o.label.length>0, hasImage=o.imageUrl.length>0,
                hasWeight=Object.values(o.weights||{}).some(function(v){return Number(v||0)!==0});
            return hasLabel||hasImage||hasWeight;
          });
          if(opts.length<2) opts=['A','B'].map(mkOpt);
          return {id:r.id||('q'+r.order),order:+r.order,prompt:r.prompt||'',options:opts};
        });
        return true;
      }
    }catch(e){}
  }
  return false;
}
async function loadQuestions(){
  var ok=await tryLoadFromSheets();
  if(!ok){STATE.questions=localQuestions2()}
}

/* ================== START / CONSENT ================== */
function startScreen(){
  return '<div class="hero">'
    +'<div class="title center">'+APP_TITLE+'</div>'
    +'<div class="sub center">ì¤‘Â·ê³ ì… ëŒ€ë¹„ ì‹¬ì¸µ í…ŒìŠ¤íŠ¸(ë§Œ 12â€“15ì„¸). 20ë¬¸í•­ìœ¼ë¡œ <b>ì˜ˆìˆ ê°€ ì ì¬ë ¥</b>ì„ ë‹¤ì°¨ì› ë¶„ì„í•©ë‹ˆë‹¤.</div>'
    +'<div class="ctaRow"><button class="btn btn-xl" id="startBtn">ADVANCE ì‹œì‘í•˜ê¸° â†’</button>'
    +'<a class="btn-ghost" href="index.html">BASIC í…ŒìŠ¤íŠ¸</a></div></div>';
}
function viewStart(){app().innerHTML=startScreen();$('startBtn').onclick=function(){navGo('consent')};window.scrollTo({top:0,behavior:'smooth'})}

function accItem(t,html){return '<div class="acc-item open"><div class="acc-head"><span>'+t+'</span><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div class="acc-body small">'+html+'</div></div>'}
function viewConsent(){
  app().innerHTML='<h2 class="center">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ</h2>'
  +'<p class="muted small center">ë³¸ í…ŒìŠ¤íŠ¸ëŠ” <b>êµìœ¡ ê°€ì´ë“œ</b> ëª©ì ì´ë©°, ì˜í•™/ì„ìƒ ì§„ë‹¨ì´ ì•„ë‹™ë‹ˆë‹¤.</p>'
  +'<div class="acc">'
    +accItem('<b>1) ëª©ì </b>','â‘  í…ŒìŠ¤íŠ¸ ì œê³µ ë° ê²°ê³¼ ì‚°ì¶œ â‘¡ ì‹¬ì¸µ ë¦¬í¬íŠ¸ ì œê³µ(PDF/ì´ë©”ì¼) â‘¢ ìƒë‹´ í’ˆì§ˆ ê°œì„ ')
    +accItem('<b>2) ìˆ˜ì§‘ í•­ëª©</b>','ì´ë¦„Â·ë‚˜ì´Â·í•™ë…„ / ë³´í˜¸ì ì´ë¦„Â·ì—°ë½ì²˜ / ì‘ë‹µÂ·ê²°ê³¼ (ì´ë©”ì¼ì€ ì„ íƒ)')
    +accItem('<b>3) ë³´ê´€ ê¸°ê°„</b>','ìˆ˜ì§‘ì¼ë¡œë¶€í„° <b>12ê°œì›”</b> ë³´ê´€ í›„ íŒŒê¸°')
    +accItem('<b>4) ë³´ê´€/ì²˜ë¦¬</b>','Google Forms/Sheetsì— ì €ì¥Â·ì²˜ë¦¬')
    +accItem('<b>5) ê¶Œë¦¬</b>','ë™ì˜ ê±°ë¶€ ê°€ëŠ¥(ê±°ë¶€ ì‹œ ì„œë¹„ìŠ¤ ì œí•œ ê°€ëŠ¥)')
    +accItem('<b>6) ë¬¸ì˜</b>','barunart1004@gmail.com')
  +'</div>'
  +'<div class="section" style="margin-top:16px">'
    +'<div class="agreeList">'
      +'<div class="agree-row"><div class="txt">(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— <b>ë™ì˜í•©ë‹ˆë‹¤.</b></div><input type="checkbox" id="chk_required"></div>'
      +'<div class="agree-row"><div class="txt">(í•„ìˆ˜) ë§Œ 14ì„¸ ë¯¸ë§Œ ì•„ë™ì˜ ë²•ì •ëŒ€ë¦¬ì¸ìœ¼ë¡œì„œ <b>ë™ì˜í•©ë‹ˆë‹¤.</b></div><input type="checkbox" id="chk_minor"></div>'
    +'</div>'
  +'</div>'
  +'<div class="center" style="margin-top:16px;display:flex;gap:8px;justify-content:center">'
    +'<button class="btn" id="btn_consent" disabled>ë™ì˜í•˜ê³  ì§„í–‰</button>'
    +'<button class="btn-ghost" id="btn_expand">ì „ë¬¸ í¼ì¹˜ê¸°</button>'
    +'<button class="btn-ghost" id="btn_collapse">ëª¨ë‘ ì ‘ê¸°</button>'
  +'</div>';
  function validate(){ $('btn_consent').disabled= !( $('chk_required').checked && $('chk_minor').checked ); }
  $('chk_required').addEventListener('change',validate); $('chk_minor').addEventListener('change',validate);
  $('btn_consent').onclick=function(){STATE.consent=true;navGo('profile')};
  $('btn_expand').onclick=function(){document.querySelectorAll('.acc-item').forEach(function(it){it.classList.add('open')})};
  $('btn_collapse').onclick=function(){document.querySelectorAll('.acc-item').forEach(function(it){it.classList.remove('open')})};
  document.querySelectorAll('.acc-head').forEach(function(h){h.addEventListener('click',function(){h.parentElement.classList.toggle('open')})});
}

/* ================== PROFILE (12â€“15) ================== */
var AGE_TO_GRADE={12:'ì´ˆ6',13:'ì¤‘1',14:'ì¤‘2',15:'ì¤‘3'};
var GRADE_TO_AGE={'ì´ˆ6':'12','ì¤‘1':'13','ì¤‘2':'14','ì¤‘3':'15'};
var CAMPUSES=['ì••êµ¬ì •[ë³¸ì›]','ë°˜í¬','í•œë‚¨','ë°©ë°°','ëª©ë™','ì†¡íŒŒ','ì„œëŒ€ë¬¸','ì¼ì‚°','íƒ„í˜„','ê¹€í¬','ì†¡ë„','ë¶€ì‚°'];

function viewProfile(){
  app().innerHTML='<h2 class="center">í”„ë¡œí•„ ì •ë³´</h2>'
  +'<div class="grid grid-2" style="margin-top:8px">'
  +'<div class="section"><label>í•™ìƒ ì´ë¦„</label><input id="cname" placeholder="ì˜ˆ: í™ê¸¸ë™"></div>'
  +'<div class="section"><label>ë³´í˜¸ì ì´ë¦„</label><input id="gname" placeholder="ì˜ˆ: ê¹€ë³´í˜¸ì"></div>'
  +'<div class="section"><label>ë‚˜ì´(ë§Œ)</label><select id="age">'+[12,13,14,15].map(function(a){return '<option value="'+a+'">'+a+'</option>'}).join('')+'</select></div>'
  +'<div class="section"><label>í•™ë…„</label><select id="grade">'+Object.values(AGE_TO_GRADE).map(function(g){return '<option>'+g+'</option>'}).join('')+'</select></div>'
  +'<div class="section"><label>ì—°ë½ì²˜</label><input id="phone" placeholder="010-0000-0000"></div>'
  +'<div class="section"><label>ì´ë©”ì¼(ì„ íƒ, ê²°ê³¼ì§€ ì „ì†¡ìš©)</label><input id="email" placeholder="example@email.com"></div>'
  +'<div class="section"><label>ìº í¼ìŠ¤</label><select id="campus">'+CAMPUSES.map(function(c){return '<option value="'+c+'">'+c+'</option>'}).join('')+'</select></div>'
  +'</div>'
  +'<div class="center" style="margin-top:16px"><button class="btn btn-mint" id="btn_starttest">í…ŒìŠ¤íŠ¸ ì‹œì‘</button></div>';
  $('age').addEventListener('change',function(e){$('grade').value=AGE_TO_GRADE[e.target.value]});
  $('grade').addEventListener('change',function(e){$('age').value=GRADE_TO_AGE[e.target.value]});
  $('btn_starttest').onclick=startTest;
}
async function startTest(){
  STATE.profile={
    child_name:$('cname').value.trim(),
    guardian:$('gname').value.trim(),
    age:$('age').value,
    grade:$('grade').value,
    phone:$('phone').value.trim(),
    email:$('email').value.trim(),
    campus:$('campus').value
  };
  if(!STATE.profile.child_name){alert('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”');return;}
  if(!/^0\d{1,2}-?\d{3,4}-?\d{4}$/.test(STATE.profile.phone||'')){alert('ì—°ë½ì²˜ í˜•ì‹(010-0000-0000)ì„ í™•ì¸í•´ ì£¼ì„¸ìš”');return;}
  await loadQuestions(); STATE.idx=0; STATE.answers=[]; STATE.step='test'; render();
}

/* ================== TEST ================== */
function pcGridClassFor(n){if(window.matchMedia('(min-width:1024px)').matches){return n===2?'test-grid-2':'test-grid-4'}return'grid grid-2'}
function optionImageUrl(q,o){if(o.imageUrl){return o.imageUrl}var num=Number(q.order)||(STATE.idx+1);return 'https://picsum.photos/seed/adv'+num+o.key+'/900/600'}
function viewTest(){
  var q=STATE.questions[STATE.idx]; if(!q){app().innerHTML='<h3 class="center">ë¬¸í•­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì— ë¬¸ì˜í•´ ì£¼ì„¸ìš”.</h3>';return;}
  var gridCls=pcGridClassFor(q.options.length);
  app().innerHTML='<div class="center small muted"><span class="chip">Q '+(STATE.idx+1)+' / '+STATE.questions.length+'</span></div>'
  +'<h2 class="center" style="margin-top:10px">'+(q.prompt||'')+'</h2>'
  +'<div class="'+gridCls+'" style="margin-top:12px">'
  + q.options.map(function(o){
      return '<div class="opt" id="opt_'+o.key+'" tabindex="0" role="button" aria-label="'+(o.label||o.key)+'" data-key="'+o.key+'">'
        +'<img src="'+optionImageUrl(q,o)+'" alt="'+(o.label||o.key)+'" onerror="this.style.opacity=.2" loading="lazy">'
        +'<div class="cap center">'+(o.label||o.key)+'</div></div>';
    }).join('')
  +'</div>'
  +'<div class="center" style="margin-top:18px;display:flex;gap:10px;justify-content:center">'
    +'<button class="btn-ghost" id="btn_prev" '+(STATE.idx===0?'disabled':'')+'>ì´ì „</button>'
    +'<button class="btn" id="btn_next" disabled>ë‹¤ìŒ</button>'
  +'</div>';
  q.options.forEach(function(o){
    var el=document.getElementById('opt_'+o.key);
    el.onclick=function(){choose(o.key)};
    el.onkeydown=function(e){if(e.key==='Enter'||e.key===' ')choose(o.key)};
  });
  $('btn_prev').onclick=prev; $('btn_next').onclick=next;
}
function choose(key){
  var q=STATE.questions[STATE.idx];
  q.options.forEach(function(k){var n=document.getElementById('opt_'+k.key); if(n){n.classList.remove('sel')}})
  var node=document.getElementById('opt_'+key); if(node){node.classList.add('sel'); node.animate([{transform:'scale(1)'},{transform:'scale(.98)'},{transform:'scale(1)'}],{duration:160})}
  var opt=q.options.find(function(o){return o.key===key});
  STATE.answers[STATE.idx]={qid:q.id,key:key,weights:opt.weights||{}};
  $('btn_next').disabled=false;
}
function next(){if(STATE.step!=='test')return;if(!STATE.answers[STATE.idx]){alert('í•˜ë‚˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”');return;}if(STATE.idx<STATE.questions.length-1){STATE.idx++;render();}else{submitAllSafe();}}
function prev(){if(STATE.idx>0){STATE.idx--;render();}}
document.addEventListener('keydown',function(e){if(STATE.step!=='test')return;if(e.key==='ArrowRight')next();if(e.key==='ArrowLeft')prev();if(e.key==='Enter'){if(!$('btn_next').disabled)next();}});

/* ================== SCORING ================== */
function aggregateScores(ans){
  var sum={}; DIM.forEach(function(d){sum[d]=0});
  ans.forEach(function(a){
    Object.keys(a.weights||{}).forEach(function(k){sum[k]=(sum[k]||0)+Number(a.weights[k]||0)});
  });
  var n=ans.length||1;
  var raw={}; DIM.forEach(function(d){var v=(sum[d]||0)/n*4; raw[d]=Math.max(0,Math.round(v*10)/10)});
  return raw;
}
function adjust(v){return Math.round((2+v/2)*10)/10}
function band(v){if(v>=3.6)return'S';if(v>=3.2)return'A';if(v>=2.8)return'A-';if(v>=2.4)return'B+';if(v>=2.0)return'B';if(v>=1.6)return'B-';if(v>=1.0)return'C+';return'C'}

var PRAISE={
  'S':function(k){return 'ì™€, '+k+'ì—ì„œ <b>íƒ€ê³ ë‚œ ì¬ëŠ¥</b>ì´ ë‹ë³´ì…ë‹ˆë‹¤. ë‚œë„ ë†’ì€ ê³¼ì œë¥¼ ìŠ¤ìŠ¤ë¡œ ê¸°íší•´ë³´ì„¸ìš”.'},
  'A':function(k){return k+'ê°€ <b>ë›°ì–´ë‚©ë‹ˆë‹¤</b>. í•œ ë‹¨ê³„ ë†’ì€ ê³¼ì œë„ ë¬´ë¦¬ ì—†ì´ ì†Œí™”í•©ë‹ˆë‹¤.'},
  'A-':function(k){return k+'ê°€ <b>íƒ„íƒ„</b>í•©ë‹ˆë‹¤. ì•½ê°„ì˜ ë‹¤ë“¬ê¸°ë¡œ ìƒìœ„ê¶Œì„ ë…¸ë ¤ìš”.'},
  'B+':function(k){return k+'ì´ ì•ˆì •ì ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì‹œë„ì—ë„ ì˜ ì ì‘í•©ë‹ˆë‹¤.'},
  'B':function(k){return k+'ì˜ ê¸°ë³¸ê¸°ê°€ ì¢‹ìŠµë‹ˆë‹¤. ë£¨í‹´ í™•ì¥ìœ¼ë¡œ <b>ì„±ì¥ ê°€ì†</b>!' }
};

/* ================== SUBMIT & RESULT ================== */
function nowKST(){var d=new Date(),p=function(n){return String(n).padStart(2,'0')};return d.getFullYear()+'-'+p(d.getMonth()+1)+'-'+p(d.getDate())+' '+p(d.getHours())+':'+p(d.getMinutes())+' KST'}
async function submitAllSafe(){
  var raw=aggregateScores(STATE.answers);
  var scores=Object.fromEntries(Object.keys(raw).map(function(k){return [k,adjust(raw[k])]}));
  var ordered=Object.keys(scores).sort(function(a,b){return scores[b]-scores[a]});
  var top3=ordered.slice(0,3);
  var potential=ordered.slice(3,7);
  var resultId=(crypto && crypto.randomUUID)?crypto.randomUUID():('r'+Date.now());
  var form=new FormData();
  form.append(F.child_name,STATE.profile.child_name);form.append(F.age,STATE.profile.age);form.append(F.grade,STATE.profile.grade);
  form.append(F.guardian,STATE.profile.guardian);form.append(F.phone,STATE.profile.phone);form.append(F.campus,STATE.profile.campus||'');
  form.append(F.answers,JSON.stringify({profile:STATE.profile,questions:STATE.answers,top3:top3}));
  form.append(F.scores,JSON.stringify(scores));form.append(F.top3,top3.join(','));form.append(F.resultId,resultId);form.append(F.timestamp,nowKST());
  try{await fetch(FORM_ACTION,{method:'POST',mode:'no-cors',body:form});}catch(e){}
  STATE.result={scores:scores,top3:top3,potential:potential,resultId:resultId};STATE.step='result';render();
}

var CHARTS=[];
function destroyCharts(){CHARTS.forEach(function(c){try{c.destroy()}catch(_){}});CHARTS=[]}

/* RESULT (3 charts) */
function viewResult(){
  var r=STATE.result||{}; var s=r.scores||{}; var T=r.top3||[]; var ordered=Object.keys(s).sort(function(a,b){return s[b]-s[a]});
  var topRadar=ordered.slice(0,Math.min(8,ordered.length));
  var potential=r.potential||ordered.slice(3,7);

  var summary=[
    STATE.profile.child_name+'ë‹˜ì€ <b>'+ (DIM_KR[T[0]]||'-') +'</b>ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ <b>'+(DIM_KR[T[1]]||'-')+'</b>, <b>'+(DIM_KR[T[2]]||'-')+'</b>ì—ì„œ ê°•ì ì´ ëšœë ·í•©ë‹ˆë‹¤.',
    'ë„ì „ ê³¼ì œì—ì„œë„ í•™ìŠµ ì „ì´ê°€ ë¹ ë¥´ê³ , ì‹œê°Â·ê°œë… ë‘ ì˜ì—­ì˜ ê· í˜•ì´ ì¢‹ì•„ <b>ì°½ì‘ ê¸°íš</b>ì— ê°•ì ì´ ìˆìŠµë‹ˆë‹¤.',
    'ê°•ì ì„ ë£¨í‹´í™”í•˜ì—¬ ì‘ì€ ì™„ì„±ì„ ìì£¼ ë§Œë“¤ë©´ ë™ê¸°ê°€ ìœ ì§€ë˜ê³ , ì•½ì  ì˜ì—­ì€ <b>ì €ë‚œë„ ë°˜ë³µ</b>ìœ¼ë¡œ ë³´ì™„í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.'
  ].join(' ');

  app().innerHTML='<div id="pdfArea" class="pdf-screen-width">'
    +'<div class="block callout" style="text-align:center">'
      +'<div class="chip" style="margin:0 auto 8px;display:inline-block">ADVANCE ê²°ê³¼ ìš”ì•½</div>'
      +'<h2 style="margin:0 0 10px"><b>'+STATE.profile.child_name+'</b>ë‹˜, ì§‘ì¤‘ë ¥ê³¼ ìƒìƒë ¥ì´ ë‹ë³´ì˜€ì–´ìš”!</h2>'
      +'<div class="chips" style="margin-top:10px;justify-content:center">'+T.map(function(t){return '<span class="chip">Top: '+(DIM_KR[t]||t)+'</span>'}).join('')+'</div>'
    +'</div>'

    +'<div class="block">'
      +'<h3 class="center">í•µì‹¬ ì§€í‘œ</h3>'
      +'<div class="report-grid" style="height:440px;margin-top:8px">'
        +'<div class="chartBox" style="border:1px solid var(--line);border-radius:14px;padding:10px">'
          +'<div class="small muted" style="font-weight:900;margin:0 0 6px">ì˜ì—­ë³„ í”„ë¡œíŒŒì¼(ë ˆì´ë”)</div>'
          +'<canvas id="radar"></canvas>'
        +'</div>'
        +'<div class="right-stack">'
          +'<div class="chartBox" style="border:1px solid var(--line);border-radius:14px;padding:10px">'
            +'<div class="small muted" style="font-weight:900;margin:0 0 6px">ë›°ì–´ë‚œ ì˜ì—­ (TOP3)</div>'
            +'<canvas id="barsTop3"></canvas>'
          +'</div>'
          +'<div class="chartBox" style="border:1px solid var(--line);border-radius:14px;padding:10px">'
            +'<div class="small muted" style="font-weight:900;margin:0 0 6px">ê°€ëŠ¥ì„± ì˜ì—­ (ì°¨ìˆœ 4ê°œ)</div>'
            +'<canvas id="barsPotential"></canvas>'
          +'</div>'
        +'</div>'
      +'</div>'
    +'</div>'

    +'<div class="block"><h3>ì´í‰</h3><p class="small" style="line-height:1.8">'+summary+'</p></div>'

    + makeInterpretationBlock(s)

  +'</div>'

  +'<div class="center no-pdf" style="margin-top:16px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">'
    +'<button class="btn-ghost" onclick="STATE.step=\'start\'; render()">ì²˜ìŒìœ¼ë¡œ</button>'
    +'<button class="btn btn-mint" id="btn_pdf">PDF ì €ì¥</button>'
    +'<button class="btn btn-accent" id="btn_email">ì´ë©”ì¼ë¡œ ë³´ë‚´ê¸°</button>'
    +'<button class="btn-ghost" onclick="STATE.step=\'details\'; render()">ì‹¬ì¸µ ë¦¬í¬íŠ¸ ë³´ê¸°</button>'
  +'</div>';

  destroyCharts();

  var rctx=$('radar').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(rctx,{type:'radar',
    data:{labels:topRadar.map(function(k){return DIM_KR[k]||k}),datasets:[{data:topRadar.map(function(k){return s[k]||0}),borderColor:'#7dd3fc',backgroundColor:'rgba(125,211,252,.22)',borderWidth:2,pointRadius:3,fill:true}]},
    options:{animation:{duration:800},scales:{r:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'rgba(255,255,255,.08)'},angleLines:{color:'rgba(255,255,255,.08)'}}},plugins:{legend:{display:false}}}
  }));

  var b1=$('barsTop3').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(b1,{type:'bar',
    data:{labels:T.map(function(k){return DIM_KR[k]||k}),datasets:[{data:T.map(function(k){return s[k]||0}),borderRadius:12,borderSkipped:false,backgroundColor:['#8b5cf6','#22d3ee','#fb7185']}]},
    options:{animation:{duration:700},scales:{y:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'rgba(255,255,255,.08)'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}
  }));

  var b2=$('barsPotential').getContext('2d',{willReadFrequently:true});
  CHARTS.push(new Chart(b2,{type:'bar',
    data:{labels:potential.map(function(k){return DIM_KR[k]||k}),datasets:[{data:potential.map(function(k){return s[k]||0}),borderRadius:12,borderSkipped:false,backgroundColor:['#22d3ee','#34d399','#8b5cf6','#fb7185']}]},
    options:{animation:{duration:700},scales:{y:{suggestedMin:0,suggestedMax:4,ticks:{display:false},grid:{color:'rgba(255,255,255,.08)'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}
  }));

  $('btn_pdf').onclick=handleSavePdf; $('btn_email').onclick=openEmailModal;
}

function makeInterpretationBlock(scores){
  return '<div class="block"><h3>í•­ëª©ë³„ í•´ì„</h3>'
    +'<div class="grid" style="grid-template-columns:1fr 1fr">'
    + DIM.map(function(k){
        var v=+(scores[k]||0);
        var w=Math.min(100,(v/4)*100);
        var b=band(v);
        var praise=(PRAISE[b]||function(){return 'ê¾¸ì¤€íˆ ì„±ì¥ ì¤‘ì…ë‹ˆë‹¤.'})(DIM_KR[k]||k);
        return '<div style="border:1px solid var(--line);border-radius:12px;padding:14px;background:rgba(255,255,255,.03);box-shadow:var(--soft)">'
          +'<div style="font-weight:900;margin-bottom:6px">'+(DIM_KR[k]||k)+'</div>'
          +'<div class="topprogress" style="height:10px;margin:8px 0 10px">'
            +'<div style="width:'+w+'%;height:100%;background:linear-gradient(90deg,#22d3ee,#8b5cf6)"></div>'
          +'</div>'
          +'<div class="small">'+praise+'</div>'
        +'</div>';
      }).join('')
    +'</div></div>';
}

/* ================== DETAIL REPORT (3~4 pages) ================== */
function viewDetails(){
  var r=STATE.result||{}; var s=r.scores||{}; var T=r.top3||[]; var P=r.potential||[];
  var name=STATE.profile.child_name;

  function item(label,desc){return '<div style="display:flex;gap:8px"><div style="color:#60a5fa">â€¢</div><div>'+desc+'</div></div>'}

  var strengths=T.map(function(k){return item('','<b>'+(DIM_KR[k]||k)+'</b> : í•´ë‹¹ ì˜ì—­ì—ì„œ ìƒìœ„ ìˆ˜ì¤€. '+(PRAISE['A'](DIM_KR[k]||k)).replace(/<[^>]+>/g,'') )}).join('');
  var roadmap='<div class="tgrid">'
    +'<div class="tcard"><div class="section-title">1) ë‹¨ê¸°(2ì£¼)</div>'+item('','Top ì˜ì—­ ê¸°ë°˜ 3íšŒ <b>ì‘ì€ ì™„ì„±</b> ë§Œë“¤ê¸° (30â€“40ë¶„)')+item('','í”¼ë“œë°± 1ê°œ ë°˜ì˜í•˜ì—¬ ë¦¬í„°ì¹˜')+'</div>'
    +'<div class="tcard"><div class="section-title">2) ì¤‘ê¸°(8ì£¼)</div>'+item('','ì£¼ 1íšŒ <b>í”„ë¡œì íŠ¸ ëŸ°</b> (ì£¼ì œ-ê³„íš-ì™„ì„±-íšŒê³ )')+item('','ì•½ì  2ê°œ ì˜ì—­ì€ ì €ë‚œë„ ë°˜ë³µ ë£¨í‹´ 15ë¶„')+'</div>'
    +'<div class="tcard"><div class="section-title">3) ì¥ê¸°(6â€“12ê°œì›”)</div>'+item('','í…Œë§ˆ ì—°ì‘ 6â€“8ì ìœ¼ë¡œ <b>ë¯¸ë‹ˆ í¬íŠ¸í´ë¦¬ì˜¤</b> êµ¬ì„±')+item('','ê³µëª¨/ì „ì‹œ 1íšŒ ë„ì „')+'</div>'
  +'</div>';

  function jobsBlock(){
    var map={
      SPA:['ê±´ì¶•ê°€','í™˜ê²½Â·ì „ì‹œ ë””ìì´ë„ˆ','ëª¨ë¸ëŸ¬'],
      DET:['ì œí’ˆ/ì£¼ì–¼ë¦¬ ë””ìì´ë„ˆ','í…Œí¬ë‹ˆì»¬ ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°'],
      COL:['ì»¬ëŸ¬ë¦¬ìŠ¤íŠ¸','ê·¸ë˜í”½/ë¸Œëœë”© ë””ìì´ë„ˆ','ì½˜ì…‰íŠ¸ ì•„í‹°ìŠ¤íŠ¸'],
      NAR:['ìŠ¤í† ë¦¬ë³´ë“œ ì•„í‹°ìŠ¤íŠ¸','ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°','ì• ë‹ˆë©”ì´í„°'],
      CHK:['ë¯¸ë””ì–´/ì¸í„°ë™ì…˜ ì•„í‹°ìŠ¤íŠ¸','í¬ë¦¬ì—ì´í‹°ë¸Œ í…Œí¬ë†€ë¡œì§€ìŠ¤íŠ¸'],
      CON:['ì•„íŠ¸ë””ë ‰í„°','ì½˜ì…‰íŠ¸ ë””ìì´ë„ˆ','íë ˆì´í„°'],
      OBS:['ê³¼í•™ ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°','ìì—°ì‚¬ ì•„í‹°ìŠ¤íŠ¸'],
      EXP:['ë¹„ì£¼ì–¼ ì•„í‹°ìŠ¤íŠ¸','ì•„íŠ¸í…Œë¼í”¼ ë³´ì¡°'],
      GRT:['ì‘ê°€/í¬ë¦¬ì—ì´í„°(ì§€ì† ì œì‘)','ê³µì˜ˆê°€'],
      SOC:['ì „ì‹œ/êµìœ¡ ê¸°íš','ì•„íŠ¸ì—ë“€ì¼€ì´í„°'],
      CRT:['ë¦¬ì„œì²˜/ë¹„í‰ê°€','ì•„íŠ¸ê¸°ë°˜ ì „ëµê¸°íš']
    };
    var uniq=[].concat(T,P).filter(function(x, i, a){return a.indexOf(x)===i});
    return '<div class="tgrid">'+uniq.slice(0,6).map(function(k){
      return '<div class="tcard"><div class="section-title">'+(DIM_KR[k]||k)+' â†’ ìœ ë§ ì§ì—…</div><div class="small">'+(map[k]||[]).join(' Â· ')+'</div></div>';
    }).join('')+'</div>';
  }

  app().innerHTML=
  '<div class="detail-hero"><div class="ic">ğŸ“˜</div><div class="detail-title">ì˜ˆìˆ ê°€ ì ì¬ë ¥ ì§„ë‹¨ ë¦¬í¬íŠ¸</div></div>'
  +'<p class="detail-sub"><b>'+name+'</b> (ë§Œ '+STATE.profile.age+'ì„¸, '+STATE.profile.grade+') â€” ì‹¬ì¸µ ë¶„ì„</p>'

  +'<div class="block">'
    +'<div class="section-title">1. ê°•ì  ìš”ì•½</div>'
    +'<div class="tgrid">'
      +'<div class="tcard"><div class="tchip">Top ì—­ëŸ‰</div><div class="small" style="margin-top:6px">'+T.map(function(k){return DIM_KR[k]||k}).join(' Â· ')+'</div></div>'
      +'<div class="tcard"><div class="tchip">ê°€ëŠ¥ì„±(ì°¨ìˆœ)</div><div class="small" style="margin-top:6px">'+P.map(function(k){return DIM_KR[k]||k}).join(' Â· ')+'</div></div>'
    +'</div>'
    +'<div class="small" style="margin-top:10px">'+strengths+'</div>'
  +'</div>'

  +'<div class="block"><div class="section-title">2. ì„±ì¥ ë¡œë“œë§µ</div>'+roadmap+'</div>'

  +'<div class="block"><div class="section-title">3. ì§ì—… ì—°ê³„</div>'+jobsBlock()+'</div>'

  +'<div class="center no-pdf" style="margin-top:16px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">'
    +'<button class="btn-ghost" onclick="STATE.step=\'result\'; render()">ê²°ê³¼ë¡œ ëŒì•„ê°€ê¸°</button>'
    +'<button class="btn" onclick="STATE.step=\'start\'; render()">ì²˜ìŒìœ¼ë¡œ</button>'
  +'</div>';
}

/* ================== PDF / EMAIL ================== */
function buildPdfWrapperFrom(node){
  var wrap=document.createElement('div');
  wrap.style.position='fixed';wrap.style.left='-10000px';wrap.style.top='0';
  wrap.style.width='794px';wrap.style.background='#0b0f16';wrap.style.zIndex='-1';
  var clone=node.cloneNode(true);
  clone.querySelectorAll('img').forEach(function(img){
    img.setAttribute('crossorigin','anonymous'); img.referrerPolicy='no-referrer'; img.src=img.src;
  });
  var srcC=node.querySelectorAll('canvas'); var dstC=clone.querySelectorAll('canvas');
  srcC.forEach(function(src,i){var dst=dstC[i]; if(!dst)return; dst.width=src.width; dst.height=src.height; dst.getContext('2d',{willReadFrequently:true}).drawImage(src,0,0)});
  wrap.appendChild(clone); document.body.appendChild(wrap); return wrap;
}
function waitForAssets(root){
  var imgs=[].slice.call(root.querySelectorAll('img'));
  var imgPromises=imgs.map(function(img){return img.complete?Promise.resolve():new Promise(function(res){img.onload=function(){res()}; img.onerror=function(){res()}})});
  var fontsReady=('fonts' in document)?document.fonts.ready:Promise.resolve();
  return Promise.all([fontsReady].concat(imgPromises));
}
async function html2pdfBlob(wrapper){
  var opt={margin:[8,8,8,8],
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2,useCORS:true,backgroundColor:'#0b0f16',removeContainer:true,windowWidth:wrapper.scrollWidth,windowHeight:wrapper.scrollHeight},
    pagebreak:{mode:['css','legacy']},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}};
  return await html2pdf().set(opt).from(wrapper).output('blob');
}
async function canvasSlicerBlob(wrapper){
  var h2c=window.html2canvas;
  var canvas=await h2c(wrapper,{scale:2,useCORS:true,allowTaint:true,backgroundColor:'#0b0f16',scrollX:0,scrollY:0,windowWidth:wrapper.scrollWidth,windowHeight:wrapper.scrollHeight});
  var jsPDF=window.jspdf.jsPDF;
  var pdf=new jsPDF({unit:'mm',format:'a4',orientation:'portrait'});
  var pxToMm=210/canvas.width;
  var pageHeightPx=Math.floor(297/pxToMm);
  var y=0,page=0;
  while(y<canvas.height){
    var sliceHeight=Math.min(pageHeightPx,canvas.height-y);
    var pageCanvas=document.createElement('canvas');
    pageCanvas.width=canvas.width; pageCanvas.height=sliceHeight;
    var ctx=pageCanvas.getContext('2d',{willReadFrequently:true});
    ctx.drawImage(canvas,0,y,canvas.width,sliceHeight,0,0,canvas.width,sliceHeight);
    var img=pageCanvas.toDataURL('image/jpeg',0.98);
    var mmHeight=sliceHeight*pxToMm;
    if(page>0) pdf.addPage();
    pdf.addImage(img,'JPEG',0,0,210,mmHeight);
    y+=sliceHeight; page++;
  }
  return pdf.output('blob');
}
async function exportPdfBlob(node){
  var wrapper=buildPdfWrapperFrom(node);
  await waitForAssets(wrapper);
  try{
    var blob=await html2pdfBlob(wrapper);
    if(!blob || blob.size<5000){ blob=await canvasSlicerBlob(wrapper); }
    return blob;
  }catch(e){
    try{ return await canvasSlicerBlob(wrapper) } catch(e2){ throw e2 }
  }finally{ wrapper.remove() }
}
async function handleSavePdf(){
  var node=$('pdfArea'); node.classList.add('pdf-screen-width'); await new Promise(function(r){setTimeout(r,50)});
  try{
    var blob=await exportPdfBlob(node);
    var filename=STATE.profile.child_name+'_ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸_ADVANCE.pdf';
    var url=URL.createObjectURL(blob); var a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }catch(e){console.error(e); alert('PDF ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')}
  finally{ node.classList.remove('pdf-screen-width') }
}
function setModalVisible(show){var m=$('emailModal'); if(show){m.classList.add('show'); m.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'} else{m.classList.remove('show'); m.setAttribute('aria-hidden','true'); document.body.style.overflow=''}}
function openEmailModal(){setModalVisible(true); $('emailSubject').value=STATE.profile.child_name+' í…ŒìŠ¤íŠ¸ ê²°ê³¼(ADVANCE)'; $('emailTo').value=STATE.profile.email||''; $('emailMsg').textContent=''}
$('emailCancel').onclick=function(){setModalVisible(false)}; document.addEventListener('keydown',function(e){if(e.key==='Escape')setModalVisible(false)});

function blobToBase64(blob){return new Promise(function(resolve,reject){var reader=new FileReader(); reader.onloadend=function(){resolve(reader.result.split(',')[1])}; reader.onerror=reject; reader.readAsDataURL(blob)})}
$('emailSend').onclick=async function(){
  var to=$('emailTo').value.trim(); if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(to)){ $('emailMsg').textContent='ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.'; return; }
  $('emailMsg').textContent='PDF ìƒì„± ì¤‘...';
  var base64=''; try{var blob=await exportPdfBlob($('pdfArea')); base64=await blobToBase64(blob)}catch(e){$('emailMsg').textContent='PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'; return}
  $('emailMsg').textContent='ì´ë©”ì¼ ì „ì†¡ ì¤‘...';
  var subject=$('emailSubject').value.trim()|| (STATE.profile.child_name+' í…ŒìŠ¤íŠ¸ ê²°ê³¼(ADVANCE)');
  var htmlBody='<div style="font-family:Pretendard,Segoe UI,Arial;color:#111"><h2 style="margin:0 0 8px">'+APP_TITLE+'</h2><p><b>'+STATE.profile.child_name+'</b> ë‹˜ì˜ ê²°ê³¼ì§€ë¥¼ ì²¨ë¶€í–ˆìŠµë‹ˆë‹¤.</p><p>ìº í¼ìŠ¤: '+(STATE.profile.campus||'-')+' / ì—°ë½ì²˜: '+(STATE.profile.phone||'-')+'</p><p style="color:#6b7280;font-size:12px;margin-top:12px">ë³¸ ë©”ì¼ì€ ìë™ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p></div>';
  try{
    var res=await fetch(EMAIL_FUNCTION_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({to:to,subject:subject,html:htmlBody,attachmentName:STATE.profile.child_name+'_ë¯¸ìˆ ì ì„±í…ŒìŠ¤íŠ¸_ADVANCE.pdf',attachmentBase64:base64})});
    var ok=res.ok; var data={}; try{data=await res.json()}catch(_){}
    if(ok){$('emailMsg').textContent='ì „ì†¡ ì™„ë£Œ! ë©”ì¼í•¨ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.'; setTimeout(function(){setModalVisible(false)},1200)}
    else{$('emailMsg').textContent='ì „ì†¡ ì‹¤íŒ¨: '+(data.error||res.statusText)}
  }catch(err){$('emailMsg').textContent='ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}
}

/* ================== ROUTER ================== */
function render(){renderNav();updateTopProgress();if(STATE.step==='start')return viewStart();if(STATE.step==='consent')return viewConsent();if(STATE.step==='profile')return viewProfile();if(STATE.step==='test')return viewTest();if(STATE.step==='result')return viewResult();if(STATE.step==='details')return viewDetails()}
render();

/* ================== LOCAL QUESTIONS (20) ================== */
function W(w){var o={}; DIM.forEach(function(k){o[k]=0}); Object.keys(w).forEach(function(k){o[k]=w[k]}); return o}
function L(q,p,a,b,c,d){return {id:q,order:+q.replace('q',''),prompt:p,options:[
  {key:'A',label:a[0],imageUrl:a[1],weights:W(a[2])},
  {key:'B',label:b[0],imageUrl:b[1],weights:W(b[2])},
  {key:'C',label:c[0],imageUrl:c[1],weights:W(c[2])},
  {key:'D',label:d[0],imageUrl:d[1],weights:W(d[2])}
]}}
function IMG(seed){return 'https://picsum.photos/seed/'+encodeURIComponent(seed)+'/900/600'}
function localQuestions2(){
  return [
  L('q1','ì´ ê·¸ë¦¼ì„ ë³¼ ë•Œ, ê°€ì¥ ë¨¼ì € ì‹œì„ ì´ ê°€ëŠ” ê³³ì€ ì–´ë””ì¸ê°€ìš”?',
    ['ì „ì²´ì ì¸ êµ¬ë„ì™€ ì‚¬ë¬¼ë“¤ì˜ ë°°ì¹˜',IMG('spa1'),{SPA:1}],
    ['ë¶“ í„°ì¹˜ë‚˜ ìƒ‰ì¹ ì˜ ì„¸ë°€í•œ ë¶€ë¶„',IMG('det1'),{DET:1}],
    ['ê°•ë ¬í•œ ìƒ‰ê¹” ì¡°í•©',IMG('col1'),{COL:1}],
    ['ê·¸ë¦¼ ì†ì— ìˆ¨ê²¨ì§„ ìƒì§•ì´ë‚˜ ì˜ë¯¸',IMG('nar1'),{NAR:1}]
  ),
  L('q2','â€œììœ â€ë¥¼ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•œë‹¤ë©´, ê°€ì¥ ë¨¼ì € ë– ì˜¤ë¥´ëŠ” ì´ë¯¸ì§€ëŠ”?',
    ['ì‹œì›í•œ í•˜ëŠ˜ê³¼ ìƒˆë“¤',IMG('free2a'),{CON:0.4,SPA:0.6}],
    ['ì–½íˆê³ ì„¤í‚¨ ì„ /ë„í˜•',IMG('free2b'),{CON:0.6,CHK:0.4}],
    ['ê·œì¹™ì—ì„œ ë²—ì–´ë‚œ ìƒ‰ ì¡°í•©',IMG('free2c'),{COL:0.8,CHK:0.4}],
    ['í•œê» ë›°ì–´ë…¸ëŠ” ì‚¬ëŒë“¤',IMG('free2d'),{NAR:0.6,EXP:0.6}]
  ),
  L('q3','â€œì‹œì‘ê³¼ ëâ€ ì—°ì‘ì„ ë§Œë“ ë‹¤ë©´?',
    ['ìƒì§• ì •ë¬¼ 2ì ìœ¼ë¡œ í‘œí˜„',IMG('q3a'),{CON:0.6,DET:0.5}],
    ['4ì»· ë§Œí™”/ì„œì‚¬ì  ì§„í–‰',IMG('q3b'),{NAR:1}],
    ['ë™ì¼ ë„í˜•+ìƒ‰ë§Œ ë°”ê¾¸ëŠ” ì‹¤í—˜',IMG('q3c'),{COL:0.7,CHK:0.6}],
    ['ì™„ì„± í›„ ë¯¸ì„¸ ë³€ì£¼ë¡œ ì—¬ëŸ¬ ë²„ì „',IMG('q3d'),{GRT:0.6,DET:0.5}]
  ),
  L('q4','ì¹œêµ¬ ì‘í’ˆ í”¼ë“œë°±ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ë³´ëŠ” ê²ƒì€?',
    ['ì´ì•¼ê¸°/ê°ì •',IMG('q4a'),{NAR:0.6,EXP:0.4}],
    ['í˜•íƒœ/êµ¬ë„ì˜ ì•ˆì •ì„±',IMG('q4b'),{SPA:0.9}],
    ['ì‚¬ì‹¤ì Â·ì„¬ì„¸í•œ ë¬˜ì‚¬',IMG('q4c'),{DET:1}],
    ['ìƒˆë¡œìš´ ì‹œë„',IMG('q4d'),{CHK:1}]
  ),
  L('q5','ë‹¹ì‹ ì´ ì‘í’ˆì˜ ì£¼ì¸ê³µì´ë¼ë©´, ì–´ë–¤ ì—­í• ?',
    ['ìˆ¨ê²¨ì§„ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ëŠ” í•´ì„¤ì',IMG('q5a'),{NAR:0.6,EXP:0.5}],
    ['ììœ ë¡­ê²Œ í©ë¿Œë ¤ì§€ëŠ” ì Â·ì„ ',IMG('q5b'),{CHK:0.8,EXP:0.4}],
    ['ë‹¤ë¥¸ ì‚¬ë¬¼ê³¼ ì¡°í™”ë¡­ê²Œ ë°°ì¹˜ëœ ì¡°ì—°',IMG('q5c'),{SPA:0.7,SOC:0.4}],
    ['ì‹œì„ ì„ ì••ë„í•˜ëŠ” ìƒ‰ì±„',IMG('q5d'),{COL:0.9}]
  ),
  L('q6','ìƒˆ ì¬ë£Œ(ì˜ˆ: ì°°í™)ë¥¼ ë°›ì•˜ì„ ë•Œ ë³´í†µì€?',
    ['ë§Œì§€ë©° ì§ˆê° íƒìƒ‰',IMG('q6a'),{CHK:0.5}],
    ['êµ¬ìƒÂ·ê³„íš í›„ ì œì‘',IMG('q6b'),{CON:0.6,SPA:0.5}],
    ['ì£¼ë³€ì„ ì°¸ê³ ',IMG('q6c'),{SOC:0.7}],
    ['ì„¸ë°€ ì§ˆê°Â·í˜•íƒœë¥¼ ì¡°ë¬¼ì¡°ë¬¼',IMG('q6d'),{DET:0.6,OBS:0.6}]
  ),
  L('q7','â€œì—†ëŠ” ê³µê°„â€ì„ ê·¸ë¦°ë‹¤ë©´ ê°€ì¥ ê³µë“¤ì´ëŠ” ë¶€ë¶„?',
    ['ê°€ìƒì˜ ì¡´ì¬/ìƒëª…ì²´',IMG('q7a'),{NAR:0.5,EXP:0.5}],
    ['í˜„ì‹¤ê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ ë‹¤ë¥¸ ë””í…Œì¼',IMG('q7b'),{DET:0.7,OBS:0.5}],
    ['ë¹›ê³¼ ê·¸ë¦¼ìì˜ ë¶„ìœ„ê¸°',IMG('q7c'),{SPA:0.6,COL:0.5}],
    ['ì•ˆ ì¨ë³¸ ê¸°ë²•/ì¬ë£Œ ì‹¤í—˜',IMG('q7d'),{CHK:0.9}]
  ),
  L('q8','â€œì˜ ê·¸ë ¸ë‹¤â€ì˜ í•µì‹¬ì€?',
    ['ì •í™•í•œ í˜•íƒœÂ·ë¹„ë¡€',IMG('q8a'),{DET:0.8,OBS:0.4}],
    ['ë…íŠ¹í•œ ì•„ì´ë””ì–´/ì°½ì˜ì„±',IMG('q8b'),{CON:0.7,CHK:0.6}],
    ['ê°ì •ì„ ì›€ì§ì´ëŠ” í˜',IMG('q8c'),{EXP:0.7,NAR:0.5}],
    ['ì•ˆì •ì ì¸ êµ¬ë„',IMG('q8d'),{SPA:0.9}]
  ),
  L('q9','3ì‹œê°„ ëŒ€íšŒ ì¤‘ 1ì‹œê°„ì§¸ ë§ì³¤ë‹¤ë©´?',
    ['ì²˜ìŒë¶€í„° ë‹¤ì‹œ',IMG('q9a'),{CHK:0.7}],
    ['ìˆ˜ì •í•´ì„œ ëê¹Œì§€',IMG('q9b'),{GRT:0.8,DET:0.4}],
    ['ìƒˆ ì½˜ì…‰íŠ¸ êµ¬ìƒ',IMG('q9c'),{CON:0.7}],
    ['ì£¼ë³€ ì˜ê²¬ êµ¬í•¨',IMG('q9d'),{SOC:0.7}]
  ),
  L('q10','ë¶€ëª¨ë‹˜ì´ â€œì´í•´ ì–´ë µë‹¤â€ê³  í•  ë•Œ ê¸°ë¶„ì€?',
    ['ë‚œí•´í–ˆë‚˜ ì†ìƒ',IMG('q10a'),{CRT:0.5}],
    ['ê°ì •ì„ ì´í•´ ëª»í•˜ë„¤',IMG('q10b'),{EXP:0.6}],
    ['ì˜ë„ë¥¼ ì˜ ì „ë‹¬í•˜ë ¤ ê³ ë¯¼',IMG('q10c'),{NAR:0.6,SOC:0.5}],
    ['ë…íŠ¹í•˜ê³  íŠ¹ë³„í•œê°€ ë³´ë‹¤',IMG('q10d'),{EXP:0.6}]
  ),
  L('q11','ê°€ì¥ í¥ë¯¸ë¡œìš´ ì§ì—…ì€?',
    ['ê±´ì¶•ê°€',IMG('q11a'),{SPA:0.8,CON:0.5}],
    ['ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°',IMG('q11b'),{NAR:0.6,DET:0.5}],
    ['ì• ë‹ˆë©”ì´í„°',IMG('q11c'),{EXP:0.6,NAR:0.6}],
    ['ì¡°ê°ê°€',IMG('q11d'),{SPA:0.6,DET:0.6}]
  ),
  L('q12','í‰ë²”í•œ ë¬¼ê±´(ì‹ ë°œ)ì„ ë¹„ë²”í•˜ê²Œ?',
    ['í˜•íƒœ í•´ì²´Â·ì¬ì¡°í•©',IMG('q12a'),{CON:0.6,CHK:0.6}],
    ['ì¬ì§ˆì„ ì‚¬ì‹¤ì ìœ¼ë¡œ',IMG('q12b'),{DET:0.8,OBS:0.5}],
    ['ìƒ‰ìƒÂ·ë¬´ëŠ¬ ì¥ì‹',IMG('q12c'),{COL:0.8}],
    ['ìŠ¤í† ë¦¬ë¥¼ ë‹´ì•„ í‘œí˜„',IMG('q12d'),{NAR:0.8}]
  ),
  L('q13','ì‘í’ˆì„ ë³¼ ë•Œ ê°€ì¥ ë¨¼ì € ë“œëŠ” ìƒê°ì€?',
    ['ì–¼ë§ˆë‚˜ ì‹œê°„ ê±¸ë ¸ì„ê¹Œ?',IMG('q13a'),{GRT:0.6,DET:0.5}],
    ['ë‚˜ë¼ë©´ ë‹¤ë¥¸ ìƒ‰ ì¼ì„ ë“¯',IMG('q13b'),{COL:0.6,CRT:0.5}],
    ['ì˜ë„/ìŠ¤í† ë¦¬ëŠ”?',IMG('q13c'),{NAR:0.6,CON:0.5}],
    ['ì‘ê°€ì˜ ì‚¶ì€?',IMG('q13d'),{EXP:0.6,NAR:0.4}]
  ),
  L('q14','ê°ì •ì„ ê°€ì¥ ì˜ í‘œí˜„í•˜ëŠ” ìš”ì†ŒëŠ”?',
    ['ì„ ì˜ êµµê¸°Â·ê±°ì¹œ ì§ˆê°',IMG('q14a'),{DET:0.5}],
    ['ê°•ë ¬/ë¶€ë“œëŸ¬ìš´ ìƒ‰',IMG('q14b'),{COL:0.7,EXP:0.5}],
    ['í‘œì •',IMG('q14c'),{NAR:0.6,EXP:0.5}],
    ['ë¶„ìœ„ê¸°/êµ¬ë„',IMG('q14d'),{SPA:0.7}]
  ),
  L('q15','1ë…„ ì¥ê¸° í”„ë¡œì íŠ¸, ê°€ì¥ í¥ë¯¸ë¡œìš´ ì£¼ì œëŠ”?',
    ['ë„ì‹œ í’ê²½ì„ ê¼¼ê¼¼í•˜ê²Œ',IMG('q15a'),{OBS:0.6,GRT:0.7,DET:0.5}],
    ['í•œ ì¸ë¬¼ì˜ ì¼ìƒ 12ì—°ì‘',IMG('q15b'),{NAR:0.7,GRT:0.6}],
    ['ìƒˆ ì¬ë£ŒÂ·ê¸°ë²• ì§€ì† ì‹¤í—˜',IMG('q15c'),{CHK:0.8,GRT:0.5}],
    ['ì‹¬ë¦¬ ë³€í™” ê¸°ë¡Â·ì‹œê°í™”',IMG('q15d'),{EXP:0.6,CON:0.6}]
  ),
  L('q16','ê°€ì¥ ì¤‘ìš”í•œ ì‘í’ˆì„ ê³ ë¥¸ë‹¤ë©´, ì´ìœ ëŠ”?',
    ['ê°•í•œ ê°ë™',IMG('q16a'),{EXP:0.8}],
    ['ì‚¬íšŒì  ë©”ì‹œì§€/ì•„ì´ë””ì–´',IMG('q16b'),{CON:0.6,NAR:0.6}],
    ['ì •êµí•˜ê³  ì‚¬ì‹¤ì  ë¬˜ì‚¬',IMG('q16c'),{DET:0.8,OBS:0.6}],
    ['ìƒ‰/í˜•íƒœê°€ ë…íŠ¹',IMG('q16d'),{COL:0.7,CHK:0.6}]
  ),
  L('q17','â€œë‘ë ¤ì›€â€ì„ ì‹œê°í™”í•œë‹¤ë©´?',
    ['ë³µì¡í•œ ì„ /ëª¨ì–‘',IMG('q17a'),{CHK:0.6,EXP:0.5}],
    ['ì–´ë‘¡ê³  ì°¨ê°€ìš´ ìƒ‰',IMG('q17b'),{COL:0.6,EXP:0.5}],
    ['ìˆ¨ì€ ì‘ì€ ì¡´ì¬',IMG('q17c'),{DET:0.5,NAR:0.5,OBS:0.5}],
    ['ë‚˜ë§Œì˜ ìƒì§•',IMG('q17d'),{EXP:0.6,CON:0.6}]
  ),
  L('q18','í° ì‘í’ˆì—ì„œ ê°€ì¥ í˜ë“  ì ì€?',
    ['ê³„íšê³¼ ë‹¬ë¼ì§€ëŠ” ê²ƒ',IMG('q18a'),{CON:0.5,CRT:0.5}],
    ['ì‘ì€ ë¶€ë¶„ ë°˜ë³µ ìˆ˜ì •',IMG('q18b'),{DET:0.6,GRT:0.6}],
    ['ëì—†ì´ ëŠê»´ì§€ëŠ” ì§€ë£¨í•¨',IMG('q18c'),{GRT:0.6}],
    ['ì˜ë„ê°€ ì´í•´ ì•ˆ ë  ë¶ˆì•ˆ',IMG('q18d'),{SOC:0.6,EXP:0.4}]
  ),
  L('q19','ì‹¬ì‚¬ìœ„ì›ì´ë¼ë©´ ë†’ì€ ì ìˆ˜ë¥¼ ì¤„ ìš”ì†ŒëŠ”?',
    ['ê¸°ìˆ ì ìœ¼ë¡œ ì™„ë²½',IMG('q19a'),{DET:0.7,GRT:0.5,OBS:0.4}],
    ['ê³ ì •ê´€ë…ì„ ê¹¨ëŠ” ì¶©ê²©',IMG('q19b'),{CHK:0.8,CON:0.6}],
    ['ë§ˆìŒì„ ê¹Šì´ ì›€ì§ì„',IMG('q19c'),{EXP:0.7,NAR:0.6}],
    ['ì—¬ëŸ¬ ì˜ë¯¸ë¥¼ ë˜ì§',IMG('q19d'),{CON:0.6,NAR:0.6}]
  ),
  L('q20','ëˆˆì— ë³´ì´ì§€ ì•ŠëŠ” ê³µê¸°/ì†Œë¦¬/ëƒ„ìƒˆë¥¼ í‘œí˜„í•œë‹¤ë©´?',
    ['ë„í˜•/ì„ ìœ¼ë¡œ',IMG('q20a'),{SPA:0.6,CON:0.6}],
    ['ëŠë‚Œì— ë§ëŠ” ìƒ‰ê³¼ ë¶„ìœ„ê¸°',IMG('q20b'),{COL:0.7,EXP:0.5}],
    ['ì›€ì§ì„Â·íë¦„',IMG('q20c'),{NAR:0.6,SPA:0.5}],
    ['ê³µê°„ ì±„ì›€ì˜ ë³µì¡ì„±',IMG('q20d'),{DET:0.5,OBS:0.5,SPA:0.5}]
  )
  ].map(function(q){q.options=q.options.filter(function(o){return o.label||o.imageUrl}); if(q.options.length<2) q.options=q.options.slice(0,2); return q});
}
</script>
</body>
</html>
